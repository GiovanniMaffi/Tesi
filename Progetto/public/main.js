/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{FirebaseError:()=>d,SDK_VERSION:()=>de,_DEFAULT_ENTRY_NAME:()=>ee,_addComponent:()=>se,_addOrOverwriteComponent:()=>ie,_apps:()=>ne,_clearComponents:()=>ue,_components:()=>re,_getProvider:()=>ae,_registerComponent:()=>oe,_removeServiceInstance:()=>ce,deleteApp:()=>pe,getApp:()=>ge,getApps:()=>me,initializeApp:()=>fe,onLog:()=>we,registerVersion:()=>ye,setLogLevel:()=>ve});const n=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const s=e[t],i=t+1<e.length,o=i?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[n++];t[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==o||null==a||null==c)throw new s;const u=i<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(e){return function(e){const t=n(e);return r.encodeByteArray(t,!0)}(e).replace(/\./g,"")};function o(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=o(e[n],t[n]));return e}const a=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},c=()=>{var e;return null===(e=a())||void 0===e?void 0:e.config};class u{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function l(){try{return"object"==typeof indexedDB}catch(e){return!1}}class d extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(g,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new d(r,o,n)}}const g=/\{\$([^}]+)}/g;function m(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function p(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const s of n){if(!r.includes(s))return!1;const n=e[s],i=t[s];if(y(n)&&y(i)){if(!p(n,i))return!1}else if(n!==i)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function y(e){return null!==e&&"object"==typeof e}function w(e,t){const n=new v(e,t);return n.subscribe.bind(n)}class v{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=b),void 0===r.error&&(r.error=b),void 0===r.complete&&(r.complete=b);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function b(){}function _(e){return e&&e._delegate?e._delegate:e}class I{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const E="[DEFAULT]";class T{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new u;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:E})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=E){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=E){return this.instances.has(e)}getOptions(e=E){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===E?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=E){return this.component?this.component.multipleInstances?e:E:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class S{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new T(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const C=[];var D;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(D||(D={}));const x={debug:D.DEBUG,verbose:D.VERBOSE,info:D.INFO,warn:D.WARN,error:D.ERROR,silent:D.SILENT},A=D.INFO,N={[D.DEBUG]:"log",[D.VERBOSE]:"log",[D.INFO]:"info",[D.WARN]:"warn",[D.ERROR]:"error"},k=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),s=N[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)};class R{constructor(e){this.name=e,this._logLevel=A,this._logHandler=k,this._userLogHandler=null,C.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in D))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?x[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,D.DEBUG,...e),this._logHandler(this,D.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,D.VERBOSE,...e),this._logHandler(this,D.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,D.INFO,...e),this._logHandler(this,D.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,D.WARN,...e),this._logHandler(this,D.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,D.ERROR,...e),this._logHandler(this,D.ERROR,...e)}}const O=(e,t)=>t.some((t=>e instanceof t));let M,L;const P=new WeakMap,F=new WeakMap,V=new WeakMap,B=new WeakMap,U=new WeakMap;let q={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return F.get(e);if("objectStoreNames"===t)return e.objectStoreNames||V.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return $(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function j(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(L||(L=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(z(this),e),$(P.get(this))}:function(...e){return $(t.apply(z(this),e))}:function(e,...n){const r=t.call(z(this),e,...n);return V.set(r,e.sort?e.sort():[e]),$(r)}:(e instanceof IDBTransaction&&function(e){if(F.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)}));F.set(e,t)}(e),O(e,M||(M=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,q):e);var t}function $(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t($(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&P.set(t,e)})).catch((()=>{})),U.set(t,e),t}(e);if(B.has(e))return B.get(e);const t=j(e);return t!==e&&(B.set(e,t),U.set(t,e)),t}const z=e=>U.get(e),G=["get","getKey","getAll","getAllKeys","count"],K=["put","add","delete","clear"],Q=new Map;function H(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Q.get(t))return Q.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=K.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!G.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&i.done]))[0]};return Q.set(t,i),i}var W;W=q,q={...W,get:(e,t,n)=>H(e,t)||W.get(e,t,n),has:(e,t)=>!!H(e,t)||W.has(e,t)};class Y{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const X="@firebase/app",J="0.9.17",Z=new R("@firebase/app"),ee="[DEFAULT]",te={[X]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ne=new Map,re=new Map;function se(e,t){try{e.container.addComponent(t)}catch(n){Z.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ie(e,t){e.container.addOrOverwriteComponent(t)}function oe(e){const t=e.name;if(re.has(t))return Z.debug(`There were multiple attempts to register component ${t}.`),!1;re.set(t,e);for(const t of ne.values())se(t,e);return!0}function ae(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ce(e,t,n=ee){ae(e,t).clearInstance(n)}function ue(){re.clear()}const he=new f("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class le{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new I("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw he.create("app-deleted",{appName:this._name})}}const de="10.3.0";function fe(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:ee,automaticDataCollectionEnabled:!1},t),s=r.name;if("string"!=typeof s||!s)throw he.create("bad-app-name",{appName:String(s)});if(n||(n=c()),!n)throw he.create("no-options");const i=ne.get(s);if(i){if(p(n,i.options)&&p(r,i.config))return i;throw he.create("duplicate-app",{appName:s})}const o=new S(s);for(const e of re.values())o.addComponent(e);const a=new le(n,r,o);return ne.set(s,a),a}function ge(e=ee){const t=ne.get(e);if(!t&&e===ee&&c())return fe();if(!t)throw he.create("no-app",{appName:e});return t}function me(){return Array.from(ne.values())}async function pe(e){const t=e.name;ne.has(t)&&(ne.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function ye(e,t,n){var r;let s=null!==(r=te[e])&&void 0!==r?r:e;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const e=[`Unable to register library "${s}" with version "${t}":`];return i&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Z.warn(e.join(" "))}oe(new I(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}function we(e,t){if(null!==e&&"function"!=typeof e)throw he.create("invalid-log-argument");!function(e,t){for(const n of C){let r=null;t&&t.level&&(r=x[t.level]),n.userLogHandler=null===e?null:(t,n,...s)=>{const i=s.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:D[n].toLowerCase(),message:i,args:s,type:t.name})}}}(e,t)}function ve(e){var t;t=e,C.forEach((e=>{e.setLogLevel(t)}))}const be="firebase-heartbeat-database",_e=1,Ie="firebase-heartbeat-store";let Ee=null;function Te(){return Ee||(Ee=function(e,t,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=$(o);return r&&o.addEventListener("upgradeneeded",(e=>{r($(o.result),e.oldVersion,e.newVersion,$(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(be,_e,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Ie)}}).catch((e=>{throw he.create("idb-open",{originalErrorMessage:e.message})}))),Ee}async function Se(e,t){try{const n=(await Te()).transaction(Ie,"readwrite"),r=n.objectStore(Ie);await r.put(t,Ce(e)),await n.done}catch(e){if(e instanceof d)Z.warn(e.message);else{const t=he.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});Z.warn(t.message)}}}function Ce(e){return`${e.name}!${e.options.appId}`}class De{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ae(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=xe();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=xe(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),Ne(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ne(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=i(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function xe(){return(new Date).toISOString().substring(0,10)}class Ae{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!l()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await Te();return await t.transaction(Ie).objectStore(Ie).get(Ce(e))}catch(e){if(e instanceof d)Z.warn(e.message);else{const t=he.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});Z.warn(t.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Se(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Se(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Ne(e){return i(JSON.stringify({version:2,heartbeats:e})).length}oe(new I("platform-logger",(e=>new Y(e)),"PRIVATE")),oe(new I("heartbeat",(e=>new De(e)),"PRIVATE")),ye(X,J,""),ye(X,J,"esm2017"),ye("fire-js","");class ke{constructor(e,t){this._delegate=e,this.firebase=t,se(e,new I("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),pe(this._delegate))))}_getService(e,t=ee){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=ee){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){se(this._delegate,e)}_addOrOverwriteComponent(e){ie(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Re=new f("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),Oe=function e(){const n=function(e){const n={},r={__esModule:!0,initializeApp:function(t,s={}){const i=fe(t,s);if(m(n,i.name))return n[i.name];const o=new e(i,r);return n[i.name]=o,o},app:s,registerVersion:ye,setLogLevel:ve,onLog:we,apps:null,SDK_VERSION:de,INTERNAL:{registerComponent:function(t){const n=t.name,i=n.replace("-compat","");if(oe(t)&&"PUBLIC"===t.type){const a=(e=s())=>{if("function"!=typeof e[i])throw Re.create("invalid-app-argument",{appName:n});return e[i]()};void 0!==t.serviceProps&&o(a,t.serviceProps),r[i]=a,e.prototype[i]=function(...e){return this._getService.bind(this,n).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?r[i]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:t}};function s(e){if(!m(n,e=e||ee))throw Re.create("no-app",{appName:e});return n[e]}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(n).map((e=>n[e]))}}),s.App=e,r}(ke);return n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){o(n,e)},createSubscribe:w,ErrorFactory:f,deepExtend:o}),n}(),Me=new R("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Me.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&Me.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Le=Oe;ye("@firebase/app-compat","0.2.17",void 0),Le.registerVersion("firebase","10.3.0","app-compat");var Pe,Fe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ve={},Be=Be||{},Ue=Fe||self;function qe(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function je(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var $e="closure_uid_"+(1e9*Math.random()>>>0),ze=0;function Ge(e,t,n){return e.call.apply(e.bind,arguments)}function Ke(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Qe(e,t,n){return(Qe=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ge:Ke).apply(null,arguments)}function He(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function We(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}function Ye(){this.s=this.s,this.o=this.o}Ye.prototype.s=!1,Ye.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,$e)&&e[$e]||(e[$e]=++ze))},Ye.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Xe=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Je(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function Ze(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(qe(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let s=0;s<r;s++)e[t+s]=n[s]}else e.push(n)}}function et(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}et.prototype.h=function(){this.defaultPrevented=!0};var tt=function(){if(!Ue.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Ue.addEventListener("test",(()=>{}),t),Ue.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function nt(e){return/^[\s\xa0]*$/.test(e)}function rt(){var e=Ue.navigator;return e&&(e=e.userAgent)?e:""}function st(e){return-1!=rt().indexOf(e)}function it(e){return it[" "](e),e}it[" "]=function(){};var ot,at,ct,ut=st("Opera"),ht=st("Trident")||st("MSIE"),lt=st("Edge"),dt=lt||ht,ft=st("Gecko")&&!(-1!=rt().toLowerCase().indexOf("webkit")&&!st("Edge"))&&!(st("Trident")||st("MSIE"))&&!st("Edge"),gt=-1!=rt().toLowerCase().indexOf("webkit")&&!st("Edge");function mt(){var e=Ue.document;return e?e.documentMode:void 0}e:{var pt="",yt=(at=rt(),ft?/rv:([^\);]+)(\)|;)/.exec(at):lt?/Edge\/([\d\.]+)/.exec(at):ht?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(at):gt?/WebKit\/(\S+)/.exec(at):ut?/(?:Version)[ \/]?(\S+)/.exec(at):void 0);if(yt&&(pt=yt?yt[1]:""),ht){var wt=mt();if(null!=wt&&wt>parseFloat(pt)){ot=String(wt);break e}}ot=pt}Ue.document&&ht?ct=mt()||parseInt(ot,10)||void 0:ct=void 0;var vt=ct;function bt(e,t){if(et.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(ft){e:{try{it(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:_t[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&bt.$.h.call(this)}}We(bt,et);var _t={2:"touch",3:"pen",4:"mouse"};bt.prototype.h=function(){bt.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var It="closure_listenable_"+(1e6*Math.random()|0),Et=0;function Tt(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=s,this.key=++Et,this.fa=this.ia=!1}function St(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Ct(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Dt(e){const t={};for(const n in e)t[n]=e[n];return t}const xt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function At(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<xt.length;t++)n=xt[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Nt(e){this.src=e,this.g={},this.h=0}function kt(e,t){var n=t.type;if(n in e.g){var r,s=e.g[n],i=Xe(s,t);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(St(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Rt(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.fa&&i.listener==t&&i.capture==!!n&&i.la==r)return s}return-1}Nt.prototype.add=function(e,t,n,r,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=Rt(e,t,r,s);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new Tt(t,this.src,i,!!r,s)).ia=n,e.push(t)),t};var Ot="closure_lm_"+(1e6*Math.random()|0),Mt={};function Lt(e,t,n,r,s){if(r&&r.once)return Ft(e,t,n,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)Lt(e,t[i],n,r,s);return null}return n=zt(n),e&&e[It]?e.O(t,n,je(r)?!!r.capture:!!r,s):Pt(e,t,n,!1,r,s)}function Pt(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var o=je(s)?!!s.capture:!!s,a=jt(e);if(a||(e[Ot]=a=new Nt(e)),(n=a.add(t,n,r,o,i)).proxy)return n;if(r=function(){const e=qt;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)tt||(s=o),void 0===s&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(Ut(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ft(e,t,n,r,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)Ft(e,t[i],n,r,s);return null}return n=zt(n),e&&e[It]?e.P(t,n,je(r)?!!r.capture:!!r,s):Pt(e,t,n,!0,r,s)}function Vt(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)Vt(e,t[i],n,r,s);else r=je(r)?!!r.capture:!!r,n=zt(n),e&&e[It]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Rt(i=e.g[t],n,r,s))&&(St(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete e.g[t],e.h--))):e&&(e=jt(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Rt(t,n,r,s)),(n=-1<e?t[e]:null)&&Bt(n))}function Bt(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[It])kt(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Ut(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=jt(t))?(kt(n,e),0==n.h&&(n.src=null,t[Ot]=null)):St(e)}}}function Ut(e){return e in Mt?Mt[e]:Mt[e]="on"+e}function qt(e,t){if(e.fa)e=!0;else{t=new bt(t,this);var n=e.listener,r=e.la||e.src;e.ia&&Bt(e),e=n.call(r,t)}return e}function jt(e){return(e=e[Ot])instanceof Nt?e:null}var $t="__closure_events_fn_"+(1e9*Math.random()>>>0);function zt(e){return"function"==typeof e?e:(e[$t]||(e[$t]=function(t){return e.handleEvent(t)}),e[$t])}function Gt(){Ye.call(this),this.i=new Nt(this),this.S=this,this.J=null}function Kt(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new et(t,e);else if(t instanceof et)t.target=t.target||e;else{var s=t;At(t=new et(r,e),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=t.g=n[i];s=Qt(o,r,!0,t)&&s}if(s=Qt(o=t.g=e,r,!0,t)&&s,s=Qt(o,r,!1,t)&&s,n)for(i=0;i<n.length;i++)s=Qt(o=t.g=n[i],r,!1,t)&&s}function Qt(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&kt(e.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}We(Gt,Ye),Gt.prototype[It]=!0,Gt.prototype.removeEventListener=function(e,t,n,r){Vt(this,e,t,n,r)},Gt.prototype.N=function(){if(Gt.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)St(n[r]);delete t.g[e],t.h--}}this.J=null},Gt.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Gt.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ht=Ue.JSON.stringify;function Wt(){var e=nn;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Yt=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Xt),(e=>e.reset()));class Xt{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Jt(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Zt(e){Ue.setTimeout((()=>{throw e}),0)}let en,tn=!1,nn=new class{constructor(){this.h=this.g=null}add(e,t){const n=Yt.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},rn=()=>{const e=Ue.Promise.resolve(void 0);en=()=>{e.then(sn)}};var sn=()=>{for(var e;e=Wt();){try{e.h.call(e.g)}catch(e){Zt(e)}var t=Yt;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}tn=!1};function on(e,t){Gt.call(this),this.h=e||1,this.g=t||Ue,this.j=Qe(this.qb,this),this.l=Date.now()}function an(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function cn(e,t,n){if("function"==typeof e)n&&(e=Qe(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Qe(e.handleEvent,e)}return 2147483647<Number(t)?-1:Ue.setTimeout(e,t||0)}function un(e){e.g=cn((()=>{e.g=null,e.i&&(e.i=!1,un(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}We(on,Gt),(Pe=on.prototype).ga=!1,Pe.T=null,Pe.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Kt(this,"tick"),this.ga&&(an(this),this.start()))}},Pe.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Pe.N=function(){on.$.N.call(this),an(this),delete this.g};class hn extends Ye{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:un(this)}N(){super.N(),this.g&&(Ue.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ln(e){Ye.call(this),this.h=e,this.g={}}We(ln,Ye);var dn=[];function fn(e,t,n,r){Array.isArray(n)||(n&&(dn[0]=n.toString()),n=dn);for(var s=0;s<n.length;s++){var i=Lt(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function gn(e){Ct(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Bt(e)}),e),e.g={}}function mn(){this.g=!0}function pn(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ht(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}ln.prototype.N=function(){ln.$.N.call(this),gn(this)},ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},mn.prototype.Ea=function(){this.g=!1},mn.prototype.info=function(){};var yn={},wn=null;function vn(){return wn=wn||new Gt}function bn(e){et.call(this,yn.Ta,e)}function _n(e){const t=vn();Kt(t,new bn(t))}function In(e,t){et.call(this,yn.STAT_EVENT,e),this.stat=t}function En(e){const t=vn();Kt(t,new In(t,e))}function Tn(e,t){et.call(this,yn.Ua,e),this.size=t}function Sn(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Ue.setTimeout((function(){e()}),t)}yn.Ta="serverreachability",We(bn,et),yn.STAT_EVENT="statevent",We(In,et),yn.Ua="timingevent",We(Tn,et);var Cn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Dn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function xn(){}function An(e){return e.h||(e.h=e.i())}function Nn(){}xn.prototype.h=null;var kn,Rn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function On(){et.call(this,"d")}function Mn(){et.call(this,"c")}function Ln(){}function Pn(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new ln(this),this.P=Vn,e=dt?125:void 0,this.V=new on(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Fn}function Fn(){this.i=null,this.g="",this.h=!1}We(On,et),We(Mn,et),We(Ln,xn),Ln.prototype.g=function(){return new XMLHttpRequest},Ln.prototype.i=function(){return{}},kn=new Ln;var Vn=45e3,Bn={},Un={};function qn(e,t,n){e.L=1,e.v=or(tr(t)),e.s=n,e.S=!0,jn(e,null)}function jn(e,t){e.G=Date.now(),Kn(e),e.A=tr(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),vr(n.i,"t",r),e.C=0,n=e.l.J,e.h=new Fn,e.g=ws(e.l,n?t:null,!e.s),0<e.O&&(e.M=new hn(Qe(e.Pa,e,e.g),e.O)),fn(e.U,e.g,"readystatechange",e.nb),t=e.I?Dt(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),_n(),function(e,t,n,r,s,i){e.info((function(){if(e.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function $n(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function zn(e,t,n){let r,s=!0;for(;!e.J&&e.C<n.length;){if(r=Gn(e,n),r==Un){4==t&&(e.o=4,En(14),s=!1),pn(e.j,e.m,null,"[Incomplete Response]");break}if(r==Bn){e.o=4,En(15),pn(e.j,e.m,n,"[Invalid Chunk]"),s=!1;break}pn(e.j,e.m,r,null),Xn(e,r)}$n(e)&&r!=Un&&r!=Bn&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,En(16),s=!1),e.i=e.i&&s,s?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),hs(t),t.M=!0,En(11))):(pn(e.j,e.m,n,"[Invalid Chunked Response]"),Yn(e),Wn(e))}function Gn(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Un:(n=Number(t.substring(n,r)),isNaN(n)?Bn:(r+=1)+n>t.length?Un:(t=t.slice(r,r+n),e.C=r+n,t))}function Kn(e){e.Y=Date.now()+e.P,Qn(e,e.P)}function Qn(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Sn(Qe(e.lb,e),t)}function Hn(e){e.B&&(Ue.clearTimeout(e.B),e.B=null)}function Wn(e){0==e.l.H||e.J||fs(e.l,e)}function Yn(e){Hn(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,an(e.V),gn(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Xn(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Sr(n.i,e)))if(!e.K&&Sr(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;ds(n),ns(n)}us(n),En(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=Sn(Qe(n.ib,n),6e3));if(1>=Tr(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else ms(n,11)}else if((e.K||n.g==e)&&ds(n),!nt(t))for(s=n.Ja.g.parse(t),t=0;t<s.length;t++){let u=s[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const s=u[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.i;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Cr(i,i.h),i.h=null))}if(r.F){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,ir(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=ys(r,r.J?r.pa:null,r.Y),o.K){Dr(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(Hn(a),Kn(a)),r.g=o}else cs(r);0<n.j.length&&ss(n)}else"stop"!=u[0]&&"close"!=u[0]||ms(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ms(n,7):ts(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}_n()}catch(e){}}function Jn(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(qe(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(qe(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(qe(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),s=r.length,i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}(Pe=Pn.prototype).setTimeout=function(e){this.P=e},Pe.nb=function(e){e=e.target;const t=this.M;t&&3==Wr(e)?t.l():this.Pa(e)},Pe.Pa=function(e){try{if(e==this.g)e:{const h=Wr(this.g);var t=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||dt||this.g&&(this.h.h||this.g.ja()||Yr(this.g)))){this.J||4!=h||7==t||_n(),Hn(this);var n=this.g.da();this.ca=n;t:if($n(this)){var r=Yr(this.g);e="";var s=r.length,i=4==Wr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Yn(this),Wn(this);var o="";break t}this.h.i=new Ue.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:i&&t==s-1});r.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,s,i,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!nt(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,En(12),Yn(this),Wn(this);break e}pn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Xn(this,n)}this.S?(zn(this,h,o),dt&&this.i&&3==h&&(fn(this.U,this.V,"tick",this.mb),this.V.start())):(pn(this.j,this.m,o,null),Xn(this,o)),4==h&&Yn(this),this.i&&!this.J&&(4==h?fs(this.l,this):(this.i=!1,Kn(this)))}else(function(e){const t={};e=(e.g&&2<=Wr(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(nt(e[r]))continue;var n=Jt(e[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[s]||[];t[s]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,En(12)):(this.o=0,En(13)),Yn(this),Wn(this)}}}catch(e){}},Pe.mb=function(){if(this.g){var e=Wr(this.g),t=this.g.ja();this.C<t.length&&(Hn(this),zn(this,e,t),this.i&&4!=e&&Kn(this))}},Pe.cancel=function(){this.J=!0,Yn(this)},Pe.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(_n(),En(17)),Yn(this),this.o=2,Wn(this)):Qn(this,this.Y-e)};var Zn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function er(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof er){this.h=e.h,nr(this,e.j),this.s=e.s,this.g=e.g,rr(this,e.m),this.l=e.l;var t=e.i,n=new mr;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),sr(this,n),this.o=e.o}else e&&(t=String(e).match(Zn))?(this.h=!1,nr(this,t[1]||"",!0),this.s=ar(t[2]||""),this.g=ar(t[3]||"",!0),rr(this,t[4]),this.l=ar(t[5]||"",!0),sr(this,t[6]||"",!0),this.o=ar(t[7]||"")):(this.h=!1,this.i=new mr(null,this.h))}function tr(e){return new er(e)}function nr(e,t,n){e.j=n?ar(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function rr(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function sr(e,t,n){t instanceof mr?(e.i=t,function(e,t){t&&!e.j&&(pr(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(yr(this,t),vr(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=cr(t,fr)),e.i=new mr(t,e.h))}function ir(e,t,n){e.i.set(t,n)}function or(e){return ir(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ar(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function cr(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ur),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ur(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}er.prototype.toString=function(){var e=[],t=this.j;t&&e.push(cr(t,hr,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(cr(t,hr,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(cr(n,"/"==n.charAt(0)?dr:lr,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",cr(n,gr)),e.join("")};var hr=/[#\/\?@]/g,lr=/[#\?:]/g,dr=/[#\?]/g,fr=/[#\?@]/g,gr=/#/g;function mr(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function pr(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),s=null;if(0<=r){var i=e[n].substring(0,r);s=e[n].substring(r+1)}else i=e[n];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function yr(e,t){pr(e),t=br(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function wr(e,t){return pr(e),t=br(e,t),e.g.has(t)}function vr(e,t,n){yr(e,t),0<n.length&&(e.i=null,e.g.set(br(e,t),Je(n)),e.h+=n.length)}function br(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function _r(e){this.l=e||Ir,e=Ue.PerformanceNavigationTiming?0<(e=Ue.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Ue.g&&Ue.g.Ka&&Ue.g.Ka()&&Ue.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(Pe=mr.prototype).add=function(e,t){pr(this),this.i=null,e=br(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Pe.forEach=function(e,t){pr(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},Pe.ta=function(){pr(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const s=e[r];for(let e=0;e<s.length;e++)n.push(t[r])}return n},Pe.Z=function(e){pr(this);let t=[];if("string"==typeof e)wr(this,e)&&(t=t.concat(this.g.get(br(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},Pe.set=function(e,t){return pr(this),this.i=null,wr(this,e=br(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Pe.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},Pe.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),e.push(s)}}return this.i=e.join("&")};var Ir=10;function Er(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Tr(e){return e.h?1:e.g?e.g.size:0}function Sr(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Cr(e,t){e.g?e.g.add(t):e.h=t}function Dr(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function xr(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return Je(e.i)}_r.prototype.cancel=function(){if(this.i=xr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Ar=class{stringify(e){return Ue.JSON.stringify(e,void 0)}parse(e){return Ue.JSON.parse(e,void 0)}};function Nr(){this.g=new Ar}function kr(e,t,n){const r=n||"";try{Jn(e,(function(e,n){let s=e;je(e)&&(s=Ht(e)),t.push(r+n+"="+encodeURIComponent(s))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Rr(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch(e){}}function Or(e){this.l=e.fc||null,this.j=e.ob||!1}function Mr(e,t){Gt.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=Lr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}We(Or,xn),Or.prototype.g=function(){return new Mr(this.l,this.j)},Or.prototype.i=function(e){return function(){return e}}({}),We(Mr,Gt);var Lr=0;function Pr(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function Fr(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Vr(e)}function Vr(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Pe=Mr.prototype).open=function(e,t){if(this.readyState!=Lr)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Vr(this)},Pe.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||Ue).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},Pe.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Fr(this)),this.readyState=Lr},Pe.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Vr(this)),this.g&&(this.readyState=3,Vr(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Ue.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Pr(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},Pe.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Fr(this):Vr(this),3==this.readyState&&Pr(this)}},Pe.Za=function(e){this.g&&(this.response=this.responseText=e,Fr(this))},Pe.Ya=function(e){this.g&&(this.response=e,Fr(this))},Pe.ka=function(){this.g&&Fr(this)},Pe.setRequestHeader=function(e,t){this.v.append(e,t)},Pe.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Pe.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Mr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Br=Ue.JSON.parse;function Ur(e){Gt.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=qr,this.L=this.M=!1}We(Ur,Gt);var qr="",jr=/^https?$/i,$r=["POST","PUT"];function zr(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Gr(e),Qr(e)}function Gr(e){e.F||(e.F=!0,Kt(e,"complete"),Kt(e,"error"))}function Kr(e){if(e.h&&void 0!==Be&&(!e.C[1]||4!=Wr(e)||2!=e.da()))if(e.v&&4==Wr(e))cn(e.La,0,e);else if(Kt(e,"readystatechange"),4==Wr(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var s=String(e.I).match(Zn)[1]||null;!s&&Ue.self&&Ue.self.location&&(s=Ue.self.location.protocol.slice(0,-1)),r=!jr.test(s?s.toLowerCase():"")}n=r}if(n)Kt(e,"complete"),Kt(e,"success");else{e.m=6;try{var i=2<Wr(e)?e.g.statusText:""}catch(e){i=""}e.j=i+" ["+e.da()+"]",Gr(e)}}finally{Qr(e)}}}function Qr(e,t){if(e.g){Hr(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||Kt(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Hr(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(Ue.clearTimeout(e.A),e.A=null)}function Wr(e){return e.g?e.g.readyState:0}function Yr(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case qr:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Xr(e){let t="";return Ct(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Jr(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Xr(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ir(e,t,n))}function Zr(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function es(e){this.Ga=0,this.j=[],this.l=new mn,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Zr("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Zr("baseRetryDelayMs",5e3,e),this.hb=Zr("retryDelaySeedMs",1e4,e),this.eb=Zr("forwardChannelMaxRetries",2,e),this.xa=Zr("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new _r(e&&e.concurrentRequestLimit),this.Ja=new Nr,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function ts(e){if(rs(e),3==e.H){var t=e.W++,n=tr(e.I);if(ir(n,"SID",e.K),ir(n,"RID",t),ir(n,"TYPE","terminate"),os(e,n),(t=new Pn(e,e.l,t)).L=2,t.v=or(tr(n)),n=!1,Ue.navigator&&Ue.navigator.sendBeacon)try{n=Ue.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&Ue.Image&&((new Image).src=t.v,n=!0),n||(t.g=ws(t.l,null),t.g.ha(t.v)),t.G=Date.now(),Kn(t)}ps(e)}function ns(e){e.g&&(hs(e),e.g.cancel(),e.g=null)}function rs(e){ns(e),e.u&&(Ue.clearTimeout(e.u),e.u=null),ds(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Ue.clearTimeout(e.m),e.m=null)}function ss(e){if(!Er(e.i)&&!e.m){e.m=!0;var t=e.Na;en||rn(),tn||(en(),tn=!0),nn.add(t,e),e.C=0}}function is(e,t){var n;n=t?t.m:e.W++;const r=tr(e.I);ir(r,"SID",e.K),ir(r,"RID",n),ir(r,"AID",e.V),os(e,r),e.o&&e.s&&Jr(r,e.o,e.s),n=new Pn(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=as(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),Cr(e.i,n),qn(n,r,t)}function os(e,t){e.na&&Ct(e.na,(function(e,n){ir(t,n,e)})),e.h&&Jn({},(function(e,n){ir(t,n,e)}))}function as(e,t,n){n=Math.min(e.j.length,n);var r=e.h?Qe(e.h.Va,e.h,e):null;e:{var s=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=t,0>n)t=Math.max(0,s[o].g-100),i=!1;else try{kr(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(i){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function cs(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;en||rn(),tn||(en(),tn=!0),nn.add(t,e),e.A=0}}function us(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=Sn(Qe(e.Ma,e),gs(e,e.A)),e.A++,0))}function hs(e){null!=e.B&&(Ue.clearTimeout(e.B),e.B=null)}function ls(e){e.g=new Pn(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=tr(e.wa);ir(t,"RID","rpc"),ir(t,"SID",e.K),ir(t,"AID",e.V),ir(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&ir(t,"TO",e.qa),ir(t,"TYPE","xmlhttp"),os(e,t),e.o&&e.s&&Jr(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=or(tr(t)),n.s=null,n.S=!0,jn(n,e)}function ds(e){null!=e.v&&(Ue.clearTimeout(e.v),e.v=null)}function fs(e,t){var n=null;if(e.g==t){ds(e),hs(e),e.g=null;var r=2}else{if(!Sr(e.i,t))return;n=t.F,Dr(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var s=e.C;Kt(r=vn(),new Tn(r,n)),ss(e)}else cs(e);else if(3==(s=t.o)||0==s&&0<t.ca||!(1==r&&function(e,t){return!(Tr(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=Sn(Qe(e.Na,e,t),gs(e,e.C)),e.C++,0)))}(e,t)||2==r&&us(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),s){case 1:ms(e,5);break;case 4:ms(e,10);break;case 3:ms(e,6);break;default:ms(e,2)}}function gs(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function ms(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=Qe(e.pb,e);n||(n=new er("//www.google.com/images/cleardot.gif"),Ue.location&&"http"==Ue.location.protocol||nr(n,"https"),or(n)),function(e,t){const n=new mn;if(Ue.Image){const r=new Image;r.onload=He(Rr,n,r,"TestLoadImage: loaded",!0,t),r.onerror=He(Rr,n,r,"TestLoadImage: error",!1,t),r.onabort=He(Rr,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=He(Rr,n,r,"TestLoadImage: timeout",!1,t),Ue.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else En(2);e.H=0,e.h&&e.h.za(t),ps(e),rs(e)}function ps(e){if(e.H=0,e.ma=[],e.h){const t=xr(e.i);0==t.length&&0==e.j.length||(Ze(e.ma,t),Ze(e.ma,e.j),e.i.i.length=0,Je(e.j),e.j.length=0),e.h.ya()}}function ys(e,t,n){var r=n instanceof er?tr(n):new er(n);if(""!=r.g)t&&(r.g=t+"."+r.g),rr(r,r.m);else{var s=Ue.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var i=new er(null);r&&nr(i,r),t&&(i.g=t),s&&rr(i,s),n&&(i.l=n),r=i}return n=e.F,t=e.Da,n&&t&&ir(r,n,t),ir(r,"VER",e.ra),os(e,r),r}function ws(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new Ur(new Or({ob:!0})):new Ur(e.va)).Oa(e.J),t}function vs(){}function bs(){if(ht&&!(10<=Number(vt)))throw Error("Environmental error: no available transport.")}function _s(e,t){Gt.call(this),this.g=new es(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!nt(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!nt(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Ts(this)}function Is(e){On.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Es(){Mn.call(this),this.status=1}function Ts(e){this.g=e}function Ss(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Cs(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var s=0;16>s;++s)r[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];var i=e.g[3],o=t+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=n+(o<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(t=n+((o=t+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(t^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+i&4294967295}function Ds(e,t){this.h=t;for(var n=[],r=!0,s=e.length-1;0<=s;s--){var i=0|e[s];r&&i==t||(n[s]=i,r=!1)}this.g=n}(Pe=Ur.prototype).Oa=function(e){this.M=e},Pe.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():kn.g(),this.C=this.u?An(this.u):An(kn),this.g.onreadystatechange=Qe(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void zr(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),s=Ue.FormData&&e instanceof Ue.FormData,!(0<=Xe($r,t))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Hr(this),0<this.B&&((this.L=function(e){return ht&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Qe(this.ua,this)):this.A=cn(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){zr(this,e)}},Pe.ua=function(){void 0!==Be&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Kt(this,"timeout"),this.abort(8))},Pe.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Kt(this,"complete"),Kt(this,"abort"),Qr(this))},Pe.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Qr(this,!0)),Ur.$.N.call(this)},Pe.La=function(){this.s||(this.G||this.v||this.l?Kr(this):this.kb())},Pe.kb=function(){Kr(this)},Pe.isActive=function(){return!!this.g},Pe.da=function(){try{return 2<Wr(this)?this.g.status:-1}catch(e){return-1}},Pe.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Pe.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Br(t)}},Pe.Ia=function(){return this.m},Pe.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Pe=es.prototype).ra=8,Pe.H=1,Pe.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const s=new Pn(this,this.l,e);let i=this.s;if(this.U&&(i?(i=Dt(i),At(i,this.U)):i=this.U),null!==this.o||this.O||(s.I=i,i=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=as(this,s,t),ir(n=tr(this.I),"RID",e),ir(n,"CVER",22),this.F&&ir(n,"X-HTTP-Session-Id",this.F),os(this,n),i&&(this.O?t="headers="+encodeURIComponent(String(Xr(i)))+"&"+t:this.o&&Jr(n,this.o,i)),Cr(this.i,s),this.bb&&ir(n,"TYPE","init"),this.P?(ir(n,"$req",t),ir(n,"SID","null"),s.aa=!0,qn(s,n,null)):qn(s,n,t),this.H=2}}else 3==this.H&&(e?is(this,e):0==this.j.length||Er(this.i)||is(this))},Pe.Ma=function(){if(this.u=null,ls(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Sn(Qe(this.jb,this),e)}},Pe.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,En(10),ns(this),ls(this))},Pe.ib=function(){null!=this.v&&(this.v=null,ns(this),us(this),En(19))},Pe.pb=function(e){e?(this.l.info("Successfully pinged google.com"),En(2)):(this.l.info("Failed to ping google.com"),En(1))},Pe.isActive=function(){return!!this.h&&this.h.isActive(this)},(Pe=vs.prototype).Ba=function(){},Pe.Aa=function(){},Pe.za=function(){},Pe.ya=function(){},Pe.isActive=function(){return!0},Pe.Va=function(){},bs.prototype.g=function(e,t){return new _s(e,t)},We(_s,Gt),_s.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;En(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=ys(e,null,e.Y),ss(e)},_s.prototype.close=function(){ts(this.g)},_s.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Ht(e),e=n);t.j.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.fb++,e)),3==t.H&&ss(t)},_s.prototype.N=function(){this.g.h=null,delete this.j,ts(this.g),delete this.g,_s.$.N.call(this)},We(Is,On),We(Es,Mn),We(Ts,vs),Ts.prototype.Ba=function(){Kt(this.g,"a")},Ts.prototype.Aa=function(e){Kt(this.g,new Is(e))},Ts.prototype.za=function(e){Kt(this.g,new Es)},Ts.prototype.ya=function(){Kt(this.g,"b")},We(Ss,(function(){this.blockSize=-1})),Ss.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ss.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,s=this.h,i=0;i<t;){if(0==s)for(;i<=n;)Cs(this,e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s++]=e.charCodeAt(i++),s==this.blockSize){Cs(this,r),s=0;break}}else for(;i<t;)if(r[s++]=e[i++],s==this.blockSize){Cs(this,r),s=0;break}}this.h=s,this.i+=t},Ss.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var xs={};function As(e){return-128<=e&&128>e?function(e,t){var n=xs;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new Ds([0|e],0>e?-1:0)}(e)}(e):new Ds([0|e],0>e?-1:0)}function Ns(e){if(isNaN(e)||!isFinite(e))return Rs;if(0>e)return Fs(Ns(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=ks;return new Ds(t,0)}var ks=4294967296,Rs=As(0),Os=As(1),Ms=As(16777216);function Ls(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function Ps(e){return-1==e.h}function Fs(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new Ds(n,~e.h).add(Os)}function Vs(e,t){return e.add(Fs(t))}function Bs(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Us(e,t){this.g=e,this.h=t}function qs(e,t){if(Ls(t))throw Error("division by zero");if(Ls(e))return new Us(Rs,Rs);if(Ps(e))return t=qs(Fs(e),t),new Us(Fs(t.g),Fs(t.h));if(Ps(t))return t=qs(e,Fs(t)),new Us(Fs(t.g),t.h);if(30<e.g.length){if(Ps(e)||Ps(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Os,r=t;0>=r.X(e);)n=js(n),r=js(r);var s=$s(n,1),i=$s(r,1);for(r=$s(r,2),n=$s(n,2);!Ls(r);){var o=i.add(r);0>=o.X(e)&&(s=s.add(n),i=o),r=$s(r,1),n=$s(n,1)}return t=Vs(e,s.R(t)),new Us(s,t)}for(s=Rs;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(i=Ns(n)).R(t);Ps(o)||0<o.X(e);)o=(i=Ns(n-=r)).R(t);Ls(i)&&(i=Os),s=s.add(i),e=Vs(e,o)}return new Us(s,e)}function js(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new Ds(n,e.h)}function $s(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],i=0;i<r;i++)s[i]=0<t?e.D(i+n)>>>t|e.D(i+n+1)<<32-t:e.D(i+n);return new Ds(s,e.h)}(Pe=Ds.prototype).ea=function(){if(Ps(this))return-Fs(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:ks+r)*t,t*=ks}return e},Pe.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(Ls(this))return"0";if(Ps(this))return"-"+Fs(this).toString(e);for(var t=Ns(Math.pow(e,6)),n=this,r="";;){var s=qs(n,t).g,i=((0<(n=Vs(n,s.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(Ls(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},Pe.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},Pe.X=function(e){return Ps(e=Vs(this,e))?-1:Ls(e)?0:1},Pe.abs=function(){return Ps(this)?Fs(this):this},Pe.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var i=r+(65535&this.D(s))+(65535&e.D(s)),o=(i>>>16)+(this.D(s)>>>16)+(e.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new Ds(n,-2147483648&n[n.length-1]?-1:0)},Pe.R=function(e){if(Ls(this)||Ls(e))return Rs;if(Ps(this))return Ps(e)?Fs(this).R(Fs(e)):Fs(Fs(this).R(e));if(Ps(e))return Fs(this.R(Fs(e)));if(0>this.X(Ms)&&0>e.X(Ms))return Ns(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var i=this.D(r)>>>16,o=65535&this.D(r),a=e.D(s)>>>16,c=65535&e.D(s);n[2*r+2*s]+=o*c,Bs(n,2*r+2*s),n[2*r+2*s+1]+=i*c,Bs(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,Bs(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,Bs(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new Ds(n,0)},Pe.gb=function(e){return qs(this,e).h},Pe.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new Ds(n,this.h&e.h)},Pe.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new Ds(n,this.h|e.h)},Pe.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new Ds(n,this.h^e.h)},bs.prototype.createWebChannel=bs.prototype.g,_s.prototype.send=_s.prototype.u,_s.prototype.open=_s.prototype.m,_s.prototype.close=_s.prototype.close,Cn.NO_ERROR=0,Cn.TIMEOUT=8,Cn.HTTP_ERROR=6,Dn.COMPLETE="complete",Nn.EventType=Rn,Rn.OPEN="a",Rn.CLOSE="b",Rn.ERROR="c",Rn.MESSAGE="d",Gt.prototype.listen=Gt.prototype.O,Ur.prototype.listenOnce=Ur.prototype.P,Ur.prototype.getLastError=Ur.prototype.Sa,Ur.prototype.getLastErrorCode=Ur.prototype.Ia,Ur.prototype.getStatus=Ur.prototype.da,Ur.prototype.getResponseJson=Ur.prototype.Wa,Ur.prototype.getResponseText=Ur.prototype.ja,Ur.prototype.send=Ur.prototype.ha,Ur.prototype.setWithCredentials=Ur.prototype.Oa,Ss.prototype.digest=Ss.prototype.l,Ss.prototype.reset=Ss.prototype.reset,Ss.prototype.update=Ss.prototype.j,Ds.prototype.add=Ds.prototype.add,Ds.prototype.multiply=Ds.prototype.R,Ds.prototype.modulo=Ds.prototype.gb,Ds.prototype.compare=Ds.prototype.X,Ds.prototype.toNumber=Ds.prototype.ea,Ds.prototype.toString=Ds.prototype.toString,Ds.prototype.getBits=Ds.prototype.D,Ds.fromNumber=Ns,Ds.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return Fs(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=Ns(Math.pow(n,8)),s=Rs,i=0;i<t.length;i+=8){var o=Math.min(8,t.length-i),a=parseInt(t.substring(i,i+o),n);8>o?(o=Ns(Math.pow(n,o)),s=s.R(o).add(Ns(a))):s=(s=s.R(r)).add(Ns(a))}return s};var zs=Ve.createWebChannelTransport=function(){return new bs},Gs=Ve.getStatEventTarget=function(){return vn()},Ks=Ve.ErrorCode=Cn,Qs=Ve.EventType=Dn,Hs=Ve.Event=yn,Ws=Ve.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ys=(Ve.FetchXmlHttpFactory=Or,Ve.WebChannel=Nn),Xs=Ve.XhrIo=Ur,Js=Ve.Md5=Ss,Zs=Ve.Integer=Ds;const ei="@firebase/firestore";class ti{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ti.UNAUTHENTICATED=new ti(null),ti.GOOGLE_CREDENTIALS=new ti("google-credentials-uid"),ti.FIRST_PARTY=new ti("first-party-uid"),ti.MOCK_USER=new ti("mock-user");let ni="10.3.0";const ri=new R("@firebase/firestore");function si(){return ri.logLevel}function ii(e,...t){if(ri.logLevel<=D.DEBUG){const n=t.map(ci);ri.debug(`Firestore (${ni}): ${e}`,...n)}}function oi(e,...t){if(ri.logLevel<=D.ERROR){const n=t.map(ci);ri.error(`Firestore (${ni}): ${e}`,...n)}}function ai(e,...t){if(ri.logLevel<=D.WARN){const n=t.map(ci);ri.warn(`Firestore (${ni}): ${e}`,...n)}}function ci(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function ui(e="Unexpected state"){const t=`FIRESTORE (${ni}) INTERNAL ASSERTION FAILED: `+e;throw oi(t),new Error(t)}function hi(e,t){e||ui()}function li(e,t){return e}const di={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class fi extends d{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class gi{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class mi{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class pi{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(ti.UNAUTHENTICATED)))}shutdown(){}}class yi{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class wi{constructor(e){this.t=e,this.currentUser=ti.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new gi;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new gi,e.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const t=s;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{ii("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(ii("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new gi)}}),0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(ii("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(hi("string"==typeof t.accessToken),new mi(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return hi(null===e||"string"==typeof e),new ti(e)}}class vi{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=ti.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class bi{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new vi(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(ti.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class _i{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ii{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&ii("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,ii("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{ii("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):ii("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(hi("string"==typeof e.token),this.R=e.token,new _i(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ei(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Ti{static V(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Ei(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Si(e,t){return e<t?-1:e>t?1:0}function Ci(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Di(e){return e+"\0"}class xi{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new fi(di.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new fi(di.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new fi(di.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new fi(di.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return xi.fromMillis(Date.now())}static fromDate(e){return xi.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new xi(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Si(this.nanoseconds,e.nanoseconds):Si(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ai{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ai(e)}static min(){return new Ai(new xi(0,0))}static max(){return new Ai(new xi(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ni{constructor(e,t,n){void 0===t?t=0:t>e.length&&ui(),void 0===n?n=e.length-t:n>e.length-t&&ui(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ni.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ni?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),s=t.get(r);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ki extends Ni{construct(e,t,n){return new ki(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new fi(di.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new ki(t)}static emptyPath(){return new ki([])}}const Ri=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Oi extends Ni{construct(e,t,n){return new Oi(e,t,n)}static isValidIdentifier(e){return Ri.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Oi.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Oi(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(0===n.length)throw new fi(di.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new fi(di.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new fi(di.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(s(),r++)}if(s(),i)throw new fi(di.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Oi(t)}static emptyPath(){return new Oi([])}}class Mi{constructor(e){this.path=e}static fromPath(e){return new Mi(ki.fromString(e))}static fromName(e){return new Mi(ki.fromString(e).popFirst(5))}static empty(){return new Mi(ki.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ki.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ki.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Mi(new ki(e.slice()))}}class Li{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Pi(e){return e.fields.find((e=>2===e.kind))}function Fi(e){return e.fields.filter((e=>2!==e.kind))}Li.UNKNOWN_ID=-1;class Vi{constructor(e,t){this.fieldPath=e,this.kind=t}}class Bi{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Bi(0,ji.min())}}function Ui(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,s=Ai.fromTimestamp(1e9===r?new xi(n+1,0):new xi(n,r));return new ji(s,Mi.empty(),t)}function qi(e){return new ji(e.readTime,e.key,-1)}class ji{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ji(Ai.min(),Mi.empty(),-1)}static max(){return new ji(Ai.max(),Mi.empty(),-1)}}function $i(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Mi.comparator(e.documentKey,t.documentKey),0!==n?n:Si(e.largestBatchId,t.largestBatchId))}const zi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Gi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Ki(e){if(e.code!==di.FAILED_PRECONDITION||e.message!==zi)throw e;ii("LocalStore","Unexpectedly lost primary lease")}class Qi{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ui(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Qi(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Qi?t:Qi.resolve(t)}catch(e){return Qi.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Qi.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Qi.reject(t)}static resolve(e){return new Qi(((t,n)=>{t(e)}))}static reject(e){return new Qi(((t,n)=>{n(e)}))}static waitFor(e){return new Qi(((t,n)=>{let r=0,s=0,i=!1;e.forEach((e=>{++r,e.next((()=>{++s,i&&s===r&&t()}),(e=>n(e)))})),i=!0,s===r&&t()}))}static or(e){let t=Qi.resolve(!1);for(const n of e)t=t.next((e=>e?Qi.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Qi(((n,r)=>{const s=e.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next((e=>{i[c]=e,++o,o===s&&n(i)}),(e=>r(e)))}}))}static doWhile(e,t){return new Qi(((n,r)=>{const s=()=>{!0===e()?t().next((()=>{s()}),r):n()};s()}))}}class Hi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.m=new gi,this.transaction.oncomplete=()=>{this.m.resolve()},this.transaction.onabort=()=>{t.error?this.m.reject(new Xi(e,t.error)):this.m.resolve()},this.transaction.onerror=t=>{const n=no(t.target.error);this.m.reject(new Xi(e,n))}}static open(e,t,n,r){try{return new Hi(t,e.transaction(r,n))}catch(e){throw new Xi(t,e)}}get g(){return this.m.promise}abort(e){e&&this.m.reject(e),this.aborted||(ii("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}p(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Zi(t)}}class Wi{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===Wi.D(h())&&oi("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ii("SimpleDb","Removing database:",e),eo(window.indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!l())return!1;if(Wi.C())return!0;const e=h(),t=Wi.D(e),n=0<t&&t<10,r=Wi.F(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.M)}static O(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static F(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async N(e){return this.db||(ii("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Xi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new fi(di.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new fi(di.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Xi(e,r))},r.onupgradeneeded=e=>{ii("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.S.B(t,r.transaction,e.oldVersion,this.version).next((()=>{ii("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db}k(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.N(e);const t=Hi.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).next((e=>(t.p(),e))).catch((e=>(t.abort(e),Qi.reject(e)))).toPromise();return i.catch((()=>{})),await t.g,i}catch(e){const t=e,n="FirebaseError"!==t.name&&i<3;if(ii("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Yi{constructor(e){this.q=e,this.K=!1,this.$=null}get isDone(){return this.K}get U(){return this.$}set cursor(e){this.q=e}done(){this.K=!0}W(e){this.$=e}delete(){return eo(this.q.delete())}}class Xi extends fi{constructor(e,t){super(di.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ji(e){return"IndexedDbTransactionError"===e.name}class Zi{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(ii("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(ii("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),eo(n)}add(e){return ii("SimpleDb","ADD",this.store.name,e,e),eo(this.store.add(e))}get(e){return eo(this.store.get(e)).next((t=>(void 0===t&&(t=null),ii("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return ii("SimpleDb","DELETE",this.store.name,e),eo(this.store.delete(e))}count(){return ii("SimpleDb","COUNT",this.store.name),eo(this.store.count())}G(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.j(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new Qi(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Qi(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}J(e,t){ii("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;const r=this.cursor(n);return this.j(r,((e,t,n)=>n.delete()))}Z(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.j(r,t)}X(e){const t=this.cursor({});return new Qi(((n,r)=>{t.onerror=e=>{const t=no(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}j(e,t){const n=[];return new Qi(((r,s)=>{e.onerror=e=>{s(e.target.error)},e.onsuccess=e=>{const s=e.target.result;if(!s)return void r();const i=new Yi(s),o=t(s.primaryKey,s.value,i);if(o instanceof Qi){const e=o.catch((e=>(i.done(),Qi.reject(e))));n.push(e)}i.isDone?r():null===i.U?s.continue():s.continue(i.U)}})).next((()=>Qi.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function eo(e){return new Qi(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=no(e.target.error);n(t)}}))}let to=!1;function no(e){const t=Wi.D(h());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new fi("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return to||(to=!0,setTimeout((()=>{throw e}),0)),e}}return e}class ro{constructor(e,t){this.asyncQueue=e,this.ee=t,this.task=null}start(){this.te(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}te(e){ii("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{ii("IndexBackiller",`Documents written: ${await this.ee.ne()}`)}catch(e){Ji(e)?ii("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await Ki(e)}await this.te(6e4)}))}}class so{constructor(e,t){this.localStore=e,this.persistence=t}async ne(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.re(t,e)))}re(e,t){const n=new Set;let r=t,s=!0;return Qi.doWhile((()=>!0===s&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return ii("IndexBackiller",`Processing collection: ${t}`),this.ie(e,t,r).next((e=>{r-=e,n.add(t)}));s=!1})))).next((()=>t-r))}ie(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const s=n.changes;return this.localStore.indexManager.updateIndexEntries(e,s).next((()=>this.se(r,n))).next((n=>(ii("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>s.size))}))))}se(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=qi(t);$i(r,n)>0&&(n=r)})),new ji(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class io{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.oe(e),this._e=e=>t.writeSequenceNumber(e))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}function oo(e){return null==e}function ao(e){return 0===e&&1/e==-1/0}function co(e){return"number"==typeof e&&Number.isInteger(e)&&!ao(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function uo(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=lo(t)),t=ho(e.get(n),t);return lo(t)}function ho(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function lo(e){return e+""}function fo(e){const t=e.length;if(hi(t>=2),2===t)return hi(""===e.charAt(0)&&""===e.charAt(1)),ki.emptyPath();const n=t-2,r=[];let s="";for(let i=0;i<t;){const t=e.indexOf("",i);switch((t<0||t>n)&&ui(),e.charAt(t+1)){case"":const n=e.substring(i,t);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"":s+=e.substring(i,t),s+="\0";break;case"":s+=e.substring(i,t+1);break;default:ui()}i=t+2}return new ki(r)}io.ae=-1;const go=["userId","batchId"];function mo(e,t){return[e,uo(t)]}function po(e,t,n){return[e,uo(t),n]}const yo={},wo=["prefixPath","collectionGroup","readTime","documentId"],vo=["prefixPath","collectionGroup","documentId"],bo=["collectionGroup","readTime","prefixPath","documentId"],_o=["canonicalId","targetId"],Io=["targetId","path"],Eo=["path","targetId"],To=["collectionId","parent"],So=["indexId","uid"],Co=["uid","sequenceNumber"],Do=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],xo=["indexId","uid","orderedDocumentKey"],Ao=["userId","collectionPath","documentId"],No=["userId","collectionPath","largestBatchId"],ko=["userId","collectionGroup","largestBatchId"],Ro=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Oo=[...Ro,"documentOverlays"],Mo=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Lo=Mo,Po=[...Lo,"indexConfiguration","indexState","indexEntries"];class Fo extends Gi{constructor(e,t){super(),this.ue=e,this.currentSequenceNumber=t}}function Vo(e,t){const n=li(e);return Wi.O(n.ue,t)}function Bo(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Uo(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function qo(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class jo{constructor(e,t){this.comparator=e,this.root=t||zo.EMPTY}insert(e,t){return new jo(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,zo.BLACK,null,null))}remove(e){return new jo(this.comparator,this.root.remove(e,this.comparator).copy(null,null,zo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new $o(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new $o(this.root,e,this.comparator,!1)}getReverseIterator(){return new $o(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new $o(this.root,e,this.comparator,!0)}}class $o{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class zo{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:zo.RED,this.left=null!=r?r:zo.EMPTY,this.right=null!=s?s:zo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new zo(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return zo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return zo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,zo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,zo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ui();if(this.right.isRed())throw ui();const e=this.left.check();if(e!==this.right.check())throw ui();return e+(this.isRed()?0:1)}}zo.EMPTY=null,zo.RED=!0,zo.BLACK=!1,zo.EMPTY=new class{constructor(){this.size=0}get key(){throw ui()}get value(){throw ui()}get color(){throw ui()}get left(){throw ui()}get right(){throw ui()}copy(e,t,n,r,s){return this}insert(e,t,n){return new zo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Go{constructor(e){this.comparator=e,this.data=new jo(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ko(this.data.getIterator())}getIteratorFrom(e){return new Ko(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Go))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Go(this.comparator);return t.data=e,t}}class Ko{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Qo(e){return e.hasNext()?e.getNext():void 0}class Ho{constructor(e){this.fields=e,e.sort(Oi.comparator)}static empty(){return new Ho([])}unionWith(e){let t=new Go(Oi.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ho(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ci(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Wo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Yo{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Wo("Invalid base64 string: "+e):e}}(e);return new Yo(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Yo(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Si(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Yo.EMPTY_BYTE_STRING=new Yo("");const Xo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Jo(e){if(hi(!!e),"string"==typeof e){let t=0;const n=Xo.exec(e);if(hi(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Zo(e.seconds),nanos:Zo(e.nanos)}}function Zo(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ea(e){return"string"==typeof e?Yo.fromBase64String(e):Yo.fromUint8Array(e)}function ta(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function na(e){const t=e.mapValue.fields.__previous_value__;return ta(t)?na(t):t}function ra(e){const t=Jo(e.mapValue.fields.__local_write_time__.timestampValue);return new xi(t.seconds,t.nanos)}class sa{constructor(e,t,n,r,s,i,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class ia{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ia("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ia&&e.projectId===this.projectId&&e.database===this.database}}const oa={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},aa={nullValue:"NULL_VALUE"};function ca(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ta(e)?4:Ia(e)?9007199254740991:10:ui()}function ua(e,t){if(e===t)return!0;const n=ca(e);if(n!==ca(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ra(e).isEqual(ra(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Jo(e.timestampValue),r=Jo(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ea(e.bytesValue).isEqual(ea(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Zo(e.geoPointValue.latitude)===Zo(t.geoPointValue.latitude)&&Zo(e.geoPointValue.longitude)===Zo(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Zo(e.integerValue)===Zo(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Zo(e.doubleValue),r=Zo(t.doubleValue);return n===r?ao(n)===ao(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Ci(e.arrayValue.values||[],t.arrayValue.values||[],ua);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Bo(n)!==Bo(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!ua(n[e],r[e])))return!1;return!0}(e,t);default:return ui()}}function ha(e,t){return void 0!==(e.values||[]).find((e=>ua(e,t)))}function la(e,t){if(e===t)return 0;const n=ca(e),r=ca(t);if(n!==r)return Si(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Si(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Zo(e.integerValue||e.doubleValue),r=Zo(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return da(e.timestampValue,t.timestampValue);case 4:return da(ra(e),ra(t));case 5:return Si(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ea(e),r=ea(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Si(n[e],r[e]);if(0!==t)return t}return Si(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Si(Zo(e.latitude),Zo(t.latitude));return 0!==n?n:Si(Zo(e.longitude),Zo(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=la(n[e],r[e]);if(t)return t}return Si(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===oa.mapValue&&t===oa.mapValue)return 0;if(e===oa.mapValue)return 1;if(t===oa.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let e=0;e<r.length&&e<i.length;++e){const t=Si(r[e],i[e]);if(0!==t)return t;const o=la(n[r[e]],s[i[e]]);if(0!==o)return o}return Si(r.length,i.length)}(e.mapValue,t.mapValue);default:throw ui()}}function da(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Si(e,t);const n=Jo(e),r=Jo(t),s=Si(n.seconds,r.seconds);return 0!==s?s:Si(n.nanos,r.nanos)}function fa(e){return ga(e)}function ga(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Jo(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return ea(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Mi.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=ga(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+=`${s}:${ga(e.fields[s])}`;return n+"}"}(e.mapValue):ui()}function ma(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function pa(e){return!!e&&"integerValue"in e}function ya(e){return!!e&&"arrayValue"in e}function wa(e){return!!e&&"nullValue"in e}function va(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ba(e){return!!e&&"mapValue"in e}function _a(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Uo(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=_a(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=_a(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Ia(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Ea(e){return"nullValue"in e?aa:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?ma(ia.empty(),Mi.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:ui()}function Ta(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?ma(ia.empty(),Mi.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?oa:ui()}function Sa(e,t){const n=la(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Ca(e,t){const n=la(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Da{constructor(e){this.value=e}static empty(){return new Da({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ba(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=_a(t)}setAll(e){let t=Oi.emptyPath(),n={},r=[];e.forEach(((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=s.popLast()}e?n[s.lastSegment()]=_a(e):r.push(s.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());ba(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ua(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];ba(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Uo(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Da(_a(this.value))}}function xa(e){const t=[];return Uo(e.fields,((e,n)=>{const r=new Oi([e]);if(ba(n)){const e=xa(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Ho(t)}class Aa{constructor(e,t,n,r,s,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new Aa(e,0,Ai.min(),Ai.min(),Ai.min(),Da.empty(),0)}static newFoundDocument(e,t,n,r){return new Aa(e,1,t,Ai.min(),n,r,0)}static newNoDocument(e,t){return new Aa(e,2,t,Ai.min(),Ai.min(),Da.empty(),0)}static newUnknownDocument(e,t){return new Aa(e,3,t,Ai.min(),Ai.min(),Da.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ai.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Da.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Da.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ai.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Aa&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Aa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Na{constructor(e,t){this.position=e,this.inclusive=t}}function ka(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(r=i.field.isKeyField()?Mi.comparator(Mi.fromName(o.referenceValue),n.key):la(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Ra(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ua(e.position[n],t.position[n]))return!1;return!0}class Oa{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ma(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class La{}class Pa extends La{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Ka(e,t,n):"array-contains"===t?new Ya(e,n):"in"===t?new Xa(e,n):"not-in"===t?new Ja(e,n):"array-contains-any"===t?new Za(e,n):new Pa(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Qa(e,n):new Ha(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(la(t,this.value)):null!==t&&ca(this.value)===ca(t)&&this.matchesComparison(la(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ui()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Fa extends La{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new Fa(e,t)}matches(e){return Va(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.le((e=>e.isInequality()));return null!==e?e.field:null}le(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Va(e){return"and"===e.op}function Ba(e){return"or"===e.op}function Ua(e){return qa(e)&&Va(e)}function qa(e){for(const t of e.filters)if(t instanceof Fa)return!1;return!0}function ja(e){if(e instanceof Pa)return e.field.canonicalString()+e.op.toString()+fa(e.value);if(Ua(e))return e.filters.map((e=>ja(e))).join(",");{const t=e.filters.map((e=>ja(e))).join(",");return`${e.op}(${t})`}}function $a(e,t){return e instanceof Pa?function(e,t){return t instanceof Pa&&e.op===t.op&&e.field.isEqual(t.field)&&ua(e.value,t.value)}(e,t):e instanceof Fa?function(e,t){return t instanceof Fa&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&$a(n,t.filters[r])),!0)}(e,t):void ui()}function za(e,t){const n=e.filters.concat(t);return Fa.create(n,e.op)}function Ga(e){return e instanceof Pa?function(e){return`${e.field.canonicalString()} ${e.op} ${fa(e.value)}`}(e):e instanceof Fa?function(e){return e.op.toString()+" {"+e.getFilters().map(Ga).join(" ,")+"}"}(e):"Filter"}class Ka extends Pa{constructor(e,t,n){super(e,t,n),this.key=Mi.fromName(n.referenceValue)}matches(e){const t=Mi.comparator(e.key,this.key);return this.matchesComparison(t)}}class Qa extends Pa{constructor(e,t){super(e,"in",t),this.keys=Wa(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Ha extends Pa{constructor(e,t){super(e,"not-in",t),this.keys=Wa(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Wa(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Mi.fromName(e.referenceValue)))}class Ya extends Pa{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ya(t)&&ha(t.arrayValue,this.value)}}class Xa extends Pa{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&ha(this.value.arrayValue,t)}}class Ja extends Pa{constructor(e,t){super(e,"not-in",t)}matches(e){if(ha(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!ha(this.value.arrayValue,t)}}class Za extends Pa{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ya(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>ha(this.value.arrayValue,e)))}}class ec{constructor(e,t=null,n=[],r=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.he=null}}function tc(e,t=null,n=[],r=[],s=null,i=null,o=null){return new ec(e,t,n,r,s,i,o)}function nc(e){const t=li(e);if(null===t.he){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>ja(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),oo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>fa(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>fa(e))).join(",")),t.he=e}return t.he}function rc(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Ma(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!$a(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ra(e.startAt,t.startAt)&&Ra(e.endAt,t.endAt)}function sc(e){return Mi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ic(e,t){return e.filters.filter((e=>e instanceof Pa&&e.field.isEqual(t)))}function oc(e,t,n){let r=aa,s=!0;for(const n of ic(e,t)){let e=aa,t=!0;switch(n.op){case"<":case"<=":e=Ea(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=aa}Sa({value:r,inclusive:s},{value:e,inclusive:t})<0&&(r=e,s=t)}if(null!==n)for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){const e=n.position[i];Sa({value:r,inclusive:s},{value:e,inclusive:n.inclusive})<0&&(r=e,s=n.inclusive);break}return{value:r,inclusive:s}}function ac(e,t,n){let r=oa,s=!0;for(const n of ic(e,t)){let e=oa,t=!0;switch(n.op){case">=":case">":e=Ta(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=oa}Ca({value:r,inclusive:s},{value:e,inclusive:t})>0&&(r=e,s=t)}if(null!==n)for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){const e=n.position[i];Ca({value:r,inclusive:s},{value:e,inclusive:n.inclusive})>0&&(r=e,s=n.inclusive);break}return{value:r,inclusive:s}}class cc{constructor(e,t=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.Pe=null,this.Ie=null,this.Te=null,this.startAt,this.endAt}}function uc(e,t,n,r,s,i,o,a){return new cc(e,t,n,r,s,i,o,a)}function hc(e){return new cc(e)}function lc(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function dc(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function fc(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function gc(e){return null!==e.collectionGroup}function mc(e){const t=li(e);if(null===t.Pe){t.Pe=[];const e=fc(t),n=dc(t);if(null!==e&&null===n)e.isKeyField()||t.Pe.push(new Oa(e)),t.Pe.push(new Oa(Oi.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.Pe.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.Pe.push(new Oa(Oi.keyField(),e))}}}return t.Pe}function pc(e){const t=li(e);return t.Ie||(t.Ie=function(e,t){if("F"===e.limitType)return tc(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Oa(e.field,t)}));const n=e.endAt?new Na(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Na(e.startAt.position,e.startAt.inclusive):null;return tc(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,mc(e))),t.Ie}function yc(e,t){t.getFirstInequalityField(),fc(e);const n=e.filters.concat([t]);return new cc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function wc(e,t,n){return new cc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function vc(e,t){return rc(pc(e),pc(t))&&e.limitType===t.limitType}function bc(e){return`${nc(pc(e))}|lt:${e.limitType}`}function _c(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Ga(e))).join(", ")}]`),oo(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>fa(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>fa(e))).join(",")),`Target(${t})`}(pc(e))}; limitType=${e.limitType})`}function Ic(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Mi.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of mc(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=ka(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,mc(e),t)||e.endAt&&!function(e,t,n){const r=ka(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,mc(e),t))}(e,t)}function Ec(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Tc(e){return(t,n)=>{let r=!1;for(const s of mc(e)){const e=Sc(s,t,n);if(0!==e)return e;r=r||s.field.isKeyField()}return 0}}function Sc(e,t,n){const r=e.field.isKeyField()?Mi.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),s=n.data.field(e);return null!==r&&null!==s?la(r,s):ui()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return ui()}}class Cc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Uo(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return qo(this.inner)}size(){return this.innerSize}}const Dc=new jo(Mi.comparator);function xc(){return Dc}const Ac=new jo(Mi.comparator);function Nc(...e){let t=Ac;for(const n of e)t=t.insert(n.key,n);return t}function kc(e){let t=Ac;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Rc(){return Mc()}function Oc(){return Mc()}function Mc(){return new Cc((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Lc=new jo(Mi.comparator),Pc=new Go(Mi.comparator);function Fc(...e){let t=Pc;for(const n of e)t=t.add(n);return t}const Vc=new Go(Si);function Bc(){return Vc}function Uc(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ao(t)?"-0":t}}function qc(e){return{integerValue:""+e}}function jc(e,t){return co(t)?qc(t):Uc(e,t)}class $c{constructor(){this._=void 0}}function zc(e,t,n){return e instanceof Qc?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ta(t)&&(t=na(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Hc?Wc(e,t):e instanceof Yc?Xc(e,t):function(e,t){const n=Kc(e,t),r=Zc(n)+Zc(e.Ee);return pa(n)&&pa(e.Ee)?qc(r):Uc(e.serializer,r)}(e,t)}function Gc(e,t,n){return e instanceof Hc?Wc(e,t):e instanceof Yc?Xc(e,t):n}function Kc(e,t){return e instanceof Jc?function(e){return pa(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Qc extends $c{}class Hc extends $c{constructor(e){super(),this.elements=e}}function Wc(e,t){const n=eu(t);for(const t of e.elements)n.some((e=>ua(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Yc extends $c{constructor(e){super(),this.elements=e}}function Xc(e,t){let n=eu(t);for(const t of e.elements)n=n.filter((e=>!ua(e,t)));return{arrayValue:{values:n}}}class Jc extends $c{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function Zc(e){return Zo(e.integerValue||e.doubleValue)}function eu(e){return ya(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class tu{constructor(e,t){this.field=e,this.transform=t}}class nu{constructor(e,t){this.version=e,this.transformResults=t}}class ru{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ru}static exists(e){return new ru(void 0,e)}static updateTime(e){return new ru(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function su(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class iu{}function ou(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new pu(e.key,ru.none()):new lu(e.key,e.data,ru.none());{const n=e.data,r=Da.empty();let s=new Go(Oi.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),s=s.add(e)}return new du(e.key,r,new Ho(s.toArray()),ru.none())}}function au(e,t,n){e instanceof lu?function(e,t,n){const r=e.value.clone(),s=gu(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof du?function(e,t,n){if(!su(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=gu(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(fu(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function cu(e,t,n,r){return e instanceof lu?function(e,t,n,r){if(!su(e.precondition,t))return n;const s=e.value.clone(),i=mu(e.fieldTransforms,r,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,r):e instanceof du?function(e,t,n,r){if(!su(e.precondition,t))return n;const s=mu(e.fieldTransforms,r,t),i=t.data;return i.setAll(fu(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return su(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function uu(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=Kc(r.transform,e||null);null!=s&&(null===n&&(n=Da.empty()),n.set(r.field,s))}return n||null}function hu(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Ci(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Hc&&t instanceof Hc||e instanceof Yc&&t instanceof Yc?Ci(e.elements,t.elements,ua):e instanceof Jc&&t instanceof Jc?ua(e.Ee,t.Ee):e instanceof Qc&&t instanceof Qc}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class lu extends iu{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class du extends iu{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function fu(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function gu(e,t,n){const r=new Map;hi(e.length===n.length);for(let s=0;s<n.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);r.set(i.field,Gc(o,a,n[s]))}return r}function mu(e,t,n){const r=new Map;for(const s of e){const e=s.transform,i=n.data.field(s.field);r.set(s.field,zc(e,i,t))}return r}class pu extends iu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class yu extends iu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class wu{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&au(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=cu(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=cu(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Oc();return this.mutations.forEach((r=>{const s=e.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=t.has(r.key)?null:o;const a=ou(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(Ai.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Fc())}isEqual(e){return this.batchId===e.batchId&&Ci(this.mutations,e.mutations,((e,t)=>hu(e,t)))&&Ci(this.baseMutations,e.baseMutations,((e,t)=>hu(e,t)))}}class vu{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){hi(e.mutations.length===n.length);let r=Lc;const s=e.mutations;for(let e=0;e<s.length;e++)r=r.insert(s[e].key,n[e].version);return new vu(e,t,n,r)}}class bu{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class _u{constructor(e,t){this.count=e,this.unchangedNames=t}}var Iu,Eu;function Tu(e){switch(e){default:return ui();case di.CANCELLED:case di.UNKNOWN:case di.DEADLINE_EXCEEDED:case di.RESOURCE_EXHAUSTED:case di.INTERNAL:case di.UNAVAILABLE:case di.UNAUTHENTICATED:return!1;case di.INVALID_ARGUMENT:case di.NOT_FOUND:case di.ALREADY_EXISTS:case di.PERMISSION_DENIED:case di.FAILED_PRECONDITION:case di.ABORTED:case di.OUT_OF_RANGE:case di.UNIMPLEMENTED:case di.DATA_LOSS:return!0}}function Su(e){if(void 0===e)return oi("GRPC error has no .code"),di.UNKNOWN;switch(e){case Iu.OK:return di.OK;case Iu.CANCELLED:return di.CANCELLED;case Iu.UNKNOWN:return di.UNKNOWN;case Iu.DEADLINE_EXCEEDED:return di.DEADLINE_EXCEEDED;case Iu.RESOURCE_EXHAUSTED:return di.RESOURCE_EXHAUSTED;case Iu.INTERNAL:return di.INTERNAL;case Iu.UNAVAILABLE:return di.UNAVAILABLE;case Iu.UNAUTHENTICATED:return di.UNAUTHENTICATED;case Iu.INVALID_ARGUMENT:return di.INVALID_ARGUMENT;case Iu.NOT_FOUND:return di.NOT_FOUND;case Iu.ALREADY_EXISTS:return di.ALREADY_EXISTS;case Iu.PERMISSION_DENIED:return di.PERMISSION_DENIED;case Iu.FAILED_PRECONDITION:return di.FAILED_PRECONDITION;case Iu.ABORTED:return di.ABORTED;case Iu.OUT_OF_RANGE:return di.OUT_OF_RANGE;case Iu.UNIMPLEMENTED:return di.UNIMPLEMENTED;case Iu.DATA_LOSS:return di.DATA_LOSS;default:return ui()}}(Eu=Iu||(Iu={}))[Eu.OK=0]="OK",Eu[Eu.CANCELLED=1]="CANCELLED",Eu[Eu.UNKNOWN=2]="UNKNOWN",Eu[Eu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Eu[Eu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Eu[Eu.NOT_FOUND=5]="NOT_FOUND",Eu[Eu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Eu[Eu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Eu[Eu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Eu[Eu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Eu[Eu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Eu[Eu.ABORTED=10]="ABORTED",Eu[Eu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Eu[Eu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Eu[Eu.INTERNAL=13]="INTERNAL",Eu[Eu.UNAVAILABLE=14]="UNAVAILABLE",Eu[Eu.DATA_LOSS=15]="DATA_LOSS";function Cu(){return new TextEncoder}const Du=new Zs([4294967295,4294967295],0);function xu(e){const t=Cu().encode(e),n=new Js;return n.update(t),new Uint8Array(n.digest())}function Au(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Zs([n,r],0),new Zs([s,i],0)]}class Nu{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ku(`Invalid padding: ${t}`);if(n<0)throw new ku(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new ku(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ku(`Invalid padding when bitmap length is 0: ${t}`);this.Ae=8*e.length-t,this.Re=Zs.fromNumber(this.Ae)}Ve(e,t,n){let r=e.add(t.multiply(Zs.fromNumber(n)));return 1===r.compare(Du)&&(r=new Zs([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Re).toNumber()}me(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ae)return!1;const t=xu(e),[n,r]=Au(t);for(let e=0;e<this.hashCount;e++){const t=this.Ve(n,r,e);if(!this.me(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),i=new Nu(s,r,t);return n.forEach((e=>i.insert(e))),i}insert(e){if(0===this.Ae)return;const t=xu(e),[n,r]=Au(t);for(let e=0;e<this.hashCount;e++){const t=this.Ve(n,r,e);this.fe(t)}}fe(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ku extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ru{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Ou.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ru(Ai.min(),r,new jo(Si),xc(),Fc())}}class Ou{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ou(n,t,Fc(),Fc(),Fc())}}class Mu{constructor(e,t,n,r){this.ge=e,this.removedTargetIds=t,this.key=n,this.pe=r}}class Lu{constructor(e,t){this.targetId=e,this.ye=t}}class Pu{constructor(e,t,n=Yo.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Fu{constructor(){this.we=0,this.Se=Uu(),this.be=Yo.EMPTY_BYTE_STRING,this.De=!1,this.ve=!0}get current(){return this.De}get resumeToken(){return this.be}get Ce(){return 0!==this.we}get Fe(){return this.ve}Me(e){e.approximateByteSize()>0&&(this.ve=!0,this.be=e)}xe(){let e=Fc(),t=Fc(),n=Fc();return this.Se.forEach(((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:ui()}})),new Ou(this.be,this.De,e,t,n)}Oe(){this.ve=!1,this.Se=Uu()}Ne(e,t){this.ve=!0,this.Se=this.Se.insert(e,t)}Be(e){this.ve=!0,this.Se=this.Se.remove(e)}Le(){this.we+=1}ke(){this.we-=1}qe(){this.ve=!0,this.De=!0}}class Vu{constructor(e){this.Qe=e,this.Ke=new Map,this.$e=xc(),this.Ue=Bu(),this.We=new jo(Si)}Ge(e){for(const t of e.ge)e.pe&&e.pe.isFoundDocument()?this.ze(t,e.pe):this.je(t,e.key,e.pe);for(const t of e.removedTargetIds)this.je(t,e.key,e.pe)}He(e){this.forEachTarget(e,(t=>{const n=this.Je(t);switch(e.state){case 0:this.Ye(t)&&n.Me(e.resumeToken);break;case 1:n.ke(),n.Ce||n.Oe(),n.Me(e.resumeToken);break;case 2:n.ke(),n.Ce||this.removeTarget(t);break;case 3:this.Ye(t)&&(n.qe(),n.Me(e.resumeToken));break;case 4:this.Ye(t)&&(this.Ze(t),n.Me(e.resumeToken));break;default:ui()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ke.forEach(((e,n)=>{this.Ye(n)&&t(n)}))}Xe(e){const t=e.targetId,n=e.ye.count,r=this.et(t);if(r){const s=r.target;if(sc(s))if(0===n){const e=new Mi(s.path);this.je(t,e,Aa.newNoDocument(e,Ai.min()))}else hi(1===n);else{const r=this.tt(t);if(r!==n){const n=this.nt(e),s=n?this.rt(n,e,r):1;if(0!==s){this.Ze(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.We=this.We.insert(t,e)}}}}}nt(e){const t=e.ye.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t;let i,o;try{i=ea(n).toUint8Array()}catch(e){if(e instanceof Wo)return ai("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Nu(i,r,s)}catch(e){return ai(e instanceof ku?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Ae?null:o}rt(e,t,n){return t.ye.count===n-this.ot(e,t.targetId)?0:2}ot(e,t){const n=this.Qe.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const s=this.Qe.st(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.je(t,n,null),r++)})),r}_t(e){const t=new Map;this.Ke.forEach(((n,r)=>{const s=this.et(r);if(s){if(n.current&&sc(s.target)){const t=new Mi(s.target.path);null!==this.$e.get(t)||this.ut(r,t)||this.je(r,t,Aa.newNoDocument(t,e))}n.Fe&&(t.set(r,n.xe()),n.Oe())}}));let n=Fc();this.Ue.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.et(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.$e.forEach(((t,n)=>n.setReadTime(e)));const r=new Ru(e,t,this.We,this.$e,n);return this.$e=xc(),this.Ue=Bu(),this.We=new jo(Si),r}ze(e,t){if(!this.Ye(e))return;const n=this.ut(e,t.key)?2:0;this.Je(e).Ne(t.key,n),this.$e=this.$e.insert(t.key,t),this.Ue=this.Ue.insert(t.key,this.ct(t.key).add(e))}je(e,t,n){if(!this.Ye(e))return;const r=this.Je(e);this.ut(e,t)?r.Ne(t,1):r.Be(t),this.Ue=this.Ue.insert(t,this.ct(t).delete(e)),n&&(this.$e=this.$e.insert(t,n))}removeTarget(e){this.Ke.delete(e)}tt(e){const t=this.Je(e).xe();return this.Qe.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Le(e){this.Je(e).Le()}Je(e){let t=this.Ke.get(e);return t||(t=new Fu,this.Ke.set(e,t)),t}ct(e){let t=this.Ue.get(e);return t||(t=new Go(Si),this.Ue=this.Ue.insert(e,t)),t}Ye(e){const t=null!==this.et(e);return t||ii("WatchChangeAggregator","Detected inactive target",e),t}et(e){const t=this.Ke.get(e);return t&&t.Ce?null:this.Qe.lt(e)}Ze(e){this.Ke.set(e,new Fu),this.Qe.getRemoteKeysForTarget(e).forEach((t=>{this.je(e,t,null)}))}ut(e,t){return this.Qe.getRemoteKeysForTarget(e).has(t)}}function Bu(){return new jo(Mi.comparator)}function Uu(){return new jo(Mi.comparator)}const qu={asc:"ASCENDING",desc:"DESCENDING"},ju={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},$u={and:"AND",or:"OR"};class zu{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Gu(e,t){return e.useProto3Json||oo(t)?t:{value:t}}function Ku(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Qu(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Hu(e,t){return Ku(e,t.toTimestamp())}function Wu(e){return hi(!!e),Ai.fromTimestamp(function(e){const t=Jo(e);return new xi(t.seconds,t.nanos)}(e))}function Yu(e,t){return function(e){return new ki(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Xu(e){const t=ki.fromString(e);return hi(vh(t)),t}function Ju(e,t){return Yu(e.databaseId,t.path)}function Zu(e,t){const n=Xu(t);if(n.get(1)!==e.databaseId.projectId)throw new fi(di.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new fi(di.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Mi(rh(n))}function eh(e,t){return Yu(e.databaseId,t)}function th(e){const t=Xu(e);return 4===t.length?ki.emptyPath():rh(t)}function nh(e){return new ki(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function rh(e){return hi(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function sh(e,t,n){return{name:Ju(e,t),fields:n.value.mapValue.fields}}function ih(e,t,n){const r=Zu(e,t.name),s=Wu(t.updateTime),i=t.createTime?Wu(t.createTime):Ai.min(),o=new Da({mapValue:{fields:t.fields}}),a=Aa.newFoundDocument(r,s,i,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function oh(e,t){let n;if(t instanceof lu)n={update:sh(e,t.key,t.value)};else if(t instanceof pu)n={delete:Ju(e,t.key)};else if(t instanceof du)n={update:sh(e,t.key,t.data),updateMask:wh(t.fieldMask)};else{if(!(t instanceof yu))return ui();n={verify:Ju(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Qc)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Hc)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Yc)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Jc)return{fieldPath:t.field.canonicalString(),increment:n.Ee};throw ui()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Hu(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:ui()}(e,t.precondition)),n}function ah(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?ru.updateTime(Wu(e.updateTime)):void 0!==e.exists?ru.exists(e.exists):ru.none()}(t.currentDocument):ru.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)hi("REQUEST_TIME"===t.setToServerValue),n=new Qc;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Hc(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Yc(e)}else"increment"in t?n=new Jc(e,t.increment):ui();const r=Oi.fromServerFormat(t.fieldPath);return new tu(r,n)}(e,t))):[];if(t.update){t.update.name;const s=Zu(e,t.update.name),i=new Da({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Ho(t.map((e=>Oi.fromServerFormat(e))))}(t.updateMask);return new du(s,i,e,n,r)}return new lu(s,i,n,r)}if(t.delete){const r=Zu(e,t.delete);return new pu(r,n)}if(t.verify){const r=Zu(e,t.verify);return new yu(r,n)}return ui()}function ch(e,t){return{documents:[eh(e,t.path)]}}function uh(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=eh(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=eh(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(e){if(0!==e.length)return yh(Fa.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const i=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:mh(e.field),direction:dh(e.dir)}}(e)))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);const o=Gu(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function hh(e){let t=th(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){hi(1===r);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=lh(e);return t instanceof Fa&&Ua(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new Oa(ph(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,oo(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Na(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Na(n,t)}(n.endAt)),uc(t,s,o,i,a,"F",c,u)}function lh(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ph(e.unaryFilter.field);return Pa.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=ph(e.unaryFilter.field);return Pa.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ph(e.unaryFilter.field);return Pa.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ph(e.unaryFilter.field);return Pa.create(s,"!=",{nullValue:"NULL_VALUE"});default:return ui()}}(e):void 0!==e.fieldFilter?function(e){return Pa.create(ph(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ui()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Fa.create(e.compositeFilter.filters.map((e=>lh(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return ui()}}(e.compositeFilter.op))}(e):ui()}function dh(e){return qu[e]}function fh(e){return ju[e]}function gh(e){return $u[e]}function mh(e){return{fieldPath:e.canonicalString()}}function ph(e){return Oi.fromServerFormat(e.fieldPath)}function yh(e){return e instanceof Pa?function(e){if("=="===e.op){if(va(e.value))return{unaryFilter:{field:mh(e.field),op:"IS_NAN"}};if(wa(e.value))return{unaryFilter:{field:mh(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(va(e.value))return{unaryFilter:{field:mh(e.field),op:"IS_NOT_NAN"}};if(wa(e.value))return{unaryFilter:{field:mh(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mh(e.field),op:fh(e.op),value:e.value}}}(e):e instanceof Fa?function(e){const t=e.getFilters().map((e=>yh(e)));return 1===t.length?t[0]:{compositeFilter:{op:gh(e.op),filters:t}}}(e):ui()}function wh(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function vh(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class bh{constructor(e,t,n,r,s=Ai.min(),i=Ai.min(),o=Yo.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new bh(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new bh(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new bh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new bh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class _h{constructor(e){this.ht=e}}function Ih(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Eh(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Ju(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Ku(e,t.version.toTimestamp()),createTime:Ku(e,t.createTime.toTimestamp())}}(e.ht,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Th(t.version)};else{if(!t.isUnknownDocument())return ui();r.unknownDocument={path:n.path.toArray(),version:Th(t.version)}}return r}function Eh(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Th(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Sh(e){const t=new xi(e.seconds,e.nanoseconds);return Ai.fromTimestamp(t)}function Ch(e,t){const n=(t.baseMutations||[]).map((t=>ah(e.ht,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>ah(e.ht,t))),s=xi.fromMillis(t.localWriteTimeMs);return new wu(t.batchId,s,n,r)}function Dh(e){const t=Sh(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Sh(e.lastLimboFreeSnapshotVersion):Ai.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){return hi(1===e.documents.length),pc(hc(th(e.documents[0])))}(e.query):function(e){return pc(hh(e))}(e.query),new bh(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,Yo.fromBase64String(e.resumeToken))}function xh(e,t){const n=Th(t.snapshotVersion),r=Th(t.lastLimboFreeSnapshotVersion);let s;s=sc(t.target)?ch(e.ht,t.target):uh(e.ht,t.target);const i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:nc(t.target),readTime:n,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Ah(e){const t=hh({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?wc(t,t.limit,"L"):t}function Nh(e,t){return new bu(t.largestBatchId,ah(e.ht,t.overlayMutation))}function kh(e,t){const n=t.path.lastSegment();return[e,uo(t.path.popLast()),n]}function Rh(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Th(r.readTime),documentKey:uo(r.documentKey.path),largestBatchId:r.largestBatchId}}class Oh{getBundleMetadata(e,t){return Mh(e).get(t).next((e=>{if(e)return function(e){return{id:e.bundleId,createTime:Sh(e.createTime),version:e.version}}(e)}))}saveBundleMetadata(e,t){return Mh(e).put(function(e){return{bundleId:e.id,createTime:Th(Wu(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return Lh(e).get(t).next((e=>{if(e)return function(e){return{name:e.name,query:Ah(e.bundledQuery),readTime:Sh(e.readTime)}}(e)}))}saveNamedQuery(e,t){return Lh(e).put(function(e){return{name:e.name,readTime:Th(Wu(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Mh(e){return Vo(e,"bundles")}function Lh(e){return Vo(e,"namedQueries")}class Ph{constructor(e,t){this.serializer=e,this.userId=t}static Pt(e,t){const n=t.uid||"";return new Ph(e,n)}getOverlay(e,t){return Fh(e).get(kh(this.userId,t)).next((e=>e?Nh(this.serializer,e):null))}getOverlays(e,t){const n=Rc();return Qi.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,s)=>{const i=new bu(t,s);r.push(this.It(e,i))})),Qi.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(uo(e.getCollectionPath()))));const s=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);s.push(Fh(e).J("collectionPathOverlayIndex",r))})),Qi.waitFor(s)}getOverlaysForCollection(e,t,n){const r=Rc(),s=uo(t),i=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Fh(e).G("collectionPathOverlayIndex",i).next((e=>{for(const t of e){const e=Nh(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const s=Rc();let i;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Fh(e).Z({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=Nh(this.serializer,t);s.size()<r||o.largestBatchId===i?(s.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((()=>s))}It(e,t){return Fh(e).put(function(e,t,n){const[r,s,i]=kh(t,n.mutation.key);return{userId:t,collectionPath:s,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:oh(e.ht,n.mutation)}}(this.serializer,this.userId,t))}}function Fh(e){return Vo(e,"documentOverlays")}class Vh{constructor(){}Tt(e,t){this.Et(e,t),t.dt()}Et(e,t){if("nullValue"in e)this.At(t,5);else if("booleanValue"in e)this.At(t,10),t.Rt(e.booleanValue?1:0);else if("integerValue"in e)this.At(t,15),t.Rt(Zo(e.integerValue));else if("doubleValue"in e){const n=Zo(e.doubleValue);isNaN(n)?this.At(t,13):(this.At(t,15),ao(n)?t.Rt(0):t.Rt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.At(t,20),"string"==typeof n?t.Vt(n):(t.Vt(`${n.seconds||""}`),t.Rt(n.nanos||0))}else if("stringValue"in e)this.ft(e.stringValue,t),this.gt(t);else if("bytesValue"in e)this.At(t,30),t.yt(ea(e.bytesValue)),this.gt(t);else if("referenceValue"in e)this.wt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.At(t,45),t.Rt(n.latitude||0),t.Rt(n.longitude||0)}else"mapValue"in e?Ia(e)?this.At(t,Number.MAX_SAFE_INTEGER):(this.St(e.mapValue,t),this.gt(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.gt(t)):ui()}ft(e,t){this.At(t,25),this.Dt(e,t)}Dt(e,t){t.Vt(e)}St(e,t){const n=e.fields||{};this.At(t,55);for(const e of Object.keys(n))this.ft(e,t),this.Et(n[e],t)}bt(e,t){const n=e.values||[];this.At(t,50);for(const e of n)this.Et(e,t)}wt(e,t){this.At(t,37),Mi.fromName(e).path.forEach((e=>{this.At(t,60),this.Dt(e,t)}))}At(e,t){e.Rt(t)}gt(e){e.Rt(2)}}function Bh(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function Uh(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=Bh(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}Vh.vt=new Vh;class qh{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Bt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ft(e);else if(e<2048)this.Ft(960|e>>>6),this.Ft(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e);else{const e=t.codePointAt(0);this.Ft(240|e>>>18),this.Ft(128|63&e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e)}}this.Mt()}Lt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ot(e);else if(e<2048)this.Ot(960|e>>>6),this.Ot(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|e>>>12),this.Ot(128|63&e>>>6),this.Ot(128|63&e);else{const e=t.codePointAt(0);this.Ot(240|e>>>18),this.Ot(128|63&e>>>12),this.Ot(128|63&e>>>6),this.Ot(128|63&e)}}this.Nt()}kt(e){const t=this.qt(e),n=Uh(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Kt(e){const t=this.qt(e),n=Uh(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ft(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class jh{constructor(e){this.jt=e}yt(e){this.jt.Ct(e)}Vt(e){this.jt.Bt(e)}Rt(e){this.jt.kt(e)}dt(){this.jt.$t()}}class $h{constructor(e){this.jt=e}yt(e){this.jt.xt(e)}Vt(e){this.jt.Lt(e)}Rt(e){this.jt.Kt(e)}dt(){this.jt.Wt()}}class zh{constructor(){this.jt=new qh,this.Ht=new jh(this.jt),this.Jt=new $h(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class Gh{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Zt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Gh(this.indexId,this.documentKey,this.arrayValue,n)}}function Kh(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=Qh(e.arrayValue,t.arrayValue),0!==n?n:(n=Qh(e.directionalValue,t.directionalValue),0!==n?n:Mi.comparator(e.documentKey,t.documentKey)))}function Qh(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Hh{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Xt=e.orderBy,this.en=[];for(const t of e.filters){const e=t;e.isInequality()?this.tn=e:this.en.push(e)}}nn(e){hi(e.collectionGroup===this.collectionId);const t=Pi(e);if(void 0!==t&&!this.rn(t))return!1;const n=Fi(e);let r=new Set,s=0,i=0;for(;s<n.length&&this.rn(n[s]);++s)r=r.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(void 0!==this.tn){if(!r.has(this.tn.field.canonicalString())){const e=n[s];if(!this.sn(this.tn,e)||!this.on(this.Xt[i++],e))return!1}++s}for(;s<n.length;++s){const e=n[s];if(i>=this.Xt.length||!this.on(this.Xt[i++],e))return!1}return!0}rn(e){for(const t of this.en)if(this.sn(t,e))return!0;return!1}sn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}on(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Wh(e){var t,n;if(hi(e instanceof Pa||e instanceof Fa),e instanceof Pa){if(e instanceof Xa){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>Pa.create(e.field,"==",t))))||[];return Fa.create(r,"or")}return e}const r=e.filters.map((e=>Wh(e)));return Fa.create(r,e.op)}function Yh(e){if(0===e.getFilters().length)return[];const t=el(Wh(e));return hi(Zh(t)),Xh(t)||Jh(t)?[t]:t.getFilters()}function Xh(e){return e instanceof Pa}function Jh(e){return e instanceof Fa&&Ua(e)}function Zh(e){return Xh(e)||Jh(e)||function(e){if(e instanceof Fa&&Ba(e)){for(const t of e.getFilters())if(!Xh(t)&&!Jh(t))return!1;return!0}return!1}(e)}function el(e){if(hi(e instanceof Pa||e instanceof Fa),e instanceof Pa)return e;if(1===e.filters.length)return el(e.filters[0]);const t=e.filters.map((e=>el(e)));let n=Fa.create(t,e.op);return n=rl(n),Zh(n)?n:(hi(n instanceof Fa),hi(Va(n)),hi(n.filters.length>1),n.filters.reduce(((e,t)=>tl(e,t))))}function tl(e,t){let n;return hi(e instanceof Pa||e instanceof Fa),hi(t instanceof Pa||t instanceof Fa),n=e instanceof Pa?t instanceof Pa?function(e,t){return Fa.create([e,t],"and")}(e,t):nl(e,t):t instanceof Pa?nl(t,e):function(e,t){if(hi(e.filters.length>0&&t.filters.length>0),Va(e)&&Va(t))return za(e,t.getFilters());const n=Ba(e)?e:t,r=Ba(e)?t:e,s=n.filters.map((e=>tl(e,r)));return Fa.create(s,"or")}(e,t),rl(n)}function nl(e,t){if(Va(t))return za(t,e.getFilters());{const n=t.filters.map((t=>tl(e,t)));return Fa.create(n,"or")}}function rl(e){if(hi(e instanceof Pa||e instanceof Fa),e instanceof Pa)return e;const t=e.getFilters();if(1===t.length)return rl(t[0]);if(qa(e))return e;const n=t.map((e=>rl(e))),r=[];return n.forEach((t=>{t instanceof Pa?r.push(t):t instanceof Fa&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:Fa.create(r,e.op)}class sl{constructor(){this._n=new il}addToCollectionParentIndex(e,t){return this._n.add(t),Qi.resolve()}getCollectionParents(e,t){return Qi.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return Qi.resolve()}deleteFieldIndex(e,t){return Qi.resolve()}getDocumentsMatchingTarget(e,t){return Qi.resolve(null)}getIndexType(e,t){return Qi.resolve(0)}getFieldIndexes(e,t){return Qi.resolve([])}getNextCollectionGroupToUpdate(e){return Qi.resolve(null)}getMinOffset(e,t){return Qi.resolve(ji.min())}getMinOffsetFromCollectionGroup(e,t){return Qi.resolve(ji.min())}updateCollectionGroup(e,t,n){return Qi.resolve()}updateIndexEntries(e,t){return Qi.resolve()}}class il{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Go(ki.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Go(ki.comparator)).toArray()}}const ol=new Uint8Array(0);class al{constructor(e,t){this.user=e,this.databaseId=t,this.an=new il,this.un=new Cc((e=>nc(e)),((e,t)=>rc(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.an.add(t)}));const s={collectionId:n,parent:uo(r)};return cl(e).put(s)}return Qi.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Di(t),""],!1,!0);return cl(e).G(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(fo(r.parent))}return n}))}addFieldIndex(e,t){const n=hl(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const s=n.add(r);if(t.indexState){const n=ll(e);return s.next((e=>{n.put(Rh(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return s.next()}deleteFieldIndex(e,t){const n=hl(e),r=ll(e),s=ul(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=ul(e);let r=!0;const s=new Map;return Qi.forEach(this.cn(t),(t=>this.ln(e,t).next((e=>{r&&(r=!!e),s.set(t,e)})))).next((()=>{if(r){let e=Fc();const r=[];return Qi.forEach(s,((s,i)=>{ii("IndexedDbIndexManager",`Using index ${function(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`}(s)} to execute ${nc(t)}`);const o=function(e,t){const n=Pi(t);if(void 0===n)return null;for(const t of ic(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(i,s),a=function(e,t){const n=new Map;for(const r of Fi(t))for(const t of ic(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(i,s),c=function(e,t){const n=[];let r=!0;for(const s of Fi(t)){const t=0===s.kind?oc(e,s.fieldPath,e.startAt):ac(e,s.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new Na(n,r)}(i,s),u=function(e,t){const n=[];let r=!0;for(const s of Fi(t)){const t=0===s.kind?ac(e,s.fieldPath,e.endAt):oc(e,s.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new Na(n,r)}(i,s),h=this.hn(s,i,c),l=this.hn(s,i,u),d=this.Pn(s,i,a),f=this.In(s.indexId,o,h,c.inclusive,l,u.inclusive,d);return Qi.forEach(f,(s=>n.H(s,t.limit).next((t=>{t.forEach((t=>{const n=Mi.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return Qi.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:Yh(Fa.create(e.filters,"and")).map((t=>tc(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}In(e,t,n,r,s,i,o){const a=(null!=t?t.length:1)*Math.max(n.length,s.length),c=a/(null!=t?t.length:1),u=[];for(let h=0;h<a;++h){const a=t?this.Tn(t[h/c]):ol,l=this.En(e,a,n[h%c],r),d=this.dn(e,a,s[h%c],i),f=o.map((t=>this.En(e,a,t,!0)));u.push(...this.createRange(l,d,f))}return u}En(e,t,n,r){const s=new Gh(e,Mi.empty(),t,n);return r?s:s.Zt()}dn(e,t,n,r){const s=new Gh(e,Mi.empty(),t,n);return r?s.Zt():s}ln(e,t){const n=new Hh(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.nn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return Qi.forEach(r,(t=>this.ln(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new Go(Oi.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}An(e,t){const n=new zh;for(const r of Fi(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const s=n.Yt(r.kind);Vh.vt.Tt(e,s)}return n.zt()}Tn(e){const t=new zh;return Vh.vt.Tt(e,t.Yt(0)),t.zt()}Rn(e,t){const n=new zh;return Vh.vt.Tt(ma(this.databaseId,t),n.Yt(function(e){const t=Fi(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.zt()}Pn(e,t,n){if(null===n)return[];let r=[];r.push(new zh);let s=0;for(const i of Fi(e)){const e=n[s++];for(const n of r)if(this.Vn(t,i.fieldPath)&&ya(e))r=this.mn(r,i,e);else{const t=n.Yt(i.kind);Vh.vt.Tt(e,t)}}return this.fn(r)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}mn(e,t,n){const r=[...e],s=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new zh;r.seed(n.zt()),Vh.vt.Tt(e,r.Yt(t.kind)),s.push(r)}return s}Vn(e,t){return!!e.filters.find((e=>e instanceof Pa&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=hl(e),r=ll(e);return(t?n.G("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.G()).next((e=>{const t=[];return Qi.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new Bi(t.sequenceNumber,new ji(Sh(t.readTime),new Mi(fo(t.documentKey)),t.largestBatchId)):Bi.empty(),r=e.fields.map((([e,t])=>new Vi(Oi.fromServerFormat(e),t)));return new Li(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Si(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=hl(e),s=ll(e);return this.gn(e).next((e=>r.G("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>Qi.forEach(t,(t=>s.put(Rh(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return Qi.forEach(t,((t,r)=>{const s=n.get(t.collectionGroup);return(s?Qi.resolve(s):this.getFieldIndexes(e,t.collectionGroup)).next((s=>(n.set(t.collectionGroup,s),Qi.forEach(s,(n=>this.pn(e,t,n).next((t=>{const s=this.yn(r,n);return t.isEqual(s)?Qi.resolve():this.wn(e,r,n,t,s)})))))))}))}Sn(e,t,n,r){return ul(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,r){return ul(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){const r=ul(e);let s=new Go(Kh);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},((e,r)=>{s=s.add(new Gh(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>s))}yn(e,t){let n=new Go(Kh);const r=this.An(t,e);if(null==r)return n;const s=Pi(t);if(null!=s){const i=e.data.field(s.fieldPath);if(ya(i))for(const s of i.arrayValue.values||[])n=n.add(new Gh(t.indexId,e.key,this.Tn(s),r))}else n=n.add(new Gh(t.indexId,e.key,ol,r));return n}wn(e,t,n,r,s){ii("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const i=[];return function(e,t,n,r,s){const i=e.getIterator(),o=t.getIterator();let a=Qo(i),c=Qo(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=Qo(o)):t?(s(a),a=Qo(i)):(a=Qo(i),c=Qo(o))}}(r,s,Kh,(r=>{i.push(this.Sn(e,t,n,r))}),(r=>{i.push(this.bn(e,t,n,r))})),Qi.waitFor(i)}gn(e){let t=1;return ll(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Kh(e,t))).filter(((e,t,n)=>!t||0!==Kh(e,n[t-1])));const r=[];r.push(e);for(const s of n){const n=Kh(s,e),i=Kh(s,t);if(0===n)r[0]=e.Zt();else if(n>0&&i<0)r.push(s),r.push(s.Zt());else if(i>0)break}r.push(t);const s=[];for(let e=0;e<r.length;e+=2){if(this.Dn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,ol,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,ol,[]];s.push(IDBKeyRange.bound(t,n))}return s}Dn(e,t){return Kh(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(dl)}getMinOffset(e,t){return Qi.mapArray(this.cn(t),(t=>this.ln(e,t).next((e=>e||ui())))).next(dl)}}function cl(e){return Vo(e,"collectionParents")}function ul(e){return Vo(e,"indexEntries")}function hl(e){return Vo(e,"indexConfiguration")}function ll(e){return Vo(e,"indexState")}function dl(e){hi(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const s=e[r].indexState.offset;$i(s,t)<0&&(t=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new ji(t.readTime,t.documentKey,n)}const fl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class gl{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new gl(e,gl.DEFAULT_COLLECTION_PERCENTILE,gl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ml(e,t,n){const r=e.store("mutations"),s=e.store("documentMutations"),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Z({range:o},((e,t,n)=>(a++,n.delete())));i.push(c.next((()=>{hi(1===a)})));const u=[];for(const e of n.mutations){const r=po(t,e.key.path,n.batchId);i.push(s.delete(r)),u.push(e.key)}return Qi.waitFor(i).next((()=>u))}function pl(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw ui();t=e.noDocument}return JSON.stringify(t).length}gl.DEFAULT_COLLECTION_PERCENTILE=10,gl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gl.DEFAULT=new gl(41943040,gl.DEFAULT_COLLECTION_PERCENTILE,gl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gl.DISABLED=new gl(-1,0,0);class yl{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.vn={}}static Pt(e,t,n,r){hi(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new yl(s,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return vl(e).Z({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const s=bl(e),i=vl(e);return i.add({}).next((o=>{hi("number"==typeof o);const a=new wu(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>oh(e.ht,t))),s=n.mutations.map((t=>oh(e.ht,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:s}}(this.serializer,this.userId,a),u=[];let h=new Go(((e,t)=>Si(e.canonicalString(),t.canonicalString())));for(const e of r){const t=po(this.userId,e.key.path,o);h=h.add(e.key.path.popLast()),u.push(i.put(c)),u.push(s.put(t,yo))}return h.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.vn[o]=a.keys()})),Qi.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return vl(e).get(t).next((e=>e?(hi(e.userId===this.userId),Ch(this.serializer,e)):null))}Cn(e,t){return this.vn[t]?Qi.resolve(this.vn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.vn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return vl(e).Z({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(hi(t.batchId>=n),s=Ch(this.serializer,t)),r.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return vl(e).Z({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return vl(e).G("userMutationsIndex",t).next((e=>e.map((e=>Ch(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=mo(this.userId,t.path),r=IDBKeyRange.lowerBound(n),s=[];return bl(e).Z({range:r},((n,r,i)=>{const[o,a,c]=n,u=fo(a);if(o===this.userId&&t.path.isEqual(u))return vl(e).get(c).next((e=>{if(!e)throw ui();hi(e.userId===this.userId),s.push(Ch(this.serializer,e))}));i.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Go(Si);const r=[];return t.forEach((t=>{const s=mo(this.userId,t.path),i=IDBKeyRange.lowerBound(s),o=bl(e).Z({range:i},((e,r,s)=>{const[i,o,a]=e,c=fo(o);i===this.userId&&t.path.isEqual(c)?n=n.add(a):s.done()}));r.push(o)})),Qi.waitFor(r).next((()=>this.Fn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,s=mo(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new Go(Si);return bl(e).Z({range:i},((e,t,s)=>{const[i,a,c]=e,u=fo(a);i===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):s.done()})).next((()=>this.Fn(e,o)))}Fn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(vl(e).get(t).next((e=>{if(null===e)throw ui();hi(e.userId===this.userId),n.push(Ch(this.serializer,e))})))})),Qi.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return ml(e.ue,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Mn(t.batchId)})),Qi.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Mn(e){delete this.vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Qi.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return bl(e).Z({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=fo(e[1]);r.push(t)}else n.done()})).next((()=>{hi(0===r.length)}))}))}containsKey(e,t){return wl(e,this.userId,t)}xn(e){return _l(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function wl(e,t,n){const r=mo(t,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return bl(e).Z({range:i,Y:!0},((e,n,r)=>{const[i,a,c]=e;i===t&&a===s&&(o=!0),r.done()})).next((()=>o))}function vl(e){return Vo(e,"mutations")}function bl(e){return Vo(e,"documentMutations")}function _l(e){return Vo(e,"mutationQueues")}class Il{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Il(0)}static Bn(){return new Il(-1)}}class El{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next((t=>{const n=new Il(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Ln(e).next((e=>Ai.fromTimestamp(new xi(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Ln(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Ln(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.kn(e,r))))}addTargetData(e,t){return this.qn(e,t).next((()=>this.Ln(e).next((n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Tl(e).delete(t.targetId))).next((()=>this.Ln(e))).next((t=>(hi(t.targetCount>0),t.targetCount-=1,this.kn(e,t))))}removeTargets(e,t,n){let r=0;const s=[];return Tl(e).Z(((i,o)=>{const a=Dh(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,s.push(this.removeTargetData(e,a)))})).next((()=>Qi.waitFor(s))).next((()=>r))}forEachTarget(e,t){return Tl(e).Z(((e,n)=>{const r=Dh(n);t(r)}))}Ln(e){return Sl(e).get("targetGlobalKey").next((e=>(hi(null!==e),e)))}kn(e,t){return Sl(e).put("targetGlobalKey",t)}qn(e,t){return Tl(e).put(xh(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Ln(e).next((e=>e.targetCount))}getTargetData(e,t){const n=nc(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Tl(e).Z({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const i=Dh(n);rc(t,i.target)&&(s=i,r.done())})).next((()=>s))}addMatchingKeys(e,t,n){const r=[],s=Cl(e);return t.forEach((t=>{const i=uo(t.path);r.push(s.put({targetId:n,path:i})),r.push(this.referenceDelegate.addReference(e,n,t))})),Qi.waitFor(r)}removeMatchingKeys(e,t,n){const r=Cl(e);return Qi.forEach(t,(t=>{const s=uo(t.path);return Qi.waitFor([r.delete([n,s]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Cl(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Cl(e);let s=Fc();return r.Z({range:n,Y:!0},((e,t,n)=>{const r=fo(e[1]),i=new Mi(r);s=s.add(i)})).next((()=>s))}containsKey(e,t){const n=uo(t.path),r=IDBKeyRange.bound([n],[Di(n)],!1,!0);let s=0;return Cl(e).Z({index:"documentTargetsIndex",Y:!0,range:r},(([e,t],n,r)=>{0!==e&&(s++,r.done())})).next((()=>s>0))}lt(e,t){return Tl(e).get(t).next((e=>e?Dh(e):null))}}function Tl(e){return Vo(e,"targets")}function Sl(e){return Vo(e,"targetGlobal")}function Cl(e){return Vo(e,"targetDocuments")}function Dl([e,t],[n,r]){const s=Si(e,n);return 0===s?Si(t,r):s}class xl{constructor(e){this.Kn=e,this.buffer=new Go(Dl),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Dl(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Al{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){ii("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ji(e)?ii("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Ki(e)}await this.zn(3e5)}))}}class Nl{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Qi.resolve(io.ae);const n=new xl(t);return this.jn.forEachTarget(e,(e=>n.Wn(e.sequenceNumber))).next((()=>this.jn.Jn(e,(e=>n.Wn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(ii("LruGarbageCollector","Garbage collection skipped; disabled"),Qi.resolve(fl)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(ii("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fl):this.Yn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,r,s,i,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(ii("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,i=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(s=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),si()<=D.DEBUG&&ii("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-u}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Qi.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:e}))))}}class kl{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Nl(e,t)}(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Zn(e){let t=0;return this.Jn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,((e,n)=>t(n)))}addReference(e,t,n){return Rl(e,n)}removeReference(e,t,n){return Rl(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Rl(e,t)}er(e,t){return function(e,t){let n=!1;return _l(e).X((r=>wl(e,r,t).next((e=>(e&&(n=!0),Qi.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Xn(e,((i,o)=>{if(o<=t){const t=this.er(e,i).next((t=>{if(!t)return s++,n.getEntry(e,i).next((()=>(n.removeEntry(i,Ai.min()),Cl(e).delete(function(e){return[0,uo(e.path)]}(i)))))}));r.push(t)}})).next((()=>Qi.waitFor(r))).next((()=>n.apply(e))).next((()=>s))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Rl(e,t)}Xn(e,t){const n=Cl(e);let r,s=io.ae;return n.Z({index:"documentTargetsIndex"},(([e,n],{path:i,sequenceNumber:o})=>{0===e?(s!==io.ae&&t(new Mi(fo(r)),s),s=o,r=i):s=io.ae})).next((()=>{s!==io.ae&&t(new Mi(fo(r)),s)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Rl(e,t){return Cl(e).put(function(e,t){return{targetId:0,path:uo(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class Ol{constructor(){this.changes=new Cc((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Aa.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Qi.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ml{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Vl(e).put(n)}removeEntry(e,t,n){return Vl(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Eh(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.tr(e,n))))}getEntry(e,t){let n=Aa.newInvalidDocument(t);return Vl(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Bl(t))},((e,r)=>{n=this.nr(t,r)})).next((()=>n))}rr(e,t){let n={size:0,document:Aa.newInvalidDocument(t)};return Vl(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Bl(t))},((e,r)=>{n={document:this.nr(t,r),size:pl(r)}})).next((()=>n))}getEntries(e,t){let n=xc();return this.ir(e,t,((e,t)=>{const r=this.nr(e,t);n=n.insert(e,r)})).next((()=>n))}sr(e,t){let n=xc(),r=new jo(Mi.comparator);return this.ir(e,t,((e,t)=>{const s=this.nr(e,t);n=n.insert(e,s),r=r.insert(e,pl(t))})).next((()=>({documents:n,_r:r})))}ir(e,t,n){if(t.isEmpty())return Qi.resolve();let r=new Go(ql);t.forEach((e=>r=r.add(e)));const s=IDBKeyRange.bound(Bl(r.first()),Bl(r.last())),i=r.getIterator();let o=i.getNext();return Vl(e).Z({index:"documentKeyIndex",range:s},((e,t,r)=>{const s=Mi.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&ql(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,t),o=i.hasNext()?i.getNext():null),o?r.W(Bl(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r){const s=t.path,i=[s.popLast().toArray(),s.lastSegment(),Eh(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Vl(e).G(IDBKeyRange.bound(i,o,!0)).next((e=>{let n=xc();for(const s of e){const e=this.nr(Mi.fromSegments(s.prefixPath.concat(s.collectionGroup,s.documentId)),s);e.isFoundDocument()&&(Ic(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let s=xc();const i=Ul(t,n),o=Ul(t,ji.max());return Vl(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(i,o,!0)},((e,t,n)=>{const i=this.nr(Mi.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(i.key,i),s.size===r&&n.done()})).next((()=>s))}newChangeBuffer(e){return new Pl(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return Fl(e).get("remoteDocumentGlobalKey").next((e=>(hi(!!e),e)))}tr(e,t){return Fl(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=ih(e.ht,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=Mi.fromSegments(t.noDocument.path),r=Sh(t.noDocument.readTime);n=Aa.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return ui();{const e=Mi.fromSegments(t.unknownDocument.path),r=Sh(t.unknownDocument.version);n=Aa.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new xi(e[0],e[1]);return Ai.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(Ai.min()))return e}return Aa.newInvalidDocument(e)}}function Ll(e){return new Ml(e)}class Pl extends Ol{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new Cc((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new Go(((e,t)=>Si(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((s,i)=>{const o=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,o.readTime)),i.isValidDocument()){const a=Ih(this.ar.serializer,i);r=r.add(s.path.popLast());const c=pl(a);n+=c-o.size,t.push(this.ar.addEntry(e,s,a))}else if(n-=o.size,this.trackRemovals){const n=Ih(this.ar.serializer,i.convertToNoDocument(Ai.min()));t.push(this.ar.addEntry(e,s,n))}})),r.forEach((n=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.ar.updateMetadata(e,n)),Qi.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next((e=>(this.ur.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.ar.sr(e,t).next((({documents:e,_r:t})=>(t.forEach(((t,n)=>{this.ur.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function Fl(e){return Vo(e,"remoteDocumentGlobal")}function Vl(e){return Vo(e,"remoteDocumentsV14")}function Bl(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Ul(e,t){const n=t.documentKey.path.toArray();return[e,Eh(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function ql(e,t){const n=e.path.toArray(),r=t.path.toArray();let s=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(s=Si(n[e],r[e]),s)return s;return s=Si(n.length,r.length),s||(s=Si(n[n.length-2],r[r.length-2]),s||Si(n[n.length-1],r[r.length-1]))}class jl{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class $l{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&cu(n.mutation,e,Ho.empty(),xi.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Fc()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Fc()){const r=Rc();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Nc();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Rc();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Fc())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let s=xc();const i=Mc(),o=Mc();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof du)?s=s.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),cu(o.mutation,t,o.mutation.getFieldMask(),xi.now())):i.set(t.key,Ho.empty())})),this.recalculateAndSaveOverlays(e,s).next((e=>(e.forEach(((e,t)=>i.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new jl(t,null!==(n=i.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Mc();let r=new jo(((e,t)=>e-t)),s=Fc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const s of e)s.keys().forEach((e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||Ho.empty();o=s.applyToLocalView(i,o),n.set(e,o);const a=(r.get(s.batchId)||Fc()).add(e);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Oc();c.forEach((e=>{if(!s.has(e)){const r=ou(t.get(e),n.get(e));null!==r&&u.set(e,r),s=s.add(e)}})),i.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Qi.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return Mi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gc(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):Qi.resolve(Rc());let o=-1,a=s;return i.next((t=>Qi.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?Qi.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,s))).next((()=>this.computeViews(e,a,t,Fc()))).next((e=>({batchId:o,changes:kc(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Mi(t)).next((e=>{let t=Nc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let s=Nc();return this.indexManager.getCollectionParents(e,r).next((i=>Qi.forEach(i,(i=>{const o=function(e,t){return new cc(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,i.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)))).next((e=>{r.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Aa.newInvalidDocument(r)))}));let n=Nc();return e.forEach(((e,s)=>{const i=r.get(e);void 0!==i&&cu(i.mutation,s,Ho.empty(),xi.now()),Ic(t,s)&&(n=n.insert(e,s))})),n}))}}class zl{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return Qi.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Wu(e.createTime)}}(t)),Qi.resolve()}getNamedQuery(e,t){return Qi.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:Ah(e.bundledQuery),readTime:Wu(e.readTime)}}(t)),Qi.resolve()}}class Gl{constructor(){this.overlays=new jo(Mi.comparator),this.hr=new Map}getOverlay(e,t){return Qi.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Rc();return Qi.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.It(e,t,r)})),Qi.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),Qi.resolve()}getOverlaysForCollection(e,t,n){const r=Rc(),s=t.length+1,i=new Mi(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Qi.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new jo(((e,t)=>e-t));const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=Rc(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Rc(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Qi.resolve(o)}It(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new bu(t,n));let s=this.hr.get(t);void 0===s&&(s=Fc(),this.hr.set(t,s)),this.hr.set(t,s.add(n.key))}}class Kl{constructor(){this.Pr=new Go(Ql.Ir),this.Tr=new Go(Ql.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new Ql(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new Ql(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new Mi(new ki([])),n=new Ql(t,e),r=new Ql(t,e+1),s=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),s.push(e.key)})),s}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new Mi(new ki([])),n=new Ql(t,e),r=new Ql(t,e+1);let s=Fc();return this.Tr.forEachInRange([n,r],(e=>{s=s.add(e.key)})),s}containsKey(e){const t=new Ql(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Ql{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return Mi.comparator(e.key,t.key)||Si(e.pr,t.pr)}static Er(e,t){return Si(e.pr,t.pr)||Mi.comparator(e.key,t.key)}}class Hl{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Go(Ql.Ir)}checkEmpty(e){return Qi.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new wu(s,t,n,r);this.mutationQueue.push(i);for(const t of r)this.wr=this.wr.add(new Ql(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Qi.resolve(i)}lookupMutationBatch(e,t){return Qi.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),s=r<0?0:r;return Qi.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Qi.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return Qi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Ql(t,0),r=new Ql(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);s.push(t)})),Qi.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Go(Si);return t.forEach((e=>{const t=new Ql(e,0),r=new Ql(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),Qi.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;Mi.isDocumentKey(s)||(s=s.child(""));const i=new Ql(new Mi(s),0);let o=new Go(Si);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),i),Qi.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){hi(0===this.vr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Qi.forEach(t.mutations,(r=>{const s=new Ql(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new Ql(t,0),r=this.wr.firstAfterOrEqual(n);return Qi.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Qi.resolve()}vr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Wl{constructor(e){this.Cr=e,this.docs=new jo(Mi.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.Cr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Qi.resolve(n?n.document.mutableCopy():Aa.newInvalidDocument(t))}getEntries(e,t){let n=xc();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Aa.newInvalidDocument(e))})),Qi.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=xc();const i=t.path,o=new Mi(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||$i(qi(o),n)<=0||(r.has(o.key)||Ic(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Qi.resolve(s)}getAllFromCollectionGroup(e,t,n,r){ui()}Fr(e,t){return Qi.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Yl(this)}getSize(e){return Qi.resolve(this.size)}}class Yl extends Ol{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),Qi.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Xl{constructor(e){this.persistence=e,this.Mr=new Cc((e=>nc(e)),rc),this.lastRemoteSnapshotVersion=Ai.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Kl,this.targetCount=0,this.Br=Il.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),Qi.resolve()}getLastRemoteSnapshotVersion(e){return Qi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Qi.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),Qi.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Qi.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new Il(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,Qi.resolve()}updateTargetData(e,t){return this.qn(t),Qi.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Qi.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.Mr.forEach(((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Qi.waitFor(s).next((()=>r))}getTargetCount(e){return Qi.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return Qi.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),Qi.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach((t=>{s.push(r.markPotentiallyOrphaned(e,t))})),Qi.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),Qi.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return Qi.resolve(n)}containsKey(e,t){return Qi.resolve(this.Nr.containsKey(t))}}class Jl{constructor(e,t){this.Lr={},this.overlays={},this.kr=new io(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Xl(this),this.indexManager=new sl,this.remoteDocumentCache=function(e){return new Wl(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new _h(t),this.$r=new zl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Gl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Lr[e.toKey()];return n||(n=new Hl(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){ii("MemoryPersistence","Starting transaction:",e);const r=new Zl(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return Qi.or(Object.values(this.Lr).map((n=>()=>n.containsKey(e,t))))}}class Zl extends Gi{constructor(e){super(),this.currentSequenceNumber=e}}class ed{constructor(e){this.persistence=e,this.zr=new Kl,this.jr=null}static Hr(e){return new ed(e)}get Jr(){if(this.jr)return this.jr;throw ui()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Qi.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Qi.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),Qi.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Qi.forEach(this.Jr,(n=>{const r=Mi.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,Ai.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return Qi.or([()=>Qi.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class td{constructor(e){this.serializer=e}B(e,t,n,r){const s=new Hi("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",go,{unique:!0}),e.createObjectStore("documentMutations")}(e),nd(e),function(e){e.createObjectStore("remoteDocuments")}(e));let i=Qi.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),nd(e)),i=i.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ai.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(s)))),n<4&&r>=4&&(0!==n&&(i=i.next((()=>function(e,t){return t.store("mutations").G().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",go,{unique:!0});const r=t.store("mutations"),s=n.map((e=>r.put(e)));return Qi.waitFor(s)}))}(e,s)))),i=i.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(i=i.next((()=>this.Xr(s)))),n<6&&r>=6&&(i=i.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s))))),n<7&&r>=7&&(i=i.next((()=>this.ti(s)))),n<8&&r>=8&&(i=i.next((()=>this.ni(e,s)))),n<9&&r>=9&&(i=i.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(i=i.next((()=>this.ri(s)))),n<11&&r>=11&&(i=i.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(i=i.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:Ao});t.createIndex("collectionPathOverlayIndex",No,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",ko,{unique:!1})}(e)}))),n<13&&r>=13&&(i=i.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:wo});t.createIndex("documentKeyIndex",vo),t.createIndex("collectionGroupIndex",bo)}(e))).next((()=>this.ii(e,s))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(i=i.next((()=>this.si(e,s)))),n<15&&r>=15&&(i=i.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:So}).createIndex("sequenceNumberIndex",Co,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Do}).createIndex("documentKeyIndex",xo,{unique:!1})}(e)))),i}ei(e){let t=0;return e.store("remoteDocuments").Z(((e,n)=>{t+=pl(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Xr(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.G().next((t=>Qi.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.G("userMutationsIndex",r).next((n=>Qi.forEach(n,(n=>{hi(n.userId===t.userId);const r=Ch(this.serializer,n);return ml(e,t.userId,r).next((()=>{}))}))))}))))}ti(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.Z(((n,s)=>{const i=new ki(n),o=function(e){return[0,uo(e)]}(i);r.push(t.get(o).next((n=>n?Qi.resolve():(n=>t.put({targetId:0,path:uo(n),sequenceNumber:e.highestListenSequenceNumber}))(i))))})).next((()=>Qi.waitFor(r)))}))}ni(e,t){e.createObjectStore("collectionParents",{keyPath:To});const n=t.store("collectionParents"),r=new il,s=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:uo(r)})}};return t.store("remoteDocuments").Z({Y:!0},((e,t)=>{const n=new ki(e);return s(n.popLast())})).next((()=>t.store("documentMutations").Z({Y:!0},(([e,t,n],r)=>{const i=fo(t);return s(i.popLast())}))))}ri(e){const t=e.store("targets");return t.Z(((e,n)=>{const r=Dh(n),s=xh(this.serializer,r);return t.put(s)}))}ii(e,t){const n=t.store("remoteDocuments"),r=[];return n.Z(((e,n)=>{const s=t.store("remoteDocumentsV14"),i=function(e){return e.document?new Mi(ki.fromString(e.document.name).popFirst(5)):e.noDocument?Mi.fromSegments(e.noDocument.path):e.unknownDocument?Mi.fromSegments(e.unknownDocument.path):ui()}(n).path.toArray(),o={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(s.put(o))})).next((()=>Qi.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=Ll(this.serializer),s=new Jl(ed.Hr,this.serializer.ht);return n.G().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:Fc();Ch(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),Qi.forEach(n,((e,n)=>{const i=new ti(n),o=Ph.Pt(this.serializer,i),a=s.getIndexManager(i),c=yl.Pt(i,this.serializer,a,s.referenceDelegate);return new $l(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new Fo(t,io.ae),e).next()}))}))}}function nd(e){e.createObjectStore("targetDocuments",{keyPath:Io}).createIndex("documentTargetsIndex",Eo,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",_o,{unique:!0}),e.createObjectStore("targetGlobal")}const rd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class sd{constructor(e,t,n,r,s,i,o,a,c,u,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=s,this.window=i,this.document=o,this._i=c,this.ai=u,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=e=>Promise.resolve(),!sd.v())throw new fi(di.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new kl(this,r),this.Ti=t+"main",this.serializer=new _h(a),this.Ei=new Wi(this.Ti,this.ui,new td(this.serializer)),this.Qr=new El(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ll(this.serializer),this.$r=new Oh,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===u&&oi("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new fi(di.FAILED_PRECONDITION,rd);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Qr.getHighestSequenceNumber(e)))})).then((e=>{this.kr=new io(e,this._i)})).then((()=>{this.qr=!0})).catch((e=>(this.Ei&&this.Ei.close(),Promise.reject(e))))}fi(e){return this.Ii=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.k((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((async()=>{this.started&&await this.Ai()})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>od(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.gi(e).next((e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))))}))})).next((()=>this.pi(e))).next((t=>this.isPrimary&&!t?this.yi(e).next((()=>!1)):!!t&&this.wi(e).next((()=>!0)))))).catch((e=>{if(Ji(e))return ii("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ii("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.oi.enqueueRetryable((()=>this.Ii(e))),this.isPrimary=e}))}gi(e){return id(e).get("owner").next((e=>Qi.resolve(this.Si(e))))}bi(e){return od(e).delete(this.clientId)}async Di(){if(this.isPrimary&&!this.vi(this.Pi,18e5)){this.Pi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Vo(e,"clientMetadata");return t.G().next((e=>{const n=this.Ci(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return Qi.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.di)for(const t of e)this.di.removeItem(this.Fi(t.clientId))}}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ai().then((()=>this.Di())).then((()=>this.mi()))))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?Qi.resolve(!0):id(e).get("owner").next((t=>{if(null!==t&&this.vi(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new fi(di.FAILED_PRECONDITION,rd);return!1}}return!(!this.networkEnabled||!this.inForeground)||od(e).G().next((e=>void 0===this.Ci(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&ii("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),await this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new Fo(e,io.ae);return this.yi(t).next((()=>this.bi(t)))})),this.Ei.close(),this.Bi()}Ci(e,t){return e.filter((e=>this.vi(e.updateTimeMs,t)&&!this.Mi(e.clientId)))}Li(){return this.runTransaction("getActiveClients","readonly",(e=>od(e).G().next((e=>this.Ci(e,18e5).map((e=>e.clientId))))))}get started(){return this.qr}getMutationQueue(e,t){return yl.Pt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new al(e,this.serializer.ht.databaseId)}getDocumentOverlayCache(e){return Ph.Pt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){ii("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",s=function(e){return 15===e?Po:14===e?Lo:13===e?Mo:12===e?Oo:11===e?Ro:void ui()}(this.ui);let i;return this.Ei.runTransaction(e,r,s,(r=>(i=new Fo(r,this.kr?this.kr.next():io.ae),"readwrite-primary"===t?this.gi(i).next((e=>!!e||this.pi(i))).next((t=>{if(!t)throw oi(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))),new fi(di.FAILED_PRECONDITION,zi);return n(i)})).next((e=>this.wi(i).next((()=>e)))):this.ki(i).next((()=>n(i)))))).then((e=>(i.raiseOnCommittedEvent(),e)))}ki(e){return id(e).get("owner").next((e=>{if(null!==e&&this.vi(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new fi(di.FAILED_PRECONDITION,rd)}))}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return id(e).put("owner",t)}static v(){return Wi.v()}yi(e){const t=id(e);return t.get("owner").next((e=>this.Si(e)?(ii("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Qi.resolve()))}vi(e,t){const n=Date.now();return!(e<n-t||e>n&&(oi(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai())))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;!function(){var t;const n=null===(t=a())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return ii("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return oi("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){oi("Failed to set zombie client id.",e)}}Bi(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch(e){}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function id(e){return Vo(e,"owner")}function od(e){return Vo(e,"clientMetadata")}function ad(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class cd{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=Fc(),r=Fc();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new cd(e,t.fromCache,n,r)}}class ud{constructor(){this.$i=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Wi(e,t).next((s=>s||this.Gi(e,t,r,n))).next((n=>n||this.zi(e,t)))}Wi(e,t){if(lc(t))return Qi.resolve(null);let n=pc(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=wc(t,null,"F"),n=pc(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const s=Fc(...r);return this.Ui.getDocuments(e,s).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const i=this.ji(t,r);return this.Hi(t,i,s,n.readTime)?this.Wi(e,wc(t,null,"F")):this.Ji(e,i,t,n)}))))})))))}Gi(e,t,n,r){return lc(t)||r.isEqual(Ai.min())?this.zi(e,t):this.Ui.getDocuments(e,n).next((s=>{const i=this.ji(t,s);return this.Hi(t,i,n,r)?this.zi(e,t):(si()<=D.DEBUG&&ii("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),_c(t)),this.Ji(e,i,t,Ui(r,-1)))}))}ji(e,t){let n=new Go(Tc(e));return t.forEach(((t,r)=>{Ic(e,r)&&(n=n.add(r))})),n}Hi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}zi(e,t){return si()<=D.DEBUG&&ii("QueryEngine","Using full collection scan to execute query:",_c(t)),this.Ui.getDocumentsMatchingQuery(e,t,ji.min())}Ji(e,t,n,r){return this.Ui.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class hd{constructor(e,t,n,r){this.persistence=e,this.Yi=t,this.serializer=r,this.Zi=new jo(Si),this.Xi=new Cc((e=>nc(e)),rc),this.es=new Map,this.ts=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this.ns(n)}ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new $l(this.ts,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ts.setIndexManager(this.indexManager),this.Yi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Zi)))}}function ld(e,t,n,r){return new hd(e,t,n,r)}async function dd(e,t){const n=li(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((s=>(r=s,n.ns(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const s=[],i=[];let o=Fc();for(const e of r){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({rs:e,removedBatchIds:s,addedBatchIds:i})))}))}))}function fd(e){const t=li(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function gd(e,t,n){let r=Fc(),s=Fc();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=xc();return n.forEach(((n,i)=>{const o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(Ai.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):ii("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{ss:r,os:s}}))}function md(e,t){const n=li(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function pd(e,t){const n=li(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((s=>s?(r=s,Qi.resolve(r)):n.Qr.allocateTargetId(e).next((s=>(r=new bh(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Zi.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Zi=n.Zi.insert(e.targetId,e),n.Xi.set(t,e.targetId)),e}))}async function yd(e,t,n){const r=li(e),s=r.Zi.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(e=>r.persistence.referenceDelegate.removeTarget(e,s)))}catch(e){if(!Ji(e))throw e;ii("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Zi=r.Zi.remove(t),r.Xi.delete(s.target)}function wd(e,t,n){const r=li(e);let s=Ai.min(),i=Fc();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=li(e),s=r.Xi.get(n);return void 0!==s?Qi.resolve(r.Zi.get(s)):r.Qr.getTargetData(t,n)}(r,e,pc(t)).next((t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{i=e}))})).next((()=>r.Yi.getDocumentsMatchingQuery(e,t,n?s:Ai.min(),n?i:Fc()))).next((e=>(_d(r,Ec(t),e),{documents:e,_s:i})))))}function vd(e,t){const n=li(e),r=li(n.Qr),s=n.Zi.get(t);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.lt(e,t).next((e=>e?e.target:null))))}function bd(e,t){const n=li(e),r=n.es.get(t)||Ai.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.ts.getAllFromCollectionGroup(e,t,Ui(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(_d(n,t,e),e)))}function _d(e,t,n){let r=e.es.get(t)||Ai.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.es.set(t,r)}async function Id(e,t,n=Fc()){const r=await pd(e,pc(Ah(t.bundledQuery))),s=li(e);return s.persistence.runTransaction("Save named query","readwrite",(e=>{const i=Wu(t.readTime);if(r.snapshotVersion.compareTo(i)>=0)return s.$r.saveNamedQuery(e,t);const o=r.withResumeToken(Yo.EMPTY_BYTE_STRING,i);return s.Zi=s.Zi.insert(o.targetId,o),s.Qr.updateTargetData(e,o).next((()=>s.Qr.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>s.Qr.addMatchingKeys(e,n,r.targetId))).next((()=>s.$r.saveNamedQuery(e,t)))}))}function Ed(e,t){return`firestore_clients_${e}_${t}`}function Td(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Sd(e,t){return`firestore_targets_${e}_${t}`}class Cd{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static hs(e,t,n){const r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new fi(r.error.code,r.error.message))),i?new Cd(e,t,r.state,s):(oi("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ps(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Dd{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static hs(e,t){const n=JSON.parse(t);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new fi(n.error.code,n.error.message))),s?new Dd(e,n.state,r):(oi("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Ps(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class xd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static hs(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=Bc();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=co(n.activeTargetIds[e]),s=s.add(n.activeTargetIds[e]);return r?new xd(e,s):(oi("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ad{constructor(e,t){this.clientId=e,this.onlineState=t}static hs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ad(t.clientId,t.onlineState):(oi("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Nd{constructor(){this.activeTargetIds=Bc()}Is(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ts(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ps(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class kd{constructor(e,t,n,r,s){this.window=e,this.oi=t,this.persistenceKey=n,this.Es=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ds=this.As.bind(this),this.Rs=new jo(Si),this.started=!1,this.Vs=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.fs=Ed(this.persistenceKey,this.Es),this.gs=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Rs=this.Rs.insert(this.Es,new Nd),this.ps=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.ys=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.ws=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.Ss=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.bs=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.ds)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Li();for(const t of e){if(t===this.Es)continue;const e=this.getItem(Ed(this.persistenceKey,t));if(e){const n=xd.hs(t,e);n&&(this.Rs=this.Rs.insert(n.clientId,n))}}this.Ds();const t=this.storage.getItem(this.Ss);if(t){const e=this.vs(t);e&&this.Cs(e)}for(const e of this.Vs)this.As(e);this.Vs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.gs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Fs(this.Rs)}isActiveQueryTarget(e){let t=!1;return this.Rs.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Ms(e,"pending")}updateMutationState(e,t,n){this.Ms(e,t,n),this.xs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Sd(this.persistenceKey,e));if(n){const r=Dd.hs(e,n);r&&(t=r.state)}}return this.Os.Is(e),this.Ds(),t}removeLocalQueryTarget(e){this.Os.Ts(e),this.Ds()}isLocalQueryTarget(e){return this.Os.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Sd(this.persistenceKey,e))}updateQueryState(e,t,n){this.Ns(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.xs(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Bs(e)}notifyBundleLoaded(e){this.Ls(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ds),this.removeItem(this.fs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ii("SharedClientState","READ",e,t),t}setItem(e,t){ii("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ii("SharedClientState","REMOVE",e),this.storage.removeItem(e)}As(e){const t=e;if(t.storageArea===this.storage){if(ii("SharedClientState","EVENT",t.key,t.newValue),t.key===this.fs)return void oi("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.ps.test(t.key)){if(null==t.newValue){const e=this.ks(t.key);return this.qs(e,null)}{const e=this.Qs(t.key,t.newValue);if(e)return this.qs(e.clientId,e)}}else if(this.ys.test(t.key)){if(null!==t.newValue){const e=this.Ks(t.key,t.newValue);if(e)return this.$s(e)}}else if(this.ws.test(t.key)){if(null!==t.newValue){const e=this.Us(t.key,t.newValue);if(e)return this.Ws(e)}}else if(t.key===this.Ss){if(null!==t.newValue){const e=this.vs(t.newValue);if(e)return this.Cs(e)}}else if(t.key===this.gs){const e=function(e){let t=io.ae;if(null!=e)try{const n=JSON.parse(e);hi("number"==typeof n),t=n}catch(e){oi("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==io.ae&&this.sequenceNumberHandler(e)}else if(t.key===this.bs){const e=this.Gs(t.newValue);await Promise.all(e.map((e=>this.syncEngine.zs(e))))}}else this.Vs.push(t)}))}}get Os(){return this.Rs.get(this.Es)}Ds(){this.setItem(this.fs,this.Os.Ps())}Ms(e,t,n){const r=new Cd(this.currentUser,e,t,n),s=Td(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Ps())}xs(e){const t=Td(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Bs(e){const t={clientId:this.Es,onlineState:e};this.storage.setItem(this.Ss,JSON.stringify(t))}Ns(e,t,n){const r=Sd(this.persistenceKey,e),s=new Dd(e,t,n);this.setItem(r,s.Ps())}Ls(e){const t=JSON.stringify(Array.from(e));this.setItem(this.bs,t)}ks(e){const t=this.ps.exec(e);return t?t[1]:null}Qs(e,t){const n=this.ks(e);return xd.hs(n,t)}Ks(e,t){const n=this.ys.exec(e),r=Number(n[1]),s=void 0!==n[2]?n[2]:null;return Cd.hs(new ti(s),r,t)}Us(e,t){const n=this.ws.exec(e),r=Number(n[1]);return Dd.hs(r,t)}vs(e){return Ad.hs(e)}Gs(e){return JSON.parse(e)}async $s(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.js(e.batchId,e.state,e.error);ii("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Ws(e){return this.syncEngine.Hs(e.targetId,e.state,e.error)}qs(e,t){const n=t?this.Rs.insert(e,t):this.Rs.remove(e),r=this.Fs(this.Rs),s=this.Fs(n),i=[],o=[];return s.forEach((e=>{r.has(e)||i.push(e)})),r.forEach((e=>{s.has(e)||o.push(e)})),this.syncEngine.Js(i,o).then((()=>{this.Rs=n}))}Cs(e){this.Rs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Fs(e){let t=Bc();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class Rd{constructor(){this.Ys=new Nd,this.Zs={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Ys.Is(e),this.Zs[e]||"not-current"}updateQueryState(e,t,n){this.Zs[e]=t}removeLocalQueryTarget(e){this.Ys.Ts(e)}isLocalQueryTarget(e){return this.Ys.activeTargetIds.has(e)}clearQueryState(e){delete this.Zs[e]}getAllActiveQueryTargets(){return this.Ys.activeTargetIds}isActiveQueryTarget(e){return this.Ys.activeTargetIds.has(e)}start(){return this.Ys=new Nd,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Od{Xs(e){}shutdown(){}}class Md{constructor(){this.eo=()=>this.no(),this.ro=()=>this.io(),this.so=[],this.oo()}Xs(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.eo),window.removeEventListener("offline",this.ro)}oo(){window.addEventListener("online",this.eo),window.addEventListener("offline",this.ro)}no(){ii("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}io(){ii("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ld=null;function Pd(){return null===Ld?Ld=268435456+Math.round(2147483648*Math.random()):Ld++,"0x"+Ld.toString(16)}const Fd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Vd{constructor(e){this._o=e._o,this.ao=e.ao}uo(e){this.co=e}lo(e){this.ho=e}onMessage(e){this.Po=e}close(){this.ao()}send(e){this._o(e)}Io(){this.co()}To(e){this.ho(e)}Eo(e){this.Po(e)}}const Bd="WebChannelConnection";class Ud extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ao=t+"://"+e.host,this.Ro=`projects/${n}/databases/${r}`,this.Vo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get mo(){return!1}fo(e,t,n,r,s){const i=Pd(),o=this.po(e,t);ii("RestConnection",`Sending RPC '${e}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.Ro,"x-goog-request-params":this.Vo};return this.yo(a,r,s),this.wo(e,o,a,n).then((t=>(ii("RestConnection",`Received RPC '${e}' ${i}: `,t),t)),(t=>{throw ai("RestConnection",`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",n),t}))}So(e,t,n,r,s,i){return this.fo(e,t,n,r,s)}yo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ni,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}po(e,t){const n=Fd[e];return`${this.Ao}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}wo(e,t,n,r){const s=Pd();return new Promise(((i,o)=>{const a=new Xs;a.setWithCredentials(!0),a.listenOnce(Qs.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Ks.NO_ERROR:const t=a.getResponseJson();ii(Bd,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case Ks.TIMEOUT:ii(Bd,`RPC '${e}' ${s} timed out`),o(new fi(di.DEADLINE_EXCEEDED,"Request time out"));break;case Ks.HTTP_ERROR:const n=a.getStatus();if(ii(Bd,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(di).indexOf(t)>=0?t:di.UNKNOWN}(t.status);o(new fi(e,t.message))}else o(new fi(di.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new fi(di.UNAVAILABLE,"Connection failed."));break;default:ui()}}finally{ii(Bd,`RPC '${e}' ${s} completed.`)}}));const c=JSON.stringify(r);ii(Bd,`RPC '${e}' ${s} sending request:`,r),a.send(t,"POST",c,n,15)}))}bo(e,t,n){const r=Pd(),s=[this.Ao,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=zs(),o=Gs(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.yo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=s.join("");ii(Bd,`Creating RPC '${e}' stream ${r}: ${u}`,a);const h=i.createWebChannel(u,a);let l=!1,d=!1;const f=new Vd({_o:t=>{d?ii(Bd,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(l||(ii(Bd,`Opening RPC '${e}' stream ${r} transport.`),h.open(),l=!0),ii(Bd,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},ao:()=>h.close()}),g=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return g(h,Ys.EventType.OPEN,(()=>{d||ii(Bd,`RPC '${e}' stream ${r} transport opened.`)})),g(h,Ys.EventType.CLOSE,(()=>{d||(d=!0,ii(Bd,`RPC '${e}' stream ${r} transport closed`),f.To())})),g(h,Ys.EventType.ERROR,(t=>{d||(d=!0,ai(Bd,`RPC '${e}' stream ${r} transport errored:`,t),f.To(new fi(di.UNAVAILABLE,"The operation could not be completed")))})),g(h,Ys.EventType.MESSAGE,(t=>{var n;if(!d){const s=t.data[0];hi(!!s);const i=s,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){ii(Bd,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=Iu[e];if(void 0!==t)return Su(t)}(t),s=o.message;void 0===n&&(n=di.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),d=!0,f.To(new fi(n,s)),h.close()}else ii(Bd,`RPC '${e}' stream ${r} received:`,s),f.Eo(s)}})),g(o,Hs.STAT_EVENT,(t=>{t.stat===Ws.PROXY?ii(Bd,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Ws.NOPROXY&&ii(Bd,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Io()}),0),f}}function qd(){return"undefined"!=typeof window?window:null}function jd(){return"undefined"!=typeof document?document:null}function $d(e){return new zu(e,!0)}class zd{constructor(e,t,n=1e3,r=1.5,s=6e4){this.oi=e,this.timerId=t,this.Do=n,this.vo=r,this.Co=s,this.Fo=0,this.Mo=null,this.xo=Date.now(),this.reset()}reset(){this.Fo=0}Oo(){this.Fo=this.Co}No(e){this.cancel();const t=Math.floor(this.Fo+this.Bo()),n=Math.max(0,Date.now()-this.xo),r=Math.max(0,t-n);r>0&&ii("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Fo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Mo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.xo=Date.now(),e()))),this.Fo*=this.vo,this.Fo<this.Do&&(this.Fo=this.Do),this.Fo>this.Co&&(this.Fo=this.Co)}Lo(){null!==this.Mo&&(this.Mo.skipDelay(),this.Mo=null)}cancel(){null!==this.Mo&&(this.Mo.cancel(),this.Mo=null)}Bo(){return(Math.random()-.5)*this.Fo}}class Gd{constructor(e,t,n,r,s,i,o,a){this.oi=e,this.ko=n,this.qo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Qo=0,this.Ko=null,this.$o=null,this.stream=null,this.Uo=new zd(e,t)}Wo(){return 1===this.state||5===this.state||this.Go()}Go(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.zo()}async stop(){this.Wo()&&await this.close(0)}jo(){this.state=0,this.Uo.reset()}Ho(){this.Go()&&null===this.Ko&&(this.Ko=this.oi.enqueueAfterDelay(this.ko,6e4,(()=>this.Jo())))}Yo(e){this.Zo(),this.stream.send(e)}async Jo(){if(this.Go())return this.close(0)}Zo(){this.Ko&&(this.Ko.cancel(),this.Ko=null)}Xo(){this.$o&&(this.$o.cancel(),this.$o=null)}async close(e,t){this.Zo(),this.Xo(),this.Uo.cancel(),this.Qo++,4!==e?this.Uo.reset():t&&t.code===di.RESOURCE_EXHAUSTED?(oi(t.toString()),oi("Using maximum backoff delay to prevent overloading the backend."),this.Uo.Oo()):t&&t.code===di.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.e_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.lo(t)}e_(){}auth(){this.state=1;const e=this.t_(this.Qo),t=this.Qo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Qo===t&&this.n_(e,n)}),(t=>{e((()=>{const e=new fi(di.UNKNOWN,"Fetching auth token failed: "+t.message);return this.r_(e)}))}))}n_(e,t){const n=this.t_(this.Qo);this.stream=this.i_(e,t),this.stream.uo((()=>{n((()=>(this.state=2,this.$o=this.oi.enqueueAfterDelay(this.qo,1e4,(()=>(this.Go()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.lo((e=>{n((()=>this.r_(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}zo(){this.state=5,this.Uo.No((async()=>{this.state=0,this.start()}))}r_(e){return ii("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}t_(e){return t=>{this.oi.enqueueAndForget((()=>this.Qo===e?t():(ii("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Kd extends Gd{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}i_(e,t){return this.connection.bo("Listen",e,t)}onMessage(e){this.Uo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:ui()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(hi(void 0===t||"string"==typeof t),Yo.fromBase64String(t||"")):(hi(void 0===t||t instanceof Uint8Array),Yo.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?di.UNKNOWN:Su(e.code);return new fi(t,e.message||"")}(o);n=new Pu(r,s,i,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Zu(e,r.document.name),i=Wu(r.document.updateTime),o=r.document.createTime?Wu(r.document.createTime):Ai.min(),a=new Da({mapValue:{fields:r.document.fields}}),c=Aa.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new Mu(u,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Zu(e,r.document),i=r.readTime?Wu(r.readTime):Ai.min(),o=Aa.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Mu([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Zu(e,r.document),i=r.removedTargetIds||[];n=new Mu([],i,s,null)}else{if(!("filter"in t))return ui();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:s}=e,i=new _u(r,s),o=e.targetId;n=new Lu(o,i)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Ai.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Ai.min():t.readTime?Wu(t.readTime):Ai.min()}(e);return this.listener.s_(t,n)}o_(e){const t={};t.database=nh(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=sc(r)?{documents:ch(e,r)}:{query:uh(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Qu(e,t.resumeToken);const r=Gu(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Ai.min())>0){n.readTime=Ku(e,t.snapshotVersion.toTimestamp());const r=Gu(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ui()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Yo(t)}__(e){const t={};t.database=nh(this.serializer),t.removeTarget=e,this.Yo(t)}}class Qd extends Gd{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s,this.a_=!1}get u_(){return this.a_}start(){this.a_=!1,this.lastStreamToken=void 0,super.start()}e_(){this.a_&&this.c_([])}i_(e,t){return this.connection.bo("Write",e,t)}onMessage(e){if(hi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_){this.Uo.reset();const t=function(e,t){return e&&e.length>0?(hi(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Wu(e.updateTime):Wu(t);return n.isEqual(Ai.min())&&(n=Wu(t)),new nu(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Wu(e.commitTime);return this.listener.l_(n,t)}return hi(!e.writeResults||0===e.writeResults.length),this.a_=!0,this.listener.h_()}P_(){const e={};e.database=nh(this.serializer),this.Yo(e)}c_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>oh(this.serializer,e)))};this.Yo(t)}}class Hd extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.I_=!1}T_(){if(this.I_)throw new fi(di.FAILED_PRECONDITION,"The client has already been terminated.")}fo(e,t,n){return this.T_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.fo(e,t,n,r,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===di.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new fi(di.UNKNOWN,e.toString())}))}So(e,t,n,r){return this.T_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.So(e,t,n,s,i,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===di.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new fi(di.UNKNOWN,e.toString())}))}terminate(){this.I_=!0}}class Wd{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.d_=0,this.A_=null,this.R_=!0}V_(){0===this.d_&&(this.m_("Unknown"),this.A_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.A_=null,this.f_("Backend didn't respond within 10 seconds."),this.m_("Offline"),Promise.resolve()))))}g_(e){"Online"===this.state?this.m_("Unknown"):(this.d_++,this.d_>=1&&(this.p_(),this.f_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.m_("Offline")))}set(e){this.p_(),this.d_=0,"Online"===e&&(this.R_=!1),this.m_(e)}m_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}f_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.R_?(oi(t),this.R_=!1):ii("OnlineStateTracker",t)}p_(){null!==this.A_&&(this.A_.cancel(),this.A_=null)}}class Yd{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.y_=[],this.w_=new Map,this.S_=new Set,this.b_=[],this.D_=s,this.D_.Xs((e=>{n.enqueueAndForget((async()=>{of(this)&&(ii("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=li(e);t.S_.add(4),await Jd(t),t.v_.set("Unknown"),t.S_.delete(4),await Xd(t)}(this))}))})),this.v_=new Wd(n,r)}}async function Xd(e){if(of(e))for(const t of e.b_)await t(!0)}async function Jd(e){for(const t of e.b_)await t(!1)}function Zd(e,t){const n=li(e);n.w_.has(t.targetId)||(n.w_.set(t.targetId,t),sf(n)?rf(n):Tf(n).Go()&&tf(n,t))}function ef(e,t){const n=li(e),r=Tf(n);n.w_.delete(t),r.Go()&&nf(n,t),0===n.w_.size&&(r.Go()?r.Ho():of(n)&&n.v_.set("Unknown"))}function tf(e,t){if(e.C_.Le(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Ai.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Tf(e).o_(t)}function nf(e,t){e.C_.Le(t),Tf(e).__(t)}function rf(e){e.C_=new Vu({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>e.w_.get(t)||null,st:()=>e.datastore.serializer.databaseId}),Tf(e).start(),e.v_.V_()}function sf(e){return of(e)&&!Tf(e).Wo()&&e.w_.size>0}function of(e){return 0===li(e).S_.size}function af(e){e.C_=void 0}async function cf(e){e.w_.forEach(((t,n)=>{tf(e,t)}))}async function uf(e,t){af(e),sf(e)?(e.v_.g_(t),rf(e)):e.v_.set("Unknown")}async function hf(e,t,n){if(e.v_.set("Online"),t instanceof Pu&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.w_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.w_.delete(r),e.C_.removeTarget(r))}(e,t)}catch(n){ii("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await lf(e,n)}else if(t instanceof Mu?e.C_.Ge(t):t instanceof Lu?e.C_.Xe(t):e.C_.He(t),!n.isEqual(Ai.min()))try{const t=await fd(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.C_._t(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.w_.get(r);s&&e.w_.set(r,s.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.w_.get(t);if(!r)return;e.w_.set(t,r.withResumeToken(Yo.EMPTY_BYTE_STRING,r.snapshotVersion)),nf(e,t);const s=new bh(r.target,t,n,r.sequenceNumber);tf(e,s)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){ii("RemoteStore","Failed to raise snapshot:",t),await lf(e,t)}}async function lf(e,t,n){if(!Ji(t))throw t;e.S_.add(1),await Jd(e),e.v_.set("Offline"),n||(n=()=>fd(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{ii("RemoteStore","Retrying IndexedDB access"),await n(),e.S_.delete(1),await Xd(e)}))}function df(e,t){return t().catch((n=>lf(e,n,t)))}async function ff(e){const t=li(e),n=Sf(t);let r=t.y_.length>0?t.y_[t.y_.length-1].batchId:-1;for(;gf(t);)try{const e=await md(t.localStore,r);if(null===e){0===t.y_.length&&n.Ho();break}r=e.batchId,mf(t,e)}catch(e){await lf(t,e)}pf(t)&&yf(t)}function gf(e){return of(e)&&e.y_.length<10}function mf(e,t){e.y_.push(t);const n=Sf(e);n.Go()&&n.u_&&n.c_(t.mutations)}function pf(e){return of(e)&&!Sf(e).Wo()&&e.y_.length>0}function yf(e){Sf(e).start()}async function wf(e){Sf(e).P_()}async function vf(e){const t=Sf(e);for(const n of e.y_)t.c_(n.mutations)}async function bf(e,t,n){const r=e.y_.shift(),s=vu.from(r,t,n);await df(e,(()=>e.remoteSyncer.applySuccessfulWrite(s))),await ff(e)}async function _f(e,t){t&&Sf(e).u_&&await async function(e,t){if(function(e){return Tu(e)&&e!==di.ABORTED}(t.code)){const n=e.y_.shift();Sf(e).jo(),await df(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await ff(e)}}(e,t),pf(e)&&yf(e)}async function If(e,t){const n=li(e);n.asyncQueue.verifyOperationInProgress(),ii("RemoteStore","RemoteStore received new credentials");const r=of(n);n.S_.add(3),await Jd(n),r&&n.v_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.S_.delete(3),await Xd(n)}async function Ef(e,t){const n=li(e);t?(n.S_.delete(2),await Xd(n)):t||(n.S_.add(2),await Jd(n),n.v_.set("Unknown"))}function Tf(e){return e.F_||(e.F_=function(e,t,n){const r=li(e);return r.T_(),new Kd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:cf.bind(null,e),lo:uf.bind(null,e),s_:hf.bind(null,e)}),e.b_.push((async t=>{t?(e.F_.jo(),sf(e)?rf(e):e.v_.set("Unknown")):(await e.F_.stop(),af(e))}))),e.F_}function Sf(e){return e.M_||(e.M_=function(e,t,n){const r=li(e);return r.T_(),new Qd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:wf.bind(null,e),lo:_f.bind(null,e),h_:vf.bind(null,e),l_:bf.bind(null,e)}),e.b_.push((async t=>{t?(e.M_.jo(),await ff(e)):(await e.M_.stop(),e.y_.length>0&&(ii("RemoteStore",`Stopping write stream with ${e.y_.length} pending writes`),e.y_=[]))}))),e.M_}class Cf{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new gi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new Cf(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new fi(di.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Df(e,t){if(oi("AsyncQueue",`${t}: ${e}`),Ji(e))return new fi(di.UNAVAILABLE,`${t}: ${e}`);throw e}class xf{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Mi.comparator(t.key,n.key):(e,t)=>Mi.comparator(e.key,t.key),this.keyedMap=Nc(),this.sortedSet=new jo(this.comparator)}static emptySet(e){return new xf(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof xf))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new xf;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Af{constructor(){this.x_=new jo(Mi.comparator)}track(e){const t=e.doc.key,n=this.x_.get(t);n?0!==e.type&&3===n.type?this.x_=this.x_.insert(t,e):3===e.type&&1!==n.type?this.x_=this.x_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.x_=this.x_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.x_=this.x_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.x_=this.x_.remove(t):1===e.type&&2===n.type?this.x_=this.x_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.x_=this.x_.insert(t,{type:2,doc:e.doc}):ui():this.x_=this.x_.insert(t,e)}O_(){const e=[];return this.x_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Nf{constructor(e,t,n,r,s,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,s){const i=[];return t.forEach((e=>{i.push({type:0,doc:e})})),new Nf(e,t,xf.emptySet(t),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&vc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class kf{constructor(){this.N_=void 0,this.listeners=[]}}class Rf{constructor(){this.queries=new Cc((e=>bc(e)),vc),this.onlineState="Unknown",this.B_=new Set}}async function Of(e,t){const n=li(e),r=t.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new kf),s)try{i.N_=await n.onListen(r)}catch(e){const n=Df(e,`Initialization of query '${_c(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,i),i.listeners.push(t),t.L_(n.onlineState),i.N_&&t.k_(i.N_)&&Ff(n)}async function Mf(e,t){const n=li(e),r=t.query;let s=!1;const i=n.queries.get(r);if(i){const e=i.listeners.indexOf(t);e>=0&&(i.listeners.splice(e,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Lf(e,t){const n=li(e);let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.listeners)t.k_(e)&&(r=!0);s.N_=e}}r&&Ff(n)}function Pf(e,t,n){const r=li(e),s=r.queries.get(t);if(s)for(const e of s.listeners)e.onError(n);r.queries.delete(t)}function Ff(e){e.B_.forEach((e=>{e.next()}))}class Vf{constructor(e,t,n){this.query=e,this.q_=t,this.Q_=!1,this.K_=null,this.onlineState="Unknown",this.options=n||{}}k_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Nf(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Q_?this.U_(e)&&(this.q_.next(e),t=!0):this.W_(e,this.onlineState)&&(this.G_(e),t=!0),this.K_=e,t}onError(e){this.q_.error(e)}L_(e){this.onlineState=e;let t=!1;return this.K_&&!this.Q_&&this.W_(this.K_,e)&&(this.G_(this.K_),t=!0),t}W_(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.z_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}U_(e){if(e.docChanges.length>0)return!0;const t=this.K_&&this.K_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}G_(e){e=Nf.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Q_=!0,this.q_.next(e)}}class Bf{constructor(e,t){this.j_=e,this.byteLength=t}H_(){return"metadata"in this.j_}}class Uf{constructor(e){this.serializer=e}us(e){return Zu(this.serializer,e)}cs(e){return e.metadata.exists?ih(this.serializer,e.document,!1):Aa.newNoDocument(this.us(e.metadata.name),this.ls(e.metadata.readTime))}ls(e){return Wu(e)}}class qf{constructor(e,t,n){this.J_=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=jf(e)}Y_(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.j_.namedQuery)this.queries.push(e.j_.namedQuery);else if(e.j_.documentMetadata){this.documents.push({metadata:e.j_.documentMetadata}),e.j_.documentMetadata.exists||++t;const n=ki.fromString(e.j_.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.j_.document&&(this.documents[this.documents.length-1].document=e.j_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Z_(e){const t=new Map,n=new Uf(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.us(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||Fc()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const s=li(e);let i=Fc(),o=xc();for(const e of n){const n=t.us(e.metadata.name);e.document&&(i=i.add(n));const r=t.cs(e);r.setReadTime(t.ls(e.metadata.readTime)),o=o.insert(n,r)}const a=s.ts.newChangeBuffer({trackRemovals:!0}),c=await pd(s,function(e){return pc(hc(ki.fromString(`__bundle__/docs/${e}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",(e=>gd(e,a,o).next((t=>(a.apply(e),t))).next((t=>s.Qr.removeMatchingKeysForTargetId(e,c.targetId).next((()=>s.Qr.addMatchingKeys(e,i,c.targetId))).next((()=>s.localDocuments.getLocalViewOfDocuments(e,t.ss,t.os))).next((()=>t.ss))))))}(this.localStore,new Uf(this.serializer),this.documents,this.J_.id),t=this.Z_(this.documents);for(const e of this.queries)await Id(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,X_:this.collectionGroups,ea:e}}}function jf(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class $f{constructor(e){this.key=e}}class zf{constructor(e){this.key=e}}class Gf{constructor(e,t){this.query=e,this.ta=t,this.na=null,this.hasCachedResults=!1,this.current=!1,this.ra=Fc(),this.mutatedKeys=Fc(),this.ia=Tc(e),this.sa=new xf(this.ia)}get oa(){return this.ta}_a(e,t){const n=t?t.aa:new Af,r=t?t.sa:this.sa;let s=t?t.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),h=Ic(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.ua(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.ia(h,a)>0||c&&this.ia(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{sa:i,aa:n,Hi:o,mutatedKeys:s}}ua(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.sa;this.sa=e.sa,this.mutatedKeys=e.mutatedKeys;const s=e.aa.O_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ui()}};return n(e)-n(t)}(e.type,t.type)||this.ia(e.doc,t.doc))),this.ca(n);const i=t?this.la():[],o=0===this.ra.size&&this.current?1:0,a=o!==this.na;return this.na=o,0!==s.length||a?{snapshot:new Nf(this.query,e.sa,r,s,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),ha:i}:{ha:i}}L_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({sa:this.sa,aa:new Af,mutatedKeys:this.mutatedKeys,Hi:!1},!1)):{ha:[]}}Pa(e){return!this.ta.has(e)&&!!this.sa.has(e)&&!this.sa.get(e).hasLocalMutations}ca(e){e&&(e.addedDocuments.forEach((e=>this.ta=this.ta.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.ta=this.ta.delete(e))),this.current=e.current)}la(){if(!this.current)return[];const e=this.ra;this.ra=Fc(),this.sa.forEach((e=>{this.Pa(e.key)&&(this.ra=this.ra.add(e.key))}));const t=[];return e.forEach((e=>{this.ra.has(e)||t.push(new zf(e))})),this.ra.forEach((n=>{e.has(n)||t.push(new $f(n))})),t}Ia(e){this.ta=e._s,this.ra=Fc();const t=this._a(e.documents);return this.applyChanges(t,!0)}Ta(){return Nf.fromInitialDocuments(this.query,this.sa,this.mutatedKeys,0===this.na,this.hasCachedResults)}}class Kf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Qf{constructor(e){this.key=e,this.Ea=!1}}class Hf{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.da={},this.Aa=new Cc((e=>bc(e)),vc),this.Ra=new Map,this.Va=new Set,this.ma=new jo(Mi.comparator),this.fa=new Map,this.ga=new Kl,this.pa={},this.ya=new Map,this.wa=Il.Bn(),this.onlineState="Unknown",this.Sa=void 0}get isPrimaryClient(){return!0===this.Sa}}async function Wf(e,t){const n=_g(e);let r,s;const i=n.Aa.get(t);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Ta();else{const e=await pd(n.localStore,pc(t)),i=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,s=await Yf(n,t,r,"current"===i,e.resumeToken),n.isPrimaryClient&&Zd(n.remoteStore,e)}return s}async function Yf(e,t,n,r,s){e.ba=(t,n,r)=>async function(e,t,n,r){let s=t.view._a(n);s.Hi&&(s=await wd(e.localStore,t.query,!1).then((({documents:e})=>t.view._a(e,s))));const i=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(s,e.isPrimaryClient,i);return ag(e,t.targetId,o.ha),o.snapshot}(e,t,n,r);const i=await wd(e.localStore,t,!0),o=new Gf(t,i._s),a=o._a(i.documents),c=Ou.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,s),u=o.applyChanges(a,e.isPrimaryClient,c);ag(e,n,u.ha);const h=new Kf(t,n,o);return e.Aa.set(t,h),e.Ra.has(n)?e.Ra.get(n).push(t):e.Ra.set(n,[t]),u.snapshot}async function Xf(e,t){const n=li(e),r=n.Aa.get(t),s=n.Ra.get(r.targetId);if(s.length>1)return n.Ra.set(r.targetId,s.filter((e=>!vc(e,t)))),void n.Aa.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await yd(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),ef(n.remoteStore,r.targetId),ig(n,r.targetId)})).catch(Ki)):(ig(n,r.targetId),await yd(n.localStore,r.targetId,!0))}async function Jf(e,t){const n=li(e);try{const e=await function(e,t){const n=li(e),r=t.snapshotVersion;let s=n.Zi;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const i=n.ts.newChangeBuffer({trackRemovals:!0});s=n.Zi;const o=[];t.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(e,i.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(e,i.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Yo.EMPTY_BYTE_STRING,Ai.min()).withLastLimboFreeSnapshotVersion(Ai.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Qr.updateTargetData(e,u))}));let a=xc(),c=Fc();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(gd(e,i,t.documentUpdates).next((e=>{a=e.ss,c=e.os}))),!r.isEqual(Ai.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Qi.waitFor(o).next((()=>i.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Zi=s,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.fa.get(t);r&&(hi(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.Ea=!0:e.modifiedDocuments.size>0?hi(r.Ea):e.removedDocuments.size>0&&(hi(r.Ea),r.Ea=!1))})),await hg(n,e,t)}catch(e){await Ki(e)}}function Zf(e,t,n){const r=li(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Aa.forEach(((n,r)=>{const s=r.view.L_(t);s.snapshot&&e.push(s.snapshot)})),function(e,t){const n=li(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.L_(t)&&(r=!0)})),r&&Ff(n)}(r.eventManager,t),e.length&&r.da.s_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function eg(e,t,n){const r=li(e);r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.fa.get(t),i=s&&s.key;if(i){let e=new jo(Mi.comparator);e=e.insert(i,Aa.newNoDocument(i,Ai.min()));const n=Fc().add(i),s=new Ru(Ai.min(),new Map,new jo(Si),e,n);await Jf(r,s),r.ma=r.ma.remove(i),r.fa.delete(t),ug(r)}else await yd(r.localStore,t,!1).then((()=>ig(r,t,n))).catch(Ki)}async function tg(e,t){const n=li(e),r=t.batch.batchId;try{const e=await function(e,t){const n=li(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),s=n.ts.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const s=n.batch,i=s.keys();let o=Qi.resolve();return i.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const i=n.docVersions.get(e);hi(null!==i),t.version.compareTo(i)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,s)))}(n,e,t,s).next((()=>s.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Fc();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);sg(n,r,null),rg(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await hg(n,e)}catch(e){await Ki(e)}}async function ng(e,t,n){const r=li(e);try{const e=await function(e,t){const n=li(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(hi(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);sg(r,t,n),rg(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await hg(r,e)}catch(n){await Ki(n)}}function rg(e,t){(e.ya.get(t)||[]).forEach((e=>{e.resolve()})),e.ya.delete(t)}function sg(e,t,n){const r=li(e);let s=r.pa[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.pa[r.currentUser.toKey()]=s}}function ig(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Ra.get(t))e.Aa.delete(r),n&&e.da.Da(r,n);e.Ra.delete(t),e.isPrimaryClient&&e.ga.Vr(t).forEach((t=>{e.ga.containsKey(t)||og(e,t)}))}function og(e,t){e.Va.delete(t.path.canonicalString());const n=e.ma.get(t);null!==n&&(ef(e.remoteStore,n),e.ma=e.ma.remove(t),e.fa.delete(n),ug(e))}function ag(e,t,n){for(const r of n)r instanceof $f?(e.ga.addReference(r.key,t),cg(e,r)):r instanceof zf?(ii("SyncEngine","Document no longer in limbo: "+r.key),e.ga.removeReference(r.key,t),e.ga.containsKey(r.key)||og(e,r.key)):ui()}function cg(e,t){const n=t.key,r=n.path.canonicalString();e.ma.get(n)||e.Va.has(r)||(ii("SyncEngine","New document in limbo: "+n),e.Va.add(r),ug(e))}function ug(e){for(;e.Va.size>0&&e.ma.size<e.maxConcurrentLimboResolutions;){const t=e.Va.values().next().value;e.Va.delete(t);const n=new Mi(ki.fromString(t)),r=e.wa.next();e.fa.set(r,new Qf(n)),e.ma=e.ma.insert(n,r),Zd(e.remoteStore,new bh(pc(hc(n.path)),r,"TargetPurposeLimboResolution",io.ae))}}async function hg(e,t,n){const r=li(e),s=[],i=[],o=[];r.Aa.isEmpty()||(r.Aa.forEach(((e,a)=>{o.push(r.ba(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){s.push(e);const t=cd.Ki(a.targetId,e);i.push(t)}})))})),await Promise.all(o),r.da.s_(s),await async function(e,t){const n=li(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Qi.forEach(t,(t=>Qi.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Qi.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Ji(e))throw e;ii("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Zi.get(t),r=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(r);n.Zi=n.Zi.insert(t,s)}}}(r.localStore,i))}async function lg(e,t){const n=li(e);if(!n.currentUser.isEqual(t)){ii("SyncEngine","User change. New user:",t.toKey());const e=await dd(n.localStore,t);n.currentUser=t,function(e,t){e.ya.forEach((e=>{e.forEach((e=>{e.reject(new fi(di.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.ya.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await hg(n,e.rs)}}function dg(e,t){const n=li(e),r=n.fa.get(t);if(r&&r.Ea)return Fc().add(r.key);{let e=Fc();const r=n.Ra.get(t);if(!r)return e;for(const t of r){const r=n.Aa.get(t);e=e.unionWith(r.view.oa)}return e}}async function fg(e,t){const n=li(e),r=await wd(n.localStore,t.query,!0),s=t.view.Ia(r);return n.isPrimaryClient&&ag(n,t.targetId,s.ha),s}async function gg(e,t){const n=li(e);return bd(n.localStore,t).then((e=>hg(n,e)))}async function mg(e,t,n,r){const s=li(e),i=await function(e,t){const n=li(e),r=li(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Cn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):Qi.resolve(null)))))}(s.localStore,t);null!==i?("pending"===n?await ff(s.remoteStore):"acknowledged"===n||"rejected"===n?(sg(s,t,r||null),rg(s,t),function(e,t){li(li(e).mutationQueue).Mn(t)}(s.localStore,t)):ui(),await hg(s,i)):ii("SyncEngine","Cannot apply mutation batch with id: "+t)}async function pg(e,t,n){const r=li(e),s=[],i=[];for(const e of t){let t;const n=r.Ra.get(e);if(n&&0!==n.length){t=await pd(r.localStore,pc(n[0]));for(const e of n){const t=r.Aa.get(e),n=await fg(r,t);n.snapshot&&i.push(n.snapshot)}}else{const n=await vd(r.localStore,e);t=await pd(r.localStore,n),await Yf(r,yg(n),e,!1,t.resumeToken)}s.push(t)}return r.da.s_(i),s}function yg(e){return uc(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function wg(e){return function(e){return li(li(e).persistence).Li()}(li(e).localStore)}async function vg(e,t,n,r){const s=li(e);if(s.Sa)return void ii("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ra.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{const e=await bd(s.localStore,Ec(i[0])),r=Ru.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Yo.EMPTY_BYTE_STRING);await hg(s,e,r);break}case"rejected":await yd(s.localStore,t,!0),ig(s,t,r);break;default:ui()}}async function bg(e,t,n){const r=_g(e);if(r.Sa){for(const e of t){if(r.Ra.has(e)){ii("SyncEngine","Adding an already active target "+e);continue}const t=await vd(r.localStore,e),n=await pd(r.localStore,t);await Yf(r,yg(t),n.targetId,!1,n.resumeToken),Zd(r.remoteStore,n)}for(const e of n)r.Ra.has(e)&&await yd(r.localStore,e,!1).then((()=>{ef(r.remoteStore,e),ig(r,e)})).catch(Ki)}}function _g(e){const t=li(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Jf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=dg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=eg.bind(null,t),t.da.s_=Lf.bind(null,t.eventManager),t.da.Da=Pf.bind(null,t.eventManager),t}function Ig(e){const t=li(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=tg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ng.bind(null,t),t}class Eg{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=$d(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return ld(this.persistence,new ud,e.initialUser,this.serializer)}createPersistence(e){return new Jl(ed.Hr,this.serializer)}createSharedClientState(e){return new Rd}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Tg extends Eg{constructor(e,t,n){super(),this.Ca=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ca.initialize(this,e),await Ig(this.Ca.syncEngine),await ff(this.Ca.remoteStore),await this.persistence.fi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return ld(this.persistence,new ud,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Al(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new so(t,this.persistence);return new ro(e.asyncQueue,n)}createPersistence(e){const t=ad(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?gl.withCacheSize(this.cacheSizeBytes):gl.DEFAULT;return new sd(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,qd(),jd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Rd}}class Sg extends Tg{constructor(e,t){super(e,t,!1),this.Ca=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ca.syncEngine;this.sharedClientState instanceof kd&&(this.sharedClientState.syncEngine={js:mg.bind(null,t),Hs:vg.bind(null,t),Js:bg.bind(null,t),Li:wg.bind(null,t),zs:gg.bind(null,t)},await this.sharedClientState.start()),await this.persistence.fi((async e=>{await async function(e,t){const n=li(e);if(_g(n),Ig(n),!0===t&&!0!==n.Sa){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await pg(n,e.toArray());n.Sa=!0,await Ef(n.remoteStore,!0);for(const e of t)Zd(n.remoteStore,e)}else if(!1===t&&!1!==n.Sa){const e=[];let t=Promise.resolve();n.Ra.forEach(((r,s)=>{n.sharedClientState.isLocalQueryTarget(s)?e.push(s):t=t.then((()=>(ig(n,s),yd(n.localStore,s,!0)))),ef(n.remoteStore,s)})),await t,await pg(n,e),function(e){const t=li(e);t.fa.forEach(((e,n)=>{ef(t.remoteStore,n)})),t.ga.mr(),t.fa=new Map,t.ma=new jo(Mi.comparator)}(n),n.Sa=!1,await Ef(n.remoteStore,!1)}}(this.Ca.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}createSharedClientState(e){const t=qd();if(!kd.v(t))throw new fi(di.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=ad(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new kd(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Cg{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Zf(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=lg.bind(null,this.syncEngine),await Ef(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Rf}createDatastore(e){const t=$d(e.databaseInfo.databaseId),n=function(e){return new Ud(e)}(e.databaseInfo);return function(e,t,n,r){return new Hd(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,s){return new Yd(e,t,n,r,s)}(this.localStore,this.datastore,e.asyncQueue,(e=>Zf(this.syncEngine,e,0)),Md.v()?new Md:new Od)}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new Hf(e,t,n,r,s,i);return o&&(a.Sa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=li(e);ii("RemoteStore","RemoteStore shutting down."),t.S_.add(5),await Jd(t),t.D_.shutdown(),t.v_.set("Unknown")}(this.remoteStore)}}function Dg(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class xg{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Fa(this.observer.next,e)}error(e){this.observer.error?this.Fa(this.observer.error,e):oi("Uncaught Error in snapshot listener:",e.toString())}Ma(){this.muted=!0}Fa(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Ag{constructor(e,t){this.xa=e,this.serializer=t,this.metadata=new gi,this.buffer=new Uint8Array,this.Oa=new TextDecoder("utf-8"),this.Na().then((e=>{e&&e.H_()?this.metadata.resolve(e.j_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.j_)}`))}),(e=>this.metadata.reject(e)))}close(){return this.xa.cancel()}async getMetadata(){return this.metadata.promise}async va(){return await this.getMetadata(),this.Na()}async Na(){const e=await this.Ba();if(null===e)return null;const t=this.Oa.decode(e),n=Number(t);isNaN(n)&&this.La(`length string (${t}) is not valid number`);const r=await this.ka(n);return new Bf(JSON.parse(r),e.length+n)}qa(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Ba(){for(;this.qa()<0&&!await this.Qa(););if(0===this.buffer.length)return null;const e=this.qa();e<0&&this.La("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ka(e){for(;this.buffer.length<e;)await this.Qa()&&this.La("Reached the end of bundle when more is expected.");const t=this.Oa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}La(e){throw this.xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async Qa(){const e=await this.xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Ng{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new fi(di.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=li(e),r=nh(n.serializer)+"/documents",s={documents:t.map((e=>Ju(n.serializer,e)))},i=await n.So("BatchGetDocuments",r,s,t.length),o=new Map;i.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){hi(!!t.found),t.found.name,t.found.updateTime;const n=Zu(e,t.found.name),r=Wu(t.found.updateTime),s=t.found.createTime?Wu(t.found.createTime):Ai.min(),i=new Da({mapValue:{fields:t.found.fields}});return Aa.newFoundDocument(n,r,s,i)}(e,t):"missing"in t?function(e,t){hi(!!t.missing),hi(!!t.readTime);const n=Zu(e,t.missing),r=Wu(t.readTime);return Aa.newNoDocument(n,r)}(e,t):ui()}(n.serializer,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());hi(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new pu(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=Mi.fromPath(t);this.mutations.push(new yu(n,this.precondition(n)))})),await async function(e,t){const n=li(e),r=nh(n.serializer)+"/documents",s={writes:t.map((e=>oh(n.serializer,e)))};await n.fo("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ui();t=Ai.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new fi(di.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ai.min())?ru.exists(!1):ru.updateTime(t):ru.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ai.min()))throw new fi(di.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ru.updateTime(t)}return ru.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class kg{constructor(e,t,n,r,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=s,this.Ka=n.maxAttempts,this.Uo=new zd(this.asyncQueue,"transaction_retry")}run(){this.Ka-=1,this.$a()}$a(){this.Uo.No((async()=>{const e=new Ng(this.datastore),t=this.Ua(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Wa(e)}))))})).catch((e=>{this.Wa(e)}))}))}Ua(e){try{const t=this.updateFunction(e);return!oo(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Wa(e){this.Ka>0&&this.Ga(e)?(this.Ka-=1,this.asyncQueue.enqueueAndForget((()=>(this.$a(),Promise.resolve())))):this.deferred.reject(e)}Ga(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Tu(t)}return!1}}class Rg{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=ti.UNAUTHENTICATED,this.clientId=Ti.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{ii("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(ii("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new fi(di.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new gi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Df(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Og(e,t){e.asyncQueue.verifyOperationInProgress(),ii("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await dd(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Mg(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Pg(e);ii("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>If(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>If(t.remoteStore,n))),e._onlineComponents=t}function Lg(e){return"FirebaseError"===e.name?e.code===di.FAILED_PRECONDITION||e.code===di.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function Pg(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ii("FirestoreClient","Using user provided OfflineComponentProvider");try{await Og(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!Lg(n))throw n;ai("Error using user provided cache. Falling back to memory cache: "+n),await Og(e,new Eg)}}else ii("FirestoreClient","Using default OfflineComponentProvider"),await Og(e,new Eg);return e._offlineComponents}async function Fg(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ii("FirestoreClient","Using user provided OnlineComponentProvider"),await Mg(e,e._uninitializedComponentsProvider._online)):(ii("FirestoreClient","Using default OnlineComponentProvider"),await Mg(e,new Cg))),e._onlineComponents}function Vg(e){return Pg(e).then((e=>e.persistence))}function Bg(e){return Pg(e).then((e=>e.localStore))}function Ug(e){return Fg(e).then((e=>e.remoteStore))}function qg(e){return Fg(e).then((e=>e.syncEngine))}async function jg(e){const t=await Fg(e),n=t.eventManager;return n.onListen=Wf.bind(null,t.syncEngine),n.onUnlisten=Xf.bind(null,t.syncEngine),n}function $g(e,t,n={}){const r=new gi;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,s){const i=new xg({next:i=>{t.enqueueAndForget((()=>Mf(e,o)));const a=i.docs.has(n);!a&&i.fromCache?s.reject(new fi(di.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&r&&"server"===r.source?s.reject(new fi(di.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(i)},error:e=>s.reject(e)}),o=new Vf(hc(n.path),i,{includeMetadataChanges:!0,z_:!0});return Of(e,o)}(await jg(e),e.asyncQueue,t,n,r))),r.promise}function zg(e,t,n={}){const r=new gi;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,s){const i=new xg({next:n=>{t.enqueueAndForget((()=>Mf(e,o))),n.fromCache&&"server"===r.source?s.reject(new fi(di.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),o=new Vf(n,i,{includeMetadataChanges:!0,z_:!0});return Of(e,o)}(await jg(e),e.asyncQueue,t,n,r))),r.promise}function Gg(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Kg=new Map;function Qg(e,t,n){if(!n)throw new fi(di.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Hg(e,t,n,r){if(!0===t&&!0===r)throw new fi(di.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Wg(e){if(!Mi.isDocumentKey(e))throw new fi(di.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Yg(e){if(Mi.isDocumentKey(e))throw new fi(di.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Xg(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":ui()}function Jg(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new fi(di.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Xg(e);throw new fi(di.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Zg(e,t){if(t<=0)throw new fi(di.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class em{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new fi(di.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new fi(di.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Hg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Gg(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new fi(di.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new fi(di.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new fi(di.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class tm{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new em({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new fi(di.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new fi(di.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new em(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new pi;switch(e.type){case"firstParty":return new bi(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new fi(di.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Kg.get(e);t&&(ii("ComponentProvider","Removing Datastore"),Kg.delete(e),t.terminate())}(this),Promise.resolve()}}class nm{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new nm(this.firestore,e,this._query)}}class rm{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new sm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new rm(this.firestore,e,this._key)}}class sm extends nm{constructor(e,t,n){super(e,t,hc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new rm(this.firestore,null,new Mi(e))}withConverter(e){return new sm(this.firestore,e,this._path)}}function im(e,t,...n){if(e=_(e),Qg("collection","path",t),e instanceof tm){const r=ki.fromString(t,...n);return Yg(r),new sm(e,null,r)}{if(!(e instanceof rm||e instanceof sm))throw new fi(di.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ki.fromString(t,...n));return Yg(r),new sm(e.firestore,null,r)}}function om(e,t,...n){if(e=_(e),1===arguments.length&&(t=Ti.V()),Qg("doc","path",t),e instanceof tm){const r=ki.fromString(t,...n);return Wg(r),new rm(e,null,new Mi(r))}{if(!(e instanceof rm||e instanceof sm))throw new fi(di.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ki.fromString(t,...n));return Wg(r),new rm(e.firestore,e instanceof sm?e.converter:null,new Mi(r))}}function am(e,t){return e=_(e),t=_(t),(e instanceof rm||e instanceof sm)&&(t instanceof rm||t instanceof sm)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function cm(e,t){return e=_(e),t=_(t),e instanceof nm&&t instanceof nm&&e.firestore===t.firestore&&vc(e._query,t._query)&&e.converter===t.converter}class um{constructor(){this.za=Promise.resolve(),this.ja=[],this.Ha=!1,this.Ja=[],this.Ya=null,this.Za=!1,this.Xa=!1,this.eu=[],this.Uo=new zd(this,"async_queue_retry"),this.tu=()=>{const e=jd();e&&ii("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Uo.Lo()};const e=jd();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.tu)}get isShuttingDown(){return this.Ha}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.nu(),this.ru(e)}enterRestrictedMode(e){if(!this.Ha){this.Ha=!0,this.Xa=e||!1;const t=jd();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.tu)}}enqueue(e){if(this.nu(),this.Ha)return new Promise((()=>{}));const t=new gi;return this.ru((()=>this.Ha&&this.Xa?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.ja.push(e),this.iu())))}async iu(){if(0!==this.ja.length){try{await this.ja[0](),this.ja.shift(),this.Uo.reset()}catch(e){if(!Ji(e))throw e;ii("AsyncQueue","Operation failed with retryable error: "+e)}this.ja.length>0&&this.Uo.No((()=>this.iu()))}}ru(e){const t=this.za.then((()=>(this.Za=!0,e().catch((e=>{this.Ya=e,this.Za=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw oi("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Za=!1,e))))));return this.za=t,t}enqueueAfterDelay(e,t,n){this.nu(),this.eu.indexOf(e)>-1&&(t=0);const r=Cf.createAndSchedule(this,e,t,n,(e=>this.su(e)));return this.Ja.push(r),r}nu(){this.Ya&&ui()}verifyOperationInProgress(){}async ou(){let e;do{e=this.za,await e}while(e!==this.za)}_u(e){for(const t of this.Ja)if(t.timerId===e)return!0;return!1}au(e){return this.ou().then((()=>{this.Ja.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Ja)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ou()}))}uu(e){this.eu.push(e)}su(e){const t=this.Ja.indexOf(e);this.Ja.splice(t,1)}}function hm(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class lm{constructor(){this._progressObserver={},this._taskCompletionResolver=new gi,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class dm extends tm{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new um,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||gm(this),this._firestoreClient.terminate()}}function fm(e){return e._firestoreClient||gm(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function gm(e){var t,n,r;const s=e._freezeSettings(),i=function(e,t,n,r){return new sa(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Gg(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s);e._firestoreClient=new Rg(e._authCredentials,e._appCheckCredentials,e._queue,i),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}function mm(e,t,n){const r=new gi;return e.asyncQueue.enqueue((async()=>{try{await Og(e,n),await Mg(e,t),r.resolve()}catch(e){const t=e;if(!Lg(t))throw t;ai("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}})).then((()=>r.promise))}function pm(e){if(e._initialized||e._terminated)throw new fi(di.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class ym{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ym(Yo.fromBase64String(e))}catch(e){throw new fi(di.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ym(Yo.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class wm{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new fi(di.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Oi(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class vm{constructor(e){this._methodName=e}}class bm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new fi(di.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new fi(di.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Si(this._lat,e._lat)||Si(this._long,e._long)}}const _m=/^__.*__$/;class Im{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new du(e,this.data,this.fieldMask,t,this.fieldTransforms):new lu(e,this.data,t,this.fieldTransforms)}}class Em{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new du(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Tm(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ui()}}class Sm{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.cu(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get lu(){return this.settings.lu}hu(e){return new Sm(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Pu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.hu({path:n,Iu:!1});return r.Tu(e),r}Eu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.hu({path:n,Iu:!1});return r.cu(),r}du(e){return this.hu({path:void 0,Iu:!0})}Au(e){return Gm(e,this.settings.methodName,this.settings.Ru||!1,this.path,this.settings.Vu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}cu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Tu(this.path.get(e))}Tu(e){if(0===e.length)throw this.Au("Document fields must not be empty");if(Tm(this.lu)&&_m.test(e))throw this.Au('Document fields cannot begin and end with "__"')}}class Cm{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||$d(e)}mu(e,t,n,r=!1){return new Sm({lu:e,methodName:t,Vu:n,path:Oi.emptyPath(),Iu:!1,Ru:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Dm(e){const t=e._freezeSettings(),n=$d(e._databaseId);return new Cm(e._databaseId,!!t.ignoreUndefinedProperties,n)}function xm(e,t,n,r,s,i={}){const o=e.mu(i.merge||i.mergeFields?2:0,t,n,s);qm("Data must be an object, but it was:",o,r);const a=Bm(r,o);let c,u;if(i.merge)c=new Ho(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=jm(t,r,n);if(!o.contains(s))throw new fi(di.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Km(e,s)||e.push(s)}c=new Ho(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Im(new Da(a),c,u)}class Am extends vm{_toFieldTransform(e){if(2!==e.lu)throw 1===e.lu?e.Au(`${this._methodName}() can only appear at the top level of your update data`):e.Au(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Am}}function Nm(e,t,n){return new Sm({lu:3,Vu:t.settings.Vu,methodName:e._methodName,Iu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class km extends vm{_toFieldTransform(e){return new tu(e.path,new Qc)}isEqual(e){return e instanceof km}}class Rm extends vm{constructor(e,t){super(e),this.fu=t}_toFieldTransform(e){const t=Nm(this,e,!0),n=this.fu.map((e=>Vm(e,t))),r=new Hc(n);return new tu(e.path,r)}isEqual(e){return this===e}}class Om extends vm{constructor(e,t){super(e),this.fu=t}_toFieldTransform(e){const t=Nm(this,e,!0),n=this.fu.map((e=>Vm(e,t))),r=new Yc(n);return new tu(e.path,r)}isEqual(e){return this===e}}class Mm extends vm{constructor(e,t){super(e),this.gu=t}_toFieldTransform(e){const t=new Jc(e.serializer,jc(e.serializer,this.gu));return new tu(e.path,t)}isEqual(e){return this===e}}function Lm(e,t,n,r){const s=e.mu(1,t,n);qm("Data must be an object, but it was:",s,r);const i=[],o=Da.empty();Uo(r,((e,r)=>{const a=zm(t,e,n);r=_(r);const c=s.Eu(a);if(r instanceof Am)i.push(a);else{const e=Vm(r,c);null!=e&&(i.push(a),o.set(a,e))}}));const a=new Ho(i);return new Em(o,a,s.fieldTransforms)}function Pm(e,t,n,r,s,i){const o=e.mu(1,t,n),a=[jm(t,r,n)],c=[s];if(i.length%2!=0)throw new fi(di.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)a.push(jm(t,i[e])),c.push(i[e+1]);const u=[],h=Da.empty();for(let e=a.length-1;e>=0;--e)if(!Km(u,a[e])){const t=a[e];let n=c[e];n=_(n);const r=o.Eu(t);if(n instanceof Am)u.push(t);else{const e=Vm(n,r);null!=e&&(u.push(t),h.set(t,e))}}const l=new Ho(u);return new Em(h,l,o.fieldTransforms)}function Fm(e,t,n,r=!1){return Vm(n,e.mu(r?4:3,t))}function Vm(e,t){if(Um(e=_(e)))return qm("Unsupported field value:",t,e),Bm(e,t);if(e instanceof vm)return function(e,t){if(!Tm(t.lu))throw t.Au(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Au(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Iu&&4!==t.lu)throw t.Au("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const s of e){let e=Vm(s,t.du(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=_(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return jc(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=xi.fromDate(e);return{timestampValue:Ku(t.serializer,n)}}if(e instanceof xi){const n=new xi(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ku(t.serializer,n)}}if(e instanceof bm)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ym)return{bytesValue:Qu(t.serializer,e._byteString)};if(e instanceof rm){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Au(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Yu(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Au(`Unsupported field value: ${Xg(e)}`)}(e,t)}function Bm(e,t){const n={};return qo(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Uo(e,((e,r)=>{const s=Vm(r,t.Pu(e));null!=s&&(n[e]=s)})),{mapValue:{fields:n}}}function Um(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof xi||e instanceof bm||e instanceof ym||e instanceof rm||e instanceof vm)}function qm(e,t,n){if(!Um(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Xg(n);throw"an object"===r?t.Au(e+" a custom object"):t.Au(e+" "+r)}}function jm(e,t,n){if((t=_(t))instanceof wm)return t._internalPath;if("string"==typeof t)return zm(e,t);throw Gm("Field path arguments must be of type string or ",e,!1,void 0,n)}const $m=new RegExp("[~\\*/\\[\\]]");function zm(e,t,n){if(t.search($m)>=0)throw Gm(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new wm(...t.split("."))._internalPath}catch(r){throw Gm(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Gm(e,t,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new fi(di.INVALID_ARGUMENT,a+e+c)}function Km(e,t){return e.some((e=>e.isEqual(t)))}class Qm{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new rm(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Hm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Wm("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Hm extends Qm{data(){return super.data()}}function Wm(e,t){return"string"==typeof t?zm(e,t):t instanceof wm?t._internalPath:t._delegate._internalPath}function Ym(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new fi(di.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xm{}class Jm extends Xm{}function Zm(e,t,...n){let r=[];t instanceof Xm&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof tp)).length,n=e.filter((e=>e instanceof ep)).length;if(t>1||t>0&&n>0)throw new fi(di.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class ep extends Jm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new ep(e,t,n)}_apply(e){const t=this._parse(e);return up(e._query,t),new nm(e.firestore,e.converter,yc(e._query,t))}_parse(e){const t=Dm(e.firestore),n=function(e,t,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new fi(di.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){cp(o,i);const t=[];for(const n of o)t.push(ap(r,e,n));a={arrayValue:{values:t}}}else a=ap(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||cp(o,i),a=Fm(n,"where",o,"in"===i||"not-in"===i);return Pa.create(s,i,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class tp extends Xm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new tp(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Fa.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)up(n,e),n=yc(n,e)}(e._query,t),new nm(e.firestore,e.converter,yc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class np extends Jm{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new np(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new fi(di.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new fi(di.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new Oa(t,n);return function(e,t){if(null===dc(e)){const n=fc(e);null!==n&&hp(0,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new nm(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new cc(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class rp extends Jm{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new rp(e,t,n)}_apply(e){return new nm(e.firestore,e.converter,wc(e._query,this._limit,this._limitType))}}class sp extends Jm{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new sp(e,t,n)}_apply(e){const t=op(e,this.type,this._docOrFields,this._inclusive);return new nm(e.firestore,e.converter,function(e,t){return new cc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class ip extends Jm{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ip(e,t,n)}_apply(e){const t=op(e,this.type,this._docOrFields,this._inclusive);return new nm(e.firestore,e.converter,function(e,t){return new cc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function op(e,t,n,r){if(n[0]=_(n[0]),n[0]instanceof Qm)return function(e,t,n,r,s){if(!r)throw new fi(di.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of mc(e))if(n.field.isKeyField())i.push(ma(t,r.key));else{const e=r.data.field(n.field);if(ta(e))throw new fi(di.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new fi(di.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new Na(i,s)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const s=Dm(e.firestore);return function(e,t,n,r,s,i){const o=e.explicitOrderBy;if(s.length>o.length)throw new fi(di.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<s.length;i++){const c=s[i];if(o[i].field.isKeyField()){if("string"!=typeof c)throw new fi(di.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!gc(e)&&-1!==c.indexOf("/"))throw new fi(di.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(ki.fromString(c));if(!Mi.isDocumentKey(n))throw new fi(di.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new Mi(n);a.push(ma(t,s))}else{const e=Fm(n,r,c);a.push(e)}}return new Na(a,i)}(e._query,e.firestore._databaseId,s,t,n,r)}}function ap(e,t,n){if("string"==typeof(n=_(n))){if(""===n)throw new fi(di.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gc(t)&&-1!==n.indexOf("/"))throw new fi(di.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(ki.fromString(n));if(!Mi.isDocumentKey(r))throw new fi(di.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ma(e,new Mi(r))}if(n instanceof rm)return ma(e,n._key);throw new fi(di.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xg(n)}.`)}function cp(e,t){if(!Array.isArray(e)||0===e.length)throw new fi(di.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function up(e,t){if(t.isInequality()){const n=fc(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new fi(di.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const s=dc(e);null!==s&&hp(0,r,s)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new fi(di.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new fi(di.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function hp(e,t,n){if(!n.isEqual(t))throw new fi(di.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class lp{convertValue(e,t="none"){switch(ca(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Zo(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ea(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw ui()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Uo(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new bm(Zo(e.latitude),Zo(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=na(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ra(e));default:return null}}convertTimestamp(e){const t=Jo(e);return new xi(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ki.fromString(e);hi(vh(n));const r=new ia(n.get(1),n.get(3)),s=new Mi(n.popFirst(5));return r.isEqual(t)||oi(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function dp(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class fp extends lp{constructor(e){super(),this.firestore=e}convertBytes(e){return new ym(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new rm(this.firestore,null,t)}}class gp{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mp extends Qm{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new pp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Wm("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class pp extends mp{data(e={}){return super.data(e)}}class yp{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new gp(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new pp(this._firestore,this._userDataWriter,n.key,n,new gp(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new fi(di.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new pp(e._firestore,e._userDataWriter,n.doc.key,n.doc,new gp(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new pp(e._firestore,e._userDataWriter,t.doc.key,t.doc,new gp(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:wp(t.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function wp(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ui()}}function vp(e,t){return e instanceof mp&&t instanceof mp?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof yp&&t instanceof yp&&e._firestore===t._firestore&&cm(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class bp extends lp{constructor(e){super(),this.firestore=e}convertBytes(e){return new ym(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new rm(this.firestore,null,t)}}function _p(e,t,n){e=Jg(e,rm);const r=Jg(e.firestore,dm),s=dp(e.converter,t,n);return Tp(r,[xm(Dm(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,ru.none())])}function Ip(e,t,n,...r){e=Jg(e,rm);const s=Jg(e.firestore,dm),i=Dm(s);let o;return o="string"==typeof(t=_(t))||t instanceof wm?Pm(i,"updateDoc",e._key,t,n,r):Lm(i,"updateDoc",e._key,t),Tp(s,[o.toMutation(e._key,ru.exists(!0))])}function Ep(e,...t){var n,r,s;e=_(e);let i={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||hm(t[o])||(i=t[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(hm(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let c,u,h;if(e instanceof rm)u=Jg(e.firestore,dm),h=hc(e._key.path),c={next:n=>{t[o]&&t[o](Sp(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Jg(e,nm);u=Jg(n.firestore,dm),h=n._query;const r=new bp(u);c={next:e=>{t[o]&&t[o](new yp(u,r,n,e))},error:t[o+1],complete:t[o+2]},Ym(e._query)}return function(e,t,n,r){const s=new xg(r),i=new Vf(t,s,n);return e.asyncQueue.enqueueAndForget((async()=>Of(await jg(e),i))),()=>{s.Ma(),e.asyncQueue.enqueueAndForget((async()=>Mf(await jg(e),i)))}}(fm(u),h,a,c)}function Tp(e,t){return function(e,t){const n=new gi;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Ig(e);try{const e=await function(e,t){const n=li(e),r=xi.now(),s=t.reduce(((e,t)=>e.add(t.key)),Fc());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=xc(),c=Fc();return n.ts.getEntries(e,s).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((s=>{i=s;const o=[];for(const e of t){const t=uu(e,i.get(e.key).overlayedDocument);null!=t&&o.push(new du(e.key,t,xa(t.value.mapValue),ru.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:kc(i)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.pa[e.currentUser.toKey()];r||(r=new jo(Si)),r=r.insert(t,n),e.pa[e.currentUser.toKey()]=r}(r,e.batchId,n),await hg(r,e.changes),await ff(r.remoteStore)}catch(e){const t=Df(e,"Failed to persist write");n.reject(t)}}(await qg(e),t,n))),n.promise}(fm(e),t)}function Sp(e,t,n){const r=n.docs.get(t._key),s=new bp(e);return new mp(e,s,t._key,r,new gp(n.hasPendingWrites,n.fromCache),t.converter)}const Cp={maxAttempts:5};class Dp{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Dm(e)}set(e,t,n){this._verifyNotCommitted();const r=xp(e,this._firestore),s=dp(r.converter,t,n),i=xm(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,ru.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const s=xp(e,this._firestore);let i;return i="string"==typeof(t=_(t))||t instanceof wm?Pm(this._dataReader,"WriteBatch.update",s._key,t,n,r):Lm(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,ru.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=xp(e,this._firestore);return this._mutations=this._mutations.concat(new pu(t._key,ru.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new fi(di.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function xp(e,t){if((e=_(e)).firestore!==t)throw new fi(di.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Ap extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Dm(e)}get(e){const t=xp(e,this._firestore),n=new fp(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return ui();const r=e[0];if(r.isFoundDocument())return new Qm(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Qm(this._firestore,n,t._key,null,t.converter);throw ui()}))}set(e,t,n){const r=xp(e,this._firestore),s=dp(r.converter,t,n),i=xm(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){const s=xp(e,this._firestore);let i;return i="string"==typeof(t=_(t))||t instanceof wm?Pm(this._dataReader,"Transaction.update",s._key,t,n,r):Lm(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){const t=xp(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=xp(e,this._firestore),n=new bp(this._firestore);return super.get(e).then((e=>new mp(this._firestore,n,t._key,e._document,new gp(!1,!1),t.converter)))}}function Np(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new fi("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function kp(){if("undefined"==typeof Uint8Array)throw new fi("unimplemented","Uint8Arrays are not available in this environment.")}function Rp(){if("undefined"==typeof atob)throw new fi("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){!function(e){ni=e}(de),oe(new I("firestore",((e,{instanceIdentifier:n,options:r})=>{const s=e.getProvider("app").getImmediate(),i=new dm(new wi(e.getProvider("auth-internal")),new Ii(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new fi(di.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ia(e.options.projectId,t)}(s,n),s);return r=Object.assign({useFetchStreams:t},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),ye(ei,"4.1.2",e),ye(ei,"4.1.2","esm2017")}();class Op{constructor(e){this._delegate=e}static fromBase64String(e){return Rp(),new Op(ym.fromBase64String(e))}static fromUint8Array(e){return kp(),new Op(ym.fromUint8Array(e))}toBase64(){return Rp(),this._delegate.toBase64()}toUint8Array(){return kp(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Mp(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class Lp{enableIndexedDbPersistence(e,t){return function(e,t){pm(e=Jg(e,dm));const n=fm(e);if(n._uninitializedComponentsProvider)throw new fi(di.FAILED_PRECONDITION,"SDK cache is already specified.");ai("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=e._freezeSettings(),s=new Cg;return mm(n,s,new Tg(s,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){pm(e=Jg(e,dm));const t=fm(e);if(t._uninitializedComponentsProvider)throw new fi(di.FAILED_PRECONDITION,"SDK cache is already specified.");ai("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),r=new Cg;return mm(t,r,new Sg(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new fi(di.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new gi;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!Wi.v())return Promise.resolve();const t=e+"main";await Wi.delete(t)}(ad(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class Pp{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof ia||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||ai("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var s;const o=(e=Jg(e,tm))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&ai("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=ti.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new fi(di.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new ti(o)}e._authCredentials=new yi(new mi(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await Vg(e),n=await Ug(e);return t.setNetworkEnabled(!0),function(e){const t=li(e);return t.S_.delete(0),Xd(t)}(n)}))}(fm(Jg(this._delegate,dm)))}disableNetwork(){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await Vg(e),n=await Ug(e);return t.setNetworkEnabled(!1),async function(e){const t=li(e);t.S_.add(0),await Jd(t),t.v_.set("Offline")}(n)}))}(fm(Jg(this._delegate,dm)))}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Hg("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){const t=new gi;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=li(e);of(n.remoteStore)||ii("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=li(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.ya.get(e)||[];r.push(t),n.ya.set(e,r)}catch(e){const n=Df(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await qg(e),t))),t.promise}(fm(Jg(this._delegate,dm)))}onSnapshotsInSync(e){return t=this._delegate,n=e,function(e,t){const n=new xg(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){li(e).B_.add(t),t.next()}(await jg(e),n))),()=>{n.Ma(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){li(e).B_.delete(t)}(await jg(e),n)))}}(fm(t=Jg(t,dm)),hm(n)?n:{next:n});var t,n}get app(){if(!this._appCompat)throw new fi("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Yp(this,im(this._delegate,e))}catch(e){throw jp(e,"collection()","Firestore.collection()")}}doc(e){try{return new qp(this,om(this._delegate,e))}catch(e){throw jp(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Qp(this,function(e,t){if(e=Jg(e,tm),Qg("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new fi(di.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new nm(e,null,function(e){return new cc(ki.emptyPath(),e)}(t))}(this._delegate,e))}catch(e){throw jp(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=Jg(e,dm);const r=Object.assign(Object.assign({},Cp),void 0);return function(e){if(e.maxAttempts<1)throw new fi(di.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new gi;return e.asyncQueue.enqueueAndForget((async()=>{const s=await function(e){return Fg(e).then((e=>e.datastore))}(e);new kg(e.asyncQueue,s,n,t,r).run()})),r.promise}(fm(e),(n=>t(new Ap(e,n))),r)}(this._delegate,(t=>e(new Vp(this,t))))}batch(){return fm(this._delegate),new Bp(new Dp(this._delegate,(e=>Tp(this._delegate,e))))}loadBundle(e){return function(e,t){const n=fm(e=Jg(e,dm)),r=new lm;return function(e,t,n,r){const s=function(e,t){let n;return n="string"==typeof e?Cu().encode(e):e,function(e,t){return new Ag(e,t)}(function(e,t){if(e instanceof Uint8Array)return Dg(e,t);if(e instanceof ArrayBuffer)return Dg(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,$d(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=li(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=li(e),r=Wu(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.$r.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(jf(r));const s=new qf(r,e.localStore,t.serializer);let i=await t.va();for(;i;){const e=await s.Y_(i);e&&n._updateProgress(e),i=await t.va()}const o=await s.complete();return await hg(e,o.ea,void 0),await function(e,t){const n=li(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.$r.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.X_)}catch(e){return ai("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await qg(e),s,r)}))}(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return(t=this._delegate,n=e,function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=li(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.$r.getNamedQuery(e,t)))}(await Bg(e),t)))}(fm(t=Jg(t,dm)),n).then((e=>e?new nm(t,null,e.query):null))).then((e=>e?new Qp(this,e):null));var t,n}}class Fp extends lp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Op(new ym(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return qp.forKey(t,this.firestore,null)}}class Vp{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Fp(e)}get(e){const t=Xp(e);return this._delegate.get(t).then((e=>new Gp(this._firestore,new mp(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=Xp(e);return n?(Np("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const s=Xp(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){const t=Xp(e);return this._delegate.delete(t),this}}class Bp{constructor(e){this._delegate=e}set(e,t,n){const r=Xp(e);return n?(Np("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const s=Xp(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){const t=Xp(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Up{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new pp(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Kp(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Up.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let s=r.get(t);return s||(s=new Up(e,new Fp(e),t),r.set(t,s)),s}}Up.INSTANCES=new WeakMap;class qp{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Fp(e)}static forPath(e,t,n){if(e.length%2!=0)throw new fi("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new qp(t,new rm(t._delegate,n,new Mi(e)))}static forKey(e,t,n){return new qp(t,new rm(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Yp(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Yp(this.firestore,im(this._delegate,e))}catch(e){throw jp(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=_(e))instanceof rm&&am(this._delegate,e)}set(e,t){t=Np("DocumentReference.set",t);try{return t?_p(this._delegate,e,t):_p(this._delegate,e)}catch(e){throw jp(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Ip(this._delegate,e):Ip(this._delegate,e,t,...n)}catch(e){throw jp(e,"updateDoc()","DocumentReference.update()")}}delete(){return Tp(Jg((e=this._delegate).firestore,dm),[new pu(e._key,ru.none())]);var e}onSnapshot(...e){const t=$p(e),n=zp(e,(e=>new Gp(this.firestore,new mp(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return Ep(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Jg(e,rm);const t=Jg(e.firestore,dm),n=fm(t),r=new bp(t);return function(e,t){const n=new gi;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=li(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new fi(di.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Df(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Bg(e),t,n))),n.promise}(n,e._key).then((n=>new mp(t,r,e._key,n,new gp(null!==n&&n.hasLocalMutations,!0),e.converter)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Jg(e,rm);const t=Jg(e.firestore,dm);return $g(fm(t),e._key,{source:"server"}).then((n=>Sp(t,e,n)))}(this._delegate):function(e){e=Jg(e,rm);const t=Jg(e.firestore,dm);return $g(fm(t),e._key).then((n=>Sp(t,e,n)))}(this._delegate),t.then((e=>new Gp(this.firestore,new mp(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new qp(this.firestore,e?this._delegate.withConverter(Up.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function jp(e,t,n){return e.message=e.message.replace(t,n),e}function $p(e){for(const t of e)if("object"==typeof t&&!Mp(t))return t;return{}}function zp(e,t){var n,r;let s;return s=Mp(e[0])?e[0]:Mp(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{s.next&&s.next(t(e))},error:null===(n=s.error)||void 0===n?void 0:n.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Gp{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new qp(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return vp(this._delegate,e._delegate)}}class Kp extends Gp{data(e){const t=this._delegate.data(e);return void 0!==t||ui(),t}}class Qp{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Fp(e)}where(e,t,n){try{return new Qp(this.firestore,Zm(this._delegate,function(e,t,n){const r=t,s=Wm("where",e);return ep._create(s,r,n)}(e,t,n)))}catch(e){throw jp(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Qp(this.firestore,Zm(this._delegate,function(e,t="asc"){const n=t,r=Wm("orderBy",e);return np._create(r,n)}(e,t)))}catch(e){throw jp(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Qp(this.firestore,Zm(this._delegate,(Zg("limit",t=e),rp._create("limit",t,"F"))))}catch(t){throw jp(t,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Qp(this.firestore,Zm(this._delegate,(Zg("limitToLast",t=e),rp._create("limitToLast",t,"L"))))}catch(t){throw jp(t,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new Qp(this.firestore,Zm(this._delegate,function(...e){return sp._create("startAt",e,!0)}(...e)))}catch(e){throw jp(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Qp(this.firestore,Zm(this._delegate,function(...e){return sp._create("startAfter",e,!1)}(...e)))}catch(e){throw jp(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Qp(this.firestore,Zm(this._delegate,function(...e){return ip._create("endBefore",e,!1)}(...e)))}catch(e){throw jp(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Qp(this.firestore,Zm(this._delegate,function(...e){return ip._create("endAt",e,!0)}(...e)))}catch(e){throw jp(e,"endAt()","Query.endAt()")}}isEqual(e){return cm(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Jg(e,nm);const t=Jg(e.firestore,dm),n=fm(t),r=new bp(t);return function(e,t){const n=new gi;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await wd(e,t,!0),s=new Gf(t,r._s),i=s._a(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(e){const r=Df(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Bg(e),t,n))),n.promise}(n,e._query).then((n=>new yp(t,r,e,n)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Jg(e,nm);const t=Jg(e.firestore,dm),n=fm(t),r=new bp(t);return zg(n,e._query,{source:"server"}).then((n=>new yp(t,r,e,n)))}(this._delegate):function(e){e=Jg(e,nm);const t=Jg(e.firestore,dm),n=fm(t),r=new bp(t);return Ym(e._query),zg(n,e._query).then((n=>new yp(t,r,e,n)))}(this._delegate),t.then((e=>new Wp(this.firestore,new yp(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=$p(e),n=zp(e,(e=>new Wp(this.firestore,new yp(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return Ep(this._delegate,t,n)}withConverter(e){return new Qp(this.firestore,e?this._delegate.withConverter(Up.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Hp{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Kp(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Wp{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Qp(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new Kp(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new Hp(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new Kp(this._firestore,n))}))}isEqual(e){return vp(this._delegate,e._delegate)}}class Yp extends Qp{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new qp(this.firestore,e):null}doc(e){try{return new qp(this.firestore,void 0===e?om(this._delegate):om(this._delegate,e))}catch(e){throw jp(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Jg(e.firestore,dm),r=om(e),s=dp(e.converter,t);return Tp(n,[xm(Dm(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,ru.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new qp(this.firestore,e)))}isEqual(e){return am(this._delegate,e._delegate)}withConverter(e){return new Yp(this.firestore,e?this._delegate.withConverter(Up.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Xp(e){return Jg(e,rm)}class Jp{constructor(...e){this._delegate=new wm(...e)}static documentId(){return new Jp(Oi.keyField().canonicalString())}isEqual(e){return(e=_(e))instanceof wm&&this._delegate._internalPath.isEqual(e._internalPath)}}class Zp{constructor(e){this._delegate=e}static serverTimestamp(){const e=new km("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Zp(e)}static delete(){const e=new Am("deleteField");return e._methodName="FieldValue.delete",new Zp(e)}static arrayUnion(...e){const t=function(...e){return new Rm("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new Zp(t)}static arrayRemove(...e){const t=function(...e){return new Om("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new Zp(t)}static increment(e){const t=new Mm("increment",e);return t._methodName="FieldValue.increment",new Zp(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const ey={Firestore:Pp,GeoPoint:bm,Timestamp:xi,Blob:Op,Transaction:Vp,WriteBatch:Bp,DocumentReference:qp,DocumentSnapshot:Gp,Query:Qp,QueryDocumentSnapshot:Kp,QuerySnapshot:Wp,CollectionReference:Yp,FieldPath:Jp,FieldValue:Zp,setLogLevel:function(e){var t;t=e,ri.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};var ty;(function(e,t){e.INTERNAL.registerComponent(new I("firestore-compat",(e=>((e,t)=>new Pp(e,t,new Lp))(e.getProvider("app-compat").getImmediate(),e.getProvider("firestore").getImmediate())),"PUBLIC").setServiceProps(Object.assign({},ey)))})(ty=Le),ty.registerVersion("@firebase/firestore-compat","0.3.16"),Le.initializeApp({apiKey:"AIzaSyA05qKwQr30mtH-N5dC6UM9OELw9X6GWEo",authDomain:"provavideochiamata2.firebaseapp.com",projectId:"provavideochiamata2",storageBucket:"provavideochiamata2.appspot.com",messagingSenderId:"768267000742",appId:"1:768267000742:web:5a4efd29d29c4aecef8d67"});const ny=Le.firestore(),ry={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};let sy,iy=null,oy=null;const ay=document.getElementById("webcamButton"),cy=document.getElementById("webcamVideo"),uy=document.getElementById("remoteVideo"),hy=document.getElementById("webcamButtonStop"),ly=document.getElementById("callButton"),dy=document.getElementById("callInput"),fy=document.getElementById("answerButton"),gy=document.getElementById("hangupButton");hy.disabled=!0,fy.disabled=!0,ay.onclick=async()=>{sy=new RTCPeerConnection(ry),iy=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),oy=new MediaStream,iy.getTracks().forEach((e=>{sy.addTrack(e,iy)})),sy.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{oy.addTrack(e)}))},cy.srcObject=iy,uy.srcObject=oy,ly.disabled=!1,fy.disabled=!1,ay.disabled=!0,hy.disabled=!1,fy.disabled=!1},hy.onclick=async()=>{iy.getTracks().forEach((function(e){e.stop()})),cy.srcObject=iy,ay.disabled=!1,hy.disabled=!0,ly.disabled=!0,fy.disabled=!0},ly.onclick=async()=>{const e=ny.collection("calls").doc(),t=e.collection("offerCandidates"),n=e.collection("answerCandidates");dy.value=e.id,sy.onicecandidate=e=>{e.candidate&&t.add(e.candidate.toJSON())};const r=await sy.createOffer();await sy.setLocalDescription(r);const s={sdp:r.sdp,type:r.type};await e.set({offer:s}),e.onSnapshot((e=>{const t=e.data();if(!sy.currentRemoteDescription&&t?.answer){const e=new RTCSessionDescription(t.answer);sy.setRemoteDescription(e)}})),n.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());sy.addIceCandidate(t)}}))})),gy.disabled=!1},fy.onclick=async()=>{const e=dy.value,t=ny.collection("calls").doc(e),n=t.collection("answerCandidates"),r=t.collection("offerCandidates");sy.onicecandidate=e=>{e.candidate&&n.add(e.candidate.toJSON())};const s=(await t.get()).data().offer;await sy.setRemoteDescription(new RTCSessionDescription(s));const i=await sy.createAnswer();await sy.setLocalDescription(i);const o={type:i.type,sdp:i.sdp};await t.update({answer:o}),r.onSnapshot((e=>{e.docChanges().forEach((e=>{if(console.log(e),"added"===e.type){let t=e.doc.data();sy.addIceCandidate(new RTCIceCandidate(t))}}))}))},gy.onclick=async()=>{sy.close(),oy.getTracks().forEach((function(e){e.stop()})),uy.srcObject=oy,iy.getTracks().forEach((function(e){e.stop()})),cy.srcObject=iy,dy.value="",ay.disabled=!1,hy.disabled=!0,gy.disabled=!0,ly.disabled=!0,fy.disabled=!0}})();